
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="X-UA-Compatible" content="IE=Edge" />
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>7.4. CRATE’s Python regex NLP &#8212; CRATE  documentation</title>
    <link rel="stylesheet" href="../_static/classic.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="../_static/css/crate_docs.css" type="text/css" />
    <script type="text/javascript" id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="7.5. GATE NLP applications" href="gate.html" />
    <link rel="prev" title="7.3. Run the NLP" href="run_nlp.html" /> 
  </head><body>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="gate.html" title="7.5. GATE NLP applications"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="run_nlp.html" title="7.3. Run the NLP"
             accesskey="P">previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="../index.html">CRATE  documentation</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="index.html" accesskey="U">7. Natural language processing (NLP)</a> &#187;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <div class="section" id="crate-s-python-regex-nlp">
<span id="regex-nlp"></span><h1>7.4. CRATE’s Python regex NLP<a class="headerlink" href="#crate-s-python-regex-nlp" title="Permalink to this headline">¶</a></h1>
<p>CRATE provides several simple numerical results processors. Each comes with a
corresponding <em>validator</em>.</p>
<p>The <em>processor</em> looks for full results in text, like “his <strong>CRP is 10 mg/L
today</strong>” or “<strong>CRP | (H) | 17</strong>”, and will extract the number, units, and so
forth. It does so by matching a keyword (such as “CRP”, “C-reactive protein”,
“C reactive protein”, etc.) plus other attributes such as an optional tense
indicator (“is”, “was”), an optional relationship (“equals”, “&lt;”, etc.), a
value, and units. Units may be optional, and some units may be recognized and
specifically disallowed. For example, “MMSE 25/30” or “MMSE 25 out of 30” may
be allowed, where variants on “out of 30” are the units, and “MMSE 25” can be
treated as if it were implicitly out of 30, but “MMSE 25/29” disallowed.</p>
<p>In addition to the <a class="reference internal" href="overview.html#standard-nlp-output-columns"><span class="std std-ref">standard NLP output columns</span></a>, the <em>processor</em> produces these output columns:</p>
<table border="1" class="docutils">
<colgroup>
<col width="19%" />
<col width="19%" />
<col width="61%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Column</th>
<th class="head">SQL type</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>variable_name</td>
<td>VARCHAR(64)</td>
<td>Variable name (e.g. ‘CRP’)</td>
</tr>
<tr class="row-odd"><td>_content</td>
<td>TEXT</td>
<td>Matching text contents</td>
</tr>
<tr class="row-even"><td>_start</td>
<td>INT</td>
<td>Start position (of matching string within whole
text)</td>
</tr>
<tr class="row-odd"><td>_end</td>
<td>INT</td>
<td>End position (of matching string within whole
text)</td>
</tr>
<tr class="row-even"><td>variable_text</td>
<td>TEXT</td>
<td>Text that matched the variable name (e.g.
‘CRP’, ‘C-reactive protein’).</td>
</tr>
<tr class="row-odd"><td>relation_text</td>
<td>VARCHAR(50)</td>
<td>Text that matched the mathematical relationship
between variable and value (e.g. ‘=’, ‘equals’,
‘less than’)</td>
</tr>
<tr class="row-even"><td>relation</td>
<td>VARCHAR(2)</td>
<td>Standardized mathematical relationship between
variable and value (e.g. ‘=’, ‘&lt;=’)</td>
</tr>
<tr class="row-odd"><td>value_text</td>
<td>VARCHAR(50)</td>
<td>Matched numerical value, as text</td>
</tr>
<tr class="row-even"><td>units</td>
<td>VARCHAR(50)</td>
<td>Matched units, as text</td>
</tr>
<tr class="row-odd"><td>value_mg_l (*)</td>
<td>FLOAT</td>
<td>Numerical value in preferred units, if known</td>
</tr>
<tr class="row-even"><td>tense_text</td>
<td>VARCHAR(50)</td>
<td>Tense text, if known (e.g. ‘is’, ‘was’)</td>
</tr>
<tr class="row-odd"><td>tense</td>
<td>VARCHAR(7)</td>
<td>Calculated tense, if known (e.g. ‘past’,
‘present’)</td>
</tr>
</tbody>
</table>
<p>… plus any fields you elected to copy.</p>
<p>The name of the column marked (*) will vary from processor to processor (e.g.
value_mg_l for the CRP processor; value_kg for the Weight processor; value_m
for the Height processor). The columns may vary from processor to processor;
for example, the blood pressure (BP) processor produces two numbers per entry
(a systolic and a diastolic BP).</p>
<p>The <em>validator</em> simply looks for the corresponding keyword. It doesn’t record
much information except for a reference to the source row.</p>
<p>In addition to the <a class="reference internal" href="overview.html#standard-nlp-output-columns"><span class="std std-ref">standard NLP output columns</span></a>, a typical validator produces these output
columns:</p>
<table border="1" class="docutils">
<colgroup>
<col width="19%" />
<col width="19%" />
<col width="61%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Column</th>
<th class="head">SQL type</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>variable_name</td>
<td>VARCHAR(64)</td>
<td>Variable name (e.g. ‘CRP’)</td>
</tr>
<tr class="row-odd"><td>_content</td>
<td>TEXT</td>
<td>Matching text contents</td>
</tr>
<tr class="row-even"><td>_start</td>
<td>INT</td>
<td>Start position (of matching string within whole
text)</td>
</tr>
<tr class="row-odd"><td>_end</td>
<td>INT</td>
<td>End position (of matching string within whole
text)</td>
</tr>
</tbody>
</table>
<p>… plus any fields you elected to copy.</p>
<p>To look at things the validator recognized but the processor didn’t like, you
can do something like the following. This example was created for a database
with string source PKs (yuk) on Microsoft SQL Server (which sometimes requires
a slightly convoluted way of specifying table names).</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>SELECT text  -- field with the free text in
FROM crissql_v3.dbo.Progress_Notes  -- source table
WHERE document_id IN (  -- primary key
    SELECT _srcpkstr FROM crissql_workspace.[CRIS-CPFT\RCardinal].validate_crp
) AND document_id NOT IN (
    SELECT _srcpkstr FROM crissql_workspace.[CRIS-CPFT\RCardinal].crp
)
</pre></div>
</div>
<p>This should produce text where CRP is mentioned but no value given, such as
“FBC, TSH, vitamin B12, CRP and eGFR are all within normal range”; “blood
sample taken (CRP/U&amp;Es and FBC)”; “monitoring CK and CRP”; “CRP was back up
yesterday”.</p>
<p>For a table with integer PKs you would use <code class="docutils literal notranslate"><span class="pre">_srcpkval</span></code> instead of
<code class="docutils literal notranslate"><span class="pre">_srcpkstr</span></code>.</p>
<p><strong>Specimen timing on a slow system (2016-11-15):</strong> 5,954 seconds (1h40) for a
full run of 2,717,779 text notes (one per database row, from a table with a
string PK) through 40 NLP tasks (20 main, 20 validator) on a virtual computer
mimicking 2×2.7GHz CPUs running Windows Server 2003, with all databases under
SQL Server hosted elsewhere over a network. That works out at 18.2 kHz for
processor-notes or 456 Hz for notes. (The corresponding do-nothing incremental
update, with the –skipdelete option, took 4,756 s. That’s not much faster,
and was limited primarily by queries for a record indicating that each datum
had previously been processed. The advantage of incremental updates can be
considerably more than this if the NLP step is slow, as with GATE and other
more complex systems, but regular expressions are pretty quick.) Fast
computers with local networks and SSD storage should perform considerably
better, and tables with integer PKs are also processed faster because their
work can be more efficiently and evenly assigned to parallel processes.</p>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<h3><a href="../index.html">Table Of Contents</a></h3>
<p class="caption"><span class="caption-text">Contents:</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../introduction/overview.html">1. Overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="../introduction/package_elements.html">2. Package elements in brief</a></li>
<li class="toctree-l1"><a class="reference internal" href="../introduction/publications.html">3. Reference publications</a></li>
<li class="toctree-l1"><a class="reference internal" href="../installation/installation.html">4. Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../installation/database_drivers.html">5. Databases and database drivers</a></li>
<li class="toctree-l1"><a class="reference internal" href="../anonymisation/index.html">6. Anonymisation</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="index.html">7. Natural language processing (NLP)</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="overview.html">7.1. Overview of NLP</a></li>
<li class="toctree-l2"><a class="reference internal" href="nlp_config.html">7.2. NLP config file</a></li>
<li class="toctree-l2"><a class="reference internal" href="run_nlp.html">7.3. Run the NLP</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">7.4. CRATE’s Python regex NLP</a></li>
<li class="toctree-l2"><a class="reference internal" href="gate.html">7.5. GATE NLP applications</a></li>
<li class="toctree-l2"><a class="reference internal" href="medex.html">7.6. MedEx-UIMA drug NLP</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../website_config/index.html">8. Configuring the CRATE web interface</a></li>
<li class="toctree-l1"><a class="reference internal" href="../website_using/index.html">9. Using the CRATE web interface</a></li>
<li class="toctree-l1"><a class="reference internal" href="../misc/ancillary_tools.html">10. Ancillary tools</a></li>
<li class="toctree-l1"><a class="reference internal" href="../misc/troubleshooting.html">11. Troubleshooting</a></li>
<li class="toctree-l1"><a class="reference internal" href="../misc/technical_notes.html">12. Technical notes</a></li>
<li class="toctree-l1"><a class="reference internal" href="../misc/upgrading.html">13. Upgrading CRATE</a></li>
<li class="toctree-l1"><a class="reference internal" href="../misc/tcpip_ports.html">14. Common relevant TCP/IP ports</a></li>
<li class="toctree-l1"><a class="reference internal" href="../autodoc/index.html">15. Automatic documentation of source code</a></li>
<li class="toctree-l1"><a class="reference internal" href="../changelog.html">16. Change log/history</a></li>
<li class="toctree-l1"><a class="reference internal" href="../misc/to_do.html">17. Things to do</a></li>
<li class="toctree-l1"><a class="reference internal" href="../glossary.html">18. Abbreviations and glossary</a></li>
</ul>

  <h4>Previous topic</h4>
  <p class="topless"><a href="run_nlp.html"
                        title="previous chapter">7.3. Run the NLP</a></p>
  <h4>Next topic</h4>
  <p class="topless"><a href="gate.html"
                        title="next chapter">7.5. GATE NLP applications</a></p>
  <div role="note" aria-label="source link">
    <h3>This Page</h3>
    <ul class="this-page-menu">
      <li><a href="../_sources/nlp/crate_python_regex.rst.txt"
            rel="nofollow">Show Source</a></li>
    </ul>
   </div>
<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    </div>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="gate.html" title="7.5. GATE NLP applications"
             >next</a> |</li>
        <li class="right" >
          <a href="run_nlp.html" title="7.3. Run the NLP"
             >previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="../index.html">CRATE  documentation</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="index.html" >7. Natural language processing (NLP)</a> &#187;</li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
        &#169; Copyright 2018, Rudolf Cardinal.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.7.5.
    </div>
  </body>
</html>