
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="X-UA-Compatible" content="IE=Edge" />
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>5. Databases and database drivers &#8212; CRATE  documentation</title>
    <link rel="stylesheet" href="../_static/classic.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="../_static/css/crate_docs.css" type="text/css" />
    <script type="text/javascript" id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="6. Anonymisation" href="../anonymisation/index.html" />
    <link rel="prev" title="4. Installation" href="installation.html" /> 
  </head><body>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="../anonymisation/index.html" title="6. Anonymisation"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="installation.html" title="4. Installation"
             accesskey="P">previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="../index.html">CRATE  documentation</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="index.html" accesskey="U">&lt;no title&gt;</a> &#187;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <div class="section" id="databases-and-database-drivers">
<span id="database-drivers"></span><h1>5. Databases and database drivers<a class="headerlink" href="#databases-and-database-drivers" title="Permalink to this headline">¶</a></h1>
<div class="section" id="database-engines">
<h2>5.1. Database engines<a class="headerlink" href="#database-engines" title="Permalink to this headline">¶</a></h2>
<p>Supported engines include:</p>
<ul class="simple">
<li><a class="reference external" href="https://www.mysql.com/">MySQL</a>: free, open source, simple administration including via <a class="reference external" href="https://www.mysql.com/products/workbench/">MySQL
Workbench</a>.</li>
<li><a class="reference external" href="https://www.postgresql.org/">PostgreSQL</a>: free, open source, emphasis on standards compliance, advanced
column types.</li>
<li><a class="reference external" href="https://en.wikipedia.org/wiki/Microsoft_SQL_Server">SQL Server</a>: Microsoft; not free; common in UK NHS contexts.</li>
</ul>
</div>
<div class="section" id="recommended-database-drivers">
<span id="id1"></span><h2>5.2. Recommended database drivers<a class="headerlink" href="#recommended-database-drivers" title="Permalink to this headline">¶</a></h2>
<p>CRATE needs to talk to several databases, potentially of several types (e.g. an
<a class="reference external" href="https://en.wikipedia.org/wiki/Microsoft_SQL_Server">SQL Server</a> source and a <a class="reference external" href="https://www.mysql.com/">MySQL</a> destination), and from several operating
systems (e.g. if it runs on Windows or Linux). It’s therefore important to be
clear of what works well and what doesn’t when connecting CRATE to databases.</p>
<p>Summarizing the discussion below:</p>
<ul class="simple">
<li>For <a class="reference external" href="https://www.mysql.com/">MySQL</a>: if you want to install a fast option, use <a class="reference internal" href="#mysqlclient">mysqlclient</a>. If you
want to avoid dependencies, use <a class="reference internal" href="#mysqlconnector"><span class="std std-ref">MySQL Connector/Python</span></a> or <a class="reference internal" href="#pymysql"><span class="std std-ref">PyMySQL</span></a>.</li>
<li>For <a class="reference external" href="https://en.wikipedia.org/wiki/Microsoft_SQL_Server">SQL Server</a>: for Django use <a class="reference internal" href="#django-pyodbc-azure"><span class="std std-ref">django-pyodbc-azure</span></a> and for SQLAlchemy use <a class="reference internal" href="#pyodbc">pyodbc</a>, both via Windows ODBC.
For the ODBC drivers, use native drivers under Windows or <a class="reference internal" href="#freetds">FreeTDS</a> under
Linux (in a version that supports <a class="reference external" href="https://docs.microsoft.com/en-us/sql/relational-databases/native-client/features/using-multiple-active-result-sets-mars?view=sql-server-2017">MARS</a>).</li>
<li>For <a class="reference external" href="https://www.postgresql.org/">PostgreSQL</a>: use <a class="reference internal" href="#psycopg2">psycopg2</a>, though you may have to install prerequisites
(e.g. PostgreSQL itself).</li>
</ul>
<p>CRATE doesn’t bundle in database drivers, since they are OS-specific in many
instances, and can be installed as required by the user.</p>
</div>
<div class="section" id="more-detail">
<h2>5.3. More detail<a class="headerlink" href="#more-detail" title="Permalink to this headline">¶</a></h2>
<p>Internally, CRATE is written primarily in <a class="reference external" href="https://www.python.org/">Python</a> 3. It uses <a class="reference external" href="https://www.sqlalchemy.org/">SQLAlchemy</a> for
the anonymisation, and it uses <a class="reference external" href="https://www.djangoproject.com/">Django</a> for its web interface.</p>
<p>In general, software can talk to database via files (e.g. <a class="reference external" href="https://www.sqlite.org/">SQLite</a>), via TCP/IP
(e.g. <a class="reference external" href="https://www.mysql.com/">MySQL</a>, <a class="reference external" href="https://www.postgresql.org/">PostgreSQL</a>, <a class="reference external" href="https://en.wikipedia.org/wiki/Microsoft_SQL_Server">SQL Server</a>), via custom interfaces (e.g.
Windows-based authentication for SQL Server), and via standardized intermediate
interfaces (e.g. ODBC, JDBC) in which the client software communicates with the
intermediate interface which talks (somehow) to the final database.</p>
<p>Python libraries may be “pure Python”, in which case they install well via
standard tools like pip, or use a mixture of Python and other code (e.g. C,
Java), in which case appropriate tools (e.g. a C compiler or a Java virtual
machine) must also be available on the destination machine. Since the latter
are often specific to an operating system and/or CPU architecture, they are
sometimes more complex to install.</p>
<p>None of Django, SQLAlchemy, or CRATE “bake in” support for specific databases
<a class="footnote-reference" href="#notbakedin" id="id2">[1]</a>. This is because it’s easy to bake in old versions, making it
hard to upgrade. Keep things modular.</p>
</div>
<div class="section" id="a-catalogue-of-python-database-drivers">
<h2>5.4. A catalogue of Python database drivers<a class="headerlink" href="#a-catalogue-of-python-database-drivers" title="Permalink to this headline">¶</a></h2>
<div class="section" id="mysql-mysqldb">
<span id="mysqldb"></span><h3>5.4.1. MySQL + MySQLdb<a class="headerlink" href="#mysql-mysqldb" title="Permalink to this headline">¶</a></h3>
<p><strong>Deprecated.</strong> <code class="docutils literal notranslate"><span class="pre">MySQLdb</span></code> is an open-source Python interface to the <a class="reference external" href="https://dev.mysql.com/doc/refman/5.7/en/c-api.html">MySQL C
API</a>. It has largely been replaced by <a class="reference internal" href="#mysqlclient">mysqlclient</a>. It doesn’t support Python
3 <a class="footnote-reference" href="#mysqldbnotpython3" id="id3">[3]</a>: Python 2 only.</p>
<table border="1" class="docutils">
<colgroup>
<col width="22%" />
<col width="78%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>Driver</td>
<td>MySQLdb</td>
</tr>
<tr class="row-even"><td>Home page</td>
<td><div class="first last line-block">
<div class="line"><a class="reference external" href="https://pypi.org/project/MySQL-python/">https://pypi.org/project/MySQL-python/</a></div>
<div class="line"><a class="reference external" href="https://github.com/farcepest/MySQLdb1">https://github.com/farcepest/MySQLdb1</a></div>
</div>
</td>
</tr>
<tr class="row-odd"><td>Database</td>
<td><a class="reference external" href="https://www.mysql.com/">MySQL</a></td>
</tr>
<tr class="row-even"><td>Installation</td>
<td><code class="docutils literal notranslate"><span class="pre">pip</span> <span class="pre">install</span> <span class="pre">mysql-python</span></code></td>
</tr>
<tr class="row-odd"><td>Import</td>
<td><code class="docutils literal notranslate"><span class="pre">import</span> <span class="pre">MySQLdb</span></code></td>
</tr>
<tr class="row-even"><td>Django <code class="docutils literal notranslate"><span class="pre">ENGINE</span></code></td>
<td><code class="docutils literal notranslate"><span class="pre">django.db.backends.mysql</span></code></td>
</tr>
<tr class="row-odd"><td>SQLAlchemy URL</td>
<td><code class="docutils literal notranslate"><span class="pre">mysql+mysqldb://user:password&#64;host:port/database?charset=utf8</span></code></td>
</tr>
<tr class="row-even"><td>Licence</td>
<td>GPL</td>
</tr>
</tbody>
</table>
<p>“MySQLdb” and “mysql-python” are synonyms.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">This module needs to compile itself from C/C++ source. Under Linux, this
should just work. Under Windows, you may need to install a compiler, which
must (to some degree) match the Python version you’re using. If you don’t
have a compiler, you will get errors relating to “query_vcvarsall”. For
Python 3.4, try Microsoft Visual Studio 2010 (Visual C++ 10.0) or Visual
C++ Express 2010. Under 64-bit Windows, or if you have a later version of
Visual Studio, see also <a class="reference external" href="http://stackoverflow.com/questions/28251314">http://stackoverflow.com/questions/28251314</a>; you’ll
need to set the <code class="docutils literal notranslate"><span class="pre">VS100COMNTOOLS</span></code> environment variable.</p>
</div>
<p>It also requires appropriate libraries to build itself, so can fail to
autoinstall. It doesn’t autoinstall on a clean Linux box. You will need the
MySQL libraries installed; under Ubuntu Linux, you can do this:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>sudo apt-get install mysql
</pre></div>
</div>
</div>
<div class="section" id="mysql-mysqlclient">
<span id="mysqlclient"></span><h3>5.4.2. MySQL + mysqlclient<a class="headerlink" href="#mysql-mysqlclient" title="Permalink to this headline">¶</a></h3>
<p><code class="docutils literal notranslate"><span class="pre">mysqlclient</span></code> is an open-source fork of <a class="reference internal" href="#mysqldb"><span class="std std-ref">MySQLdb (MySQL-python)</span></a> that adds Python 3 support and fixes bugs. (Similarly, it is a
Python interface to the <a class="reference external" href="https://dev.mysql.com/doc/refman/5.7/en/c-api.html">MySQL C API</a>.) It is a drop-in replacement for
MySQLdb, all Python references remain to <code class="docutils literal notranslate"><span class="pre">MySQLdb</span></code>.</p>
<table border="1" class="docutils">
<colgroup>
<col width="22%" />
<col width="78%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>Driver</td>
<td>mysqlclient</td>
</tr>
<tr class="row-even"><td>Home page</td>
<td><div class="first last line-block">
<div class="line"><a class="reference external" href="https://mysqlclient.readthedocs.io/">https://mysqlclient.readthedocs.io/</a></div>
<div class="line"><a class="reference external" href="https://pypi.org/project/mysqlclient/">https://pypi.org/project/mysqlclient/</a></div>
</div>
</td>
</tr>
<tr class="row-odd"><td>Database</td>
<td><a class="reference external" href="https://www.mysql.com/">MySQL</a></td>
</tr>
<tr class="row-even"><td>Installation</td>
<td><code class="docutils literal notranslate"><span class="pre">pip</span> <span class="pre">install</span> <span class="pre">mysqlclient</span></code></td>
</tr>
<tr class="row-odd"><td>Import</td>
<td><code class="docutils literal notranslate"><span class="pre">import</span> <span class="pre">MySQLdb</span>&#160; <span class="pre">#</span> <span class="pre">same</span> <span class="pre">as</span> <span class="pre">MySQLdb</span></code></td>
</tr>
<tr class="row-even"><td>Django <code class="docutils literal notranslate"><span class="pre">ENGINE</span></code></td>
<td><code class="docutils literal notranslate"><span class="pre">django.db.backends.mysql</span></code></td>
</tr>
<tr class="row-odd"><td>SQLAlchemy URL</td>
<td><code class="docutils literal notranslate"><span class="pre">mysql+mysqldb://user:password&#64;host:port/database?charset=utf8</span></code></td>
</tr>
<tr class="row-even"><td>Licence</td>
<td>GPL</td>
</tr>
</tbody>
</table>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">This is Django’s recommended method for using MySQL
<a class="footnote-reference" href="#djangorecommendedmysql" id="id4">[2]</a>.</p>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">It’s quick, because it’s C-based <a class="footnote-reference" href="#mysqlcfast" id="id5">[5]</a>.</p>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">This module needs to compile itself from C/C++ source. Under Linux, this
should just work. Under Windows, you may need to install a compiler, which
must (to some degree) match the Python version you’re using. If you don’t
have a compiler, you will get errors relating to “query_vcvarsall”. For
Python 3.4, try Microsoft Visual Studio 2010 (Visual C++ 10.0) or Visual
C++ Express 2010. Under 64-bit Windows, or if you have a later version of
Visual Studio, see also <a class="reference external" href="http://stackoverflow.com/questions/28251314">http://stackoverflow.com/questions/28251314</a>; you’ll
need to set the <code class="docutils literal notranslate"><span class="pre">VS100COMNTOOLS</span></code> environment variable.</p>
</div>
<p>Under Windows, there can be additional compilation problems; see
<a class="reference external" href="https://github.com/PyMySQL/mysqlclient-python/issues/54">https://github.com/PyMySQL/mysqlclient-python/issues/54</a>.</p>
</div>
<div class="section" id="mysql-mysql-connector-python">
<span id="mysqlconnector"></span><h3>5.4.3. MySQL + MySQL Connector/Python<a class="headerlink" href="#mysql-mysql-connector-python" title="Permalink to this headline">¶</a></h3>
<p>MySQL Connector/Python is a pure Python driver for MySQL from MySQL themselves
(well, Oracle; Oracle own MySQL).</p>
<table border="1" class="docutils">
<colgroup>
<col width="23%" />
<col width="77%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>Driver</td>
<td>MySQL Connector/Python</td>
</tr>
<tr class="row-even"><td>Home page</td>
<td><div class="first last line-block">
<div class="line"><a class="reference external" href="https://dev.mysql.com/downloads/connector/python/">https://dev.mysql.com/downloads/connector/python/</a></div>
<div class="line"><a class="reference external" href="https://github.com/mysql/mysql-connector-python">https://github.com/mysql/mysql-connector-python</a></div>
</div>
</td>
</tr>
<tr class="row-odd"><td>Database</td>
<td><a class="reference external" href="https://www.mysql.com/">MySQL</a></td>
</tr>
<tr class="row-even"><td>Installation</td>
<td>Use <code class="docutils literal notranslate"><span class="pre">pip</span></code> with a custom URL. See below.</td>
</tr>
<tr class="row-odd"><td>Import</td>
<td><code class="docutils literal notranslate"><span class="pre">import</span> <span class="pre">mysql.connector</span></code></td>
</tr>
<tr class="row-even"><td>Django <code class="docutils literal notranslate"><span class="pre">ENGINE</span></code></td>
<td><code class="docutils literal notranslate"><span class="pre">mysql.connector.django</span></code></td>
</tr>
<tr class="row-odd"><td>SQLAlchemy URL</td>
<td><code class="docutils literal notranslate"><span class="pre">mysql+mysqlconnector://...</span></code></td>
</tr>
<tr class="row-even"><td>Licence</td>
<td>GPL <a class="footnote-reference" href="#gpldebate" id="id6">[4]</a></td>
</tr>
</tbody>
</table>
<p>Installation: use <code class="docutils literal notranslate"><span class="pre">pip</span></code> with a custom URL. See
<a class="reference external" href="http://stackoverflow.com/questions/34489271">http://stackoverflow.com/questions/34489271</a>. They have a presence at
<a class="reference external" href="https://pypi.python.org/pypi/mysql-connector-python">https://pypi.python.org/pypi/mysql-connector-python</a>, but you can’t do <code class="docutils literal notranslate"><span class="pre">pip</span>
<span class="pre">install</span> <span class="pre">mysql-connector-python</span></code>; the subpage for a given version (e.g. 2.0.4)
advertises a URL that you can use with <code class="docutils literal notranslate"><span class="pre">pip</span> <span class="pre">install</span> <span class="pre">&lt;URL&gt;</span></code>, and you can
substitute <code class="docutils literal notranslate"><span class="pre">https</span></code> for <code class="docutils literal notranslate"><span class="pre">http</span></code> if required.</p>
<p>Re the Django <cite>ENGINE</cite> setting: see
<a class="reference external" href="https://dev.mysql.com/doc/connector-python/en/connector-python-django-backend.html">https://dev.mysql.com/doc/connector-python/en/connector-python-django-backend.html</a>.</p>
<p>It’s slower than C-based interfaces, obviously <a class="footnote-reference" href="#mysqlconnectorslow" id="id7">[6]</a>.</p>
<p><strong>Problems.</strong> MySQL Connector/Python 2.0.4 doesn’t work with Django 1.9.7
(“cannot import name ‘BaseDatabaseFeatures’”), as of 2016-06-14
[<a class="reference external" href="https://code.djangoproject.com/ticket/24355">https://code.djangoproject.com/ticket/24355</a>]. At this time, 2.0.4 was the most
recent MySQL Connector/Python version cited in PyPI, but the direct-download
version from Oracle was 2.1.3. Don’t use the .MSI download; use “pip install
<a class="reference external" href="https://cdn.mysql.com/Downloads/Connector-Python/mysql-connector-python-2.1.3.tar.gz">https://cdn.mysql.com/Downloads/Connector-Python/mysql-connector-python-2.1.3.tar.gz</a>”
from within the virtual environment. This version does better with Django
1.9.7. However, it fails with errors like “django.db.utils.DatabaseError:
Incorrect datetime value: ‘2016-06-14 12:41:52.320665+00:00’ for column
‘applied’ at row 1” [<a class="reference external" href="https://code.djangoproject.com/ticket/26113">https://code.djangoproject.com/ticket/26113</a>].</p>
</div>
<div class="section" id="mysql-pymysql">
<span id="pymysql"></span><h3>5.4.4. MySQL + PyMySQL<a class="headerlink" href="#mysql-pymysql" title="Permalink to this headline">¶</a></h3>
<p>PyMySQL is a pure-Python MySQL client library. It’s slower than <a class="reference internal" href="#mysqlclient">mysqlclient</a> as
a result.</p>
<table border="1" class="docutils">
<colgroup>
<col width="22%" />
<col width="78%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>Driver</td>
<td>PyMySQL</td>
</tr>
<tr class="row-even"><td>Home page</td>
<td><div class="first last line-block">
<div class="line"><a class="reference external" href="http://pymysql.readthedocs.io">http://pymysql.readthedocs.io</a></div>
<div class="line"><a class="reference external" href="https://github.com/PyMySQL/PyMySQL">https://github.com/PyMySQL/PyMySQL</a></div>
<div class="line"><a class="reference external" href="https://pypi.python.org/pypi/PyMySQL">https://pypi.python.org/pypi/PyMySQL</a></div>
</div>
</td>
</tr>
<tr class="row-odd"><td>Database</td>
<td><a class="reference external" href="https://www.mysql.com/">MySQL</a></td>
</tr>
<tr class="row-even"><td>Installation</td>
<td><code class="docutils literal notranslate"><span class="pre">pip</span> <span class="pre">install</span> <span class="pre">pymysql</span></code></td>
</tr>
<tr class="row-odd"><td>Import</td>
<td><code class="docutils literal notranslate"><span class="pre">import</span> <span class="pre">pymysql</span></code></td>
</tr>
<tr class="row-even"><td>Django <code class="docutils literal notranslate"><span class="pre">ENGINE</span></code></td>
<td><code class="docutils literal notranslate"><span class="pre">django.db.backends.mysql</span></code> plus extras; see below</td>
</tr>
<tr class="row-odd"><td>SQLAlchemy URL</td>
<td><code class="docutils literal notranslate"><span class="pre">mysql+pymysql://user:password&#64;host:port/database?charset=utf8</span></code></td>
</tr>
<tr class="row-even"><td>Licence</td>
<td>MIT License</td>
</tr>
</tbody>
</table>
<p>PyMySQL can masquerade as MySQLdb upon explicit request. The Django <code class="docutils literal notranslate"><span class="pre">ENGINE</span></code> setting
remains <code class="docutils literal notranslate"><span class="pre">django.db.backends.mysql</span></code>, but a short extra import statement is
required in <code class="docutils literal notranslate"><span class="pre">manage.py</span></code>. See:</p>
<ul class="simple">
<li><a class="reference external" href="http://stackoverflow.com/questions/2636536">http://stackoverflow.com/questions/2636536</a></li>
<li><a class="reference external" href="http://stackoverflow.com/questions/13320343/">http://stackoverflow.com/questions/13320343/</a></li>
</ul>
<p>CRATE implements this fix, though actually if you want to run Celery as well,
you need the fix via the Celery entry point, so it’s easier to put one fix in
<code class="docutils literal notranslate"><span class="pre">settings.py</span></code>.</p>
</div>
<div class="section" id="sql-server-django-mssql">
<span id="django-mssql"></span><h3>5.4.5. SQL Server + django-mssql<a class="headerlink" href="#sql-server-django-mssql" title="Permalink to this headline">¶</a></h3>
<p><strong>Not recommended.</strong></p>
<p>An <a class="reference external" href="https://en.wikipedia.org/wiki/ActiveX_Data_Objects">ADO</a>-based Django database backend for Microsoft SQL Server.</p>
<table border="1" class="docutils">
<colgroup>
<col width="23%" />
<col width="77%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>Driver</td>
<td>django-mssql</td>
</tr>
<tr class="row-even"><td>Home page</td>
<td><a class="reference external" href="http://django-mssql.readthedocs.io/">http://django-mssql.readthedocs.io/</a></td>
</tr>
<tr class="row-odd"><td>Database</td>
<td><a class="reference external" href="https://en.wikipedia.org/wiki/Microsoft_SQL_Server">SQL Server</a></td>
</tr>
<tr class="row-even"><td>Installation</td>
<td><code class="docutils literal notranslate"><span class="pre">pip</span> <span class="pre">install</span> <span class="pre">django-mssql</span></code></td>
</tr>
<tr class="row-odd"><td>Import</td>
<td>–</td>
</tr>
<tr class="row-even"><td>Django <code class="docutils literal notranslate"><span class="pre">ENGINE</span></code></td>
<td><code class="docutils literal notranslate"><span class="pre">sqlserver_ado</span></code></td>
</tr>
<tr class="row-odd"><td>SQLAlchemy URL</td>
<td>–</td>
</tr>
</tbody>
</table>
<p>Django doesn’t support SQL Server officially
[<a class="reference external" href="https://docs.djangoproject.com/en/1.9/ref/databases/">https://docs.djangoproject.com/en/1.9/ref/databases/</a>]; django-mssql is a
third-party back-end, but it’s the semi-official one
[<a class="reference external" href="http://django-mssql.readthedocs.org/en/latest/">http://django-mssql.readthedocs.org/en/latest/</a>]. It is <strong>Windows-only</strong>
[<a class="reference external" href="http://stackoverflow.com/questions/22604732">http://stackoverflow.com/questions/22604732</a>].</p>
<p>With django-mssql==1.7 and Django==1.9.7, it doesn’t work (the error being “No
module named ‘django.db.backends.util’). It’s possible to hack around this, but
it doesn’t work out of the box
[<a class="reference external" href="http://stackoverflow.com/questions/9944204/setting-up-django-mssql-issues">http://stackoverflow.com/questions/9944204/setting-up-django-mssql-issues</a>].
Also, the SQL Server version supported appears
to be somewhat specific to the django-mssql version [<a class="reference external" href="https://bitbucket.org/Manfre/django-mssql/">https://bitbucket.org/Manfre/django-mssql/</a>].</p>
<p>With django-mssql==1.8 and Django==1.10.5, it works (tested with SQL Server
2014), but you have to edit the ‘provider’ option, or you get errors like
‘ADODB.Connection’ / ‘Provider cannot be found. It may not be properly
installed.’ [See also
<a class="reference external" href="http://stackoverflow.com/questions/26406943/establishing-connection-to-ms-sql-server-2014-with-django-mssql-1-6">http://stackoverflow.com/questions/26406943/establishing-connection-to-ms-sql-server-2014-with-django-mssql-1-6</a>.]
For compatibility with the way django-pyodbc-azure works, you also need to set
<code class="docutils literal notranslate"><span class="pre">use_legacy_date_fields</span></code>. Here’s an example:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>‘my_rio&#39;: {
    &#39;ENGINE&#39;: &#39;sqlserver_ado&#39;,
    &#39;NAME&#39;: &#39;RIO_TEST&#39;,  # database name
    &#39;OPTIONS&#39;: {
         &#39;use_mars&#39;: True,  # the default is True
         &#39;provider’: ‘SQLOLEDB’,
         &#39;use_legacy_date_fields’: True,
    },
    &#39;USER&#39;: &#39;XXX&#39;,
    &#39;PASSWORD&#39;: &#39;XXX&#39;,
}
</pre></div>
</div>
<p>It works to a degree, but even with <code class="docutils literal notranslate"><span class="pre">use_legacy_date_fields</span></code>, lots of date
comparisons failed. It was easier to hack django-pyodbc-azure slightly.</p>
</div>
<div class="section" id="sql-server-django-pymssql">
<span id="django-pymssql"></span><h3>5.4.6. SQL Server + django-pymssql<a class="headerlink" href="#sql-server-django-pymssql" title="Permalink to this headline">¶</a></h3>
<p><strong>Not recommended.</strong></p>
<p>This is no longer maintained (2018-12-06). It is a wrapper around
<a class="reference internal" href="#django-mssql"><span class="std std-ref">django-mssql</span></a> that uses <a class="reference internal" href="#pymssql">pymssql</a> instead of <a class="reference external" href="https://en.wikipedia.org/wiki/ActiveX_Data_Objects">ADO</a> to
connect to SQL Server.</p>
<table border="1" class="docutils">
<colgroup>
<col width="23%" />
<col width="77%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>Driver</td>
<td>django-pymssql</td>
</tr>
<tr class="row-even"><td>Home page</td>
<td><a class="reference external" href="https://github.com/aaugustin/django-pymssql">https://github.com/aaugustin/django-pymssql</a></td>
</tr>
<tr class="row-odd"><td>Database</td>
<td><a class="reference external" href="https://en.wikipedia.org/wiki/Microsoft_SQL_Server">SQL Server</a></td>
</tr>
<tr class="row-even"><td>Installation</td>
<td><code class="docutils literal notranslate"><span class="pre">pip</span> <span class="pre">install</span> <span class="pre">django-pymssql</span></code> and also needs <a class="reference internal" href="#pymssql">pymssql</a></td>
</tr>
<tr class="row-odd"><td>Import</td>
<td>–</td>
</tr>
<tr class="row-even"><td>Django <code class="docutils literal notranslate"><span class="pre">ENGINE</span></code></td>
<td><code class="docutils literal notranslate"><span class="pre">sqlserver_pymssql</span></code></td>
</tr>
<tr class="row-odd"><td>SQLAlchemy URL</td>
<td>–</td>
</tr>
<tr class="row-even"><td>Licence</td>
<td>MIT License</td>
</tr>
</tbody>
</table>
<ul class="simple">
<li>The project self-reports as not quite passing the Django test suite. It’s
probably this or the <a class="reference internal" href="#django-pyodbc-azure"><span class="std std-ref">django-pyodbc-azure</span></a> route.
This has the simpler stack.</li>
<li>Doesn’t work with Django 1.8. Using ‘sqlserver_pymssql’ engine leads to
sqlserver_ado failing to import ‘django.db.backends.util’, etc. See
<a class="reference external" href="http://stackoverflow.com/questions/30051839">http://stackoverflow.com/questions/30051839</a>;
<a class="reference external" href="http://stackoverflow.com/questions/9944204">http://stackoverflow.com/questions/9944204</a>.</li>
</ul>
</div>
<div class="section" id="sql-server-pymssql">
<span id="pymssql"></span><h3>5.4.7. SQL Server + pymssql<a class="headerlink" href="#sql-server-pymssql" title="Permalink to this headline">¶</a></h3>
<p>A Python interface to <a class="reference external" href="https://en.wikipedia.org/wiki/Microsoft_SQL_Server">SQL Server</a> via <a class="reference internal" href="#freetds">FreeTDS</a>.</p>
<table border="1" class="docutils">
<colgroup>
<col width="21%" />
<col width="79%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>Driver</td>
<td>pymssql</td>
</tr>
<tr class="row-even"><td>Home page</td>
<td><a class="reference external" href="http://www.pymssql.org/">http://www.pymssql.org/</a></td>
</tr>
<tr class="row-odd"><td>Database</td>
<td><a class="reference external" href="https://en.wikipedia.org/wiki/Microsoft_SQL_Server">SQL Server</a></td>
</tr>
<tr class="row-even"><td>Installation</td>
<td><code class="docutils literal notranslate"><span class="pre">pip</span> <span class="pre">install</span> <span class="pre">pymssql</span></code></td>
</tr>
<tr class="row-odd"><td>Import</td>
<td><code class="docutils literal notranslate"><span class="pre">import</span> <span class="pre">pymssql</span></code></td>
</tr>
<tr class="row-even"><td>Django <code class="docutils literal notranslate"><span class="pre">ENGINE</span></code></td>
<td>–</td>
</tr>
<tr class="row-odd"><td>SQLAlchemy URL</td>
<td>mssql+pymssql://username:password&#64;freetdsname/database?charset=utf8</td>
</tr>
<tr class="row-even"><td>Licence</td>
<td>LGPL</td>
</tr>
</tbody>
</table>
<p>Intended for Linux use. The <a class="reference internal" href="#pymssql">pymssql</a> library uses <a class="reference internal" href="#freetds">FreeTDS</a> code to communicate
with SQL Server. Under Ubuntu, there are prerequisites: <code class="docutils literal notranslate"><span class="pre">sudo</span> <span class="pre">apt-get</span> <span class="pre">install</span>
<span class="pre">freetds-dev</span></code> first.</p>
</div>
<div class="section" id="any-odbc-connection-pyodbc">
<span id="pyodbc"></span><h3>5.4.8. Any ODBC connection + PyODBC<a class="headerlink" href="#any-odbc-connection-pyodbc" title="Permalink to this headline">¶</a></h3>
<p>A Python interface to any database via <a class="reference internal" href="#odbc"><span class="std std-ref">ODBC</span></a>.</p>
<table border="1" class="docutils">
<colgroup>
<col width="22%" />
<col width="78%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>Driver</td>
<td>PyODBC</td>
</tr>
<tr class="row-even"><td>Home page</td>
<td><div class="first last line-block">
<div class="line"><a class="reference external" href="http://mkleehammer.github.io/pyodbc/">http://mkleehammer.github.io/pyodbc/</a></div>
<div class="line"><a class="reference external" href="https://github.com/mkleehammer/pyodbc/wiki">https://github.com/mkleehammer/pyodbc/wiki</a></div>
</div>
</td>
</tr>
<tr class="row-odd"><td>Database</td>
<td>Any with an <a class="reference internal" href="#odbc"><span class="std std-ref">ODBC</span></a> connection</td>
</tr>
<tr class="row-even"><td>Installation</td>
<td><code class="docutils literal notranslate"><span class="pre">pip</span> <span class="pre">install</span> <span class="pre">pyodbcl</span></code></td>
</tr>
<tr class="row-odd"><td>Import</td>
<td><code class="docutils literal notranslate"><span class="pre">import</span> <span class="pre">pyodbc</span></code></td>
</tr>
<tr class="row-even"><td>Django <code class="docutils literal notranslate"><span class="pre">ENGINE</span></code></td>
<td>–</td>
</tr>
<tr class="row-odd"><td>SQLAlchemy URL</td>
<td><div class="first last line-block">
<div class="line">mssql+pyodbc://username:password&#64;MY_DATABASE</div>
<div class="line">mssql+pyodbc://&#64;MY_DATABASE [for e.g. Windows authentication]</div>
</div>
</td>
</tr>
</tbody>
</table>
<p>In the SQLAlchemy URL examples, <code class="docutils literal notranslate"><span class="pre">MY_DATABASE</span></code> is an example ODBC data source
name (DSN).</p>
<p>SQLAlchemy <strong>deprecates</strong> MySQL via this route:
<a class="reference external" href="http://docs.sqlalchemy.org/en/rel_1_0/dialects/mysql.html">http://docs.sqlalchemy.org/en/rel_1_0/dialects/mysql.html</a>.</p>
<ul class="simple">
<li>Install an ODBC driver.</li>
<li>On Windows systems with SQL Server installed, you get driver choices like
“SQL Server”, “SQL Server Native Client 10.0”, “SQL Server Native Client
10.0”. I tested with “SQL Server Native Client 11.0” talking to SQL Server
10.50.6000 [= SQL Server 2008 R2 SP3]. See
<a class="reference external" href="https://support.microsoft.com/en-us/kb/321185">https://support.microsoft.com/en-us/kb/321185</a></li>
<li>In creating the ODBC data source, you choose whether you want
username/password authentication or Integrated Windows authentication, and
you give the data source a name (DSN), e.g. MY_DATABASE. The SQLAlchemy URL
is then “mssql+pyodbc://&#64;MY_DATABASE” (for Windows authentication) or,
presumably, “mssql+pyodbc://username:password&#64;MY_DATABASE” for
username/password authentication.</li>
<li>Addendum 2017-01-16: Microsoft have deprecated the SQL Server Native Client;
use the Microsoft ODBC Driver for SQL Server instead. (See
<a class="reference external" href="https://msdn.microsoft.com/en-us/library/ms130828.aspx">https://msdn.microsoft.com/en-us/library/ms130828.aspx</a>;
<a class="reference external" href="https://blogs.msdn.microsoft.com/sqlnativeclient/2013/01/23/introducing-the-new-microsoft-odbc-drivers-for-sql-server/">https://blogs.msdn.microsoft.com/sqlnativeclient/2013/01/23/introducing-the-new-microsoft-odbc-drivers-for-sql-server/</a>)
This typically appears as “ODBC Driver 11 for SQL Server”.</li>
</ul>
</div>
<div class="section" id="django-pyodbc-azure">
<span id="id8"></span><h3>5.4.9. django-pyodbc-azure<a class="headerlink" href="#django-pyodbc-azure" title="Permalink to this headline">¶</a></h3>
<p>A Django interface to any database via <a class="reference internal" href="#pyodbc"><span class="std std-ref">PyODBC</span></a>.</p>
<table border="1" class="docutils">
<colgroup>
<col width="20%" />
<col width="80%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>Driver</td>
<td>django-pyodbc-azure</td>
</tr>
<tr class="row-even"><td>Home page</td>
<td><div class="first last line-block">
<div class="line"><a class="reference external" href="https://pypi.org/project/django-pyodbc-azure/">https://pypi.org/project/django-pyodbc-azure/</a></div>
<div class="line"><a class="reference external" href="https://github.com/michiya/django-pyodbc-azure">https://github.com/michiya/django-pyodbc-azure</a></div>
</div>
</td>
</tr>
<tr class="row-odd"><td>Database</td>
<td>Any with an <a class="reference internal" href="#odbc"><span class="std std-ref">ODBC</span></a> connection</td>
</tr>
<tr class="row-even"><td>Installation</td>
<td><code class="docutils literal notranslate"><span class="pre">pip</span> <span class="pre">install</span> <span class="pre">django-pyodbc-azure</span></code> and also needs <a class="reference internal" href="#pyodbc"><span class="std std-ref">PyODBC</span></a></td>
</tr>
<tr class="row-odd"><td>Import</td>
<td>–</td>
</tr>
<tr class="row-even"><td>Django <code class="docutils literal notranslate"><span class="pre">ENGINE</span></code></td>
<td><code class="docutils literal notranslate"><span class="pre">sql_server.pyodbc</span></code></td>
</tr>
<tr class="row-odd"><td>SQLAlchemy URL</td>
<td>–</td>
</tr>
<tr class="row-even"><td>Licence</td>
<td>BSD License</td>
</tr>
</tbody>
</table>
<p>Under Linux, you can use the <a class="reference internal" href="#freetds">FreeTDS</a> ODBC driver, in which case read the
<code class="docutils literal notranslate"><span class="pre">'OPTIONS':</span> <span class="pre">{'host_is_server':</span> <span class="pre">...}</span></code> option carefully in the docs.</p>
<p>The Django database dictionary can be configured to use a Windows ODBC DSN with
e.g.: <a class="footnote-reference" href="#djangopyodbcazuremethod" id="id9">[7]</a></p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>‘my_rio&#39;: {
    &#39;ENGINE&#39;: &#39;sql_server.pyodbc&#39;,
    &#39;NAME&#39;: &#39;RIO_TEST&#39;,  # database name
    &#39;OPTIONS&#39;: {
         &#39;driver&#39;: &#39;SQL Server Native Client 11.0&#39;,
         # ... &#39;driver&#39; is optional
         &#39;dsn&#39;: &#39;RIO_TEST_SANDPIT&#39;,  # ODBC DSN
         &#39;MARS_Connection&#39;: True,
    },
    &#39;USER&#39;: &#39;&#39;,  # blank for M&#39;soft Integrated Security
    &#39;PASSWORD&#39;: &#39;&#39;,
}
</pre></div>
</div>
<p>It is not possible to avoid specifying NAME (without hacking the
sql_server.pyodbc source) – even if it’s unnecessary because database name is
also in the ODBC configuration for the specified DSN. Just supply it again.
(Note that if you specify a NAME that is a mismatch to the ODBC configuration,
you get odd effects – e.g. no data when you try to describe the database or
view its structure.)</p>
<p>If you are running as a service, you may have to specify the username/password,
since the program will be running as a system account.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last"><code class="docutils literal notranslate"><span class="pre">django-pyodbc-azure</span></code> generally works well. However, with
<code class="docutils literal notranslate"><span class="pre">django-pyodbc-azure==1.10.4.0</span></code>, <code class="docutils literal notranslate"><span class="pre">pyodbc==4.0.3</span></code>, and
<code class="docutils literal notranslate"><span class="pre">Django==1.10.5</span></code>, there appears to be a bug in using
<code class="docutils literal notranslate"><span class="pre">cursor.fetchone()</span></code>, in that PyODBC automatically calls
<code class="docutils literal notranslate"><span class="pre">self.cursor.nextset()</span></code>, and this can lead to crashes with errors like
“No results. Previous SQL was not a query.” This can be fixed by hacking
that call out of <code class="docutils literal notranslate"><span class="pre">sql_server/pyodbc/base.py</span></code>, in <code class="docutils literal notranslate"><span class="pre">Cursor.fetchone()</span></code>,
and CRATE does this in a dynamic fashion if
<code class="docutils literal notranslate"><span class="pre">DISABLE_DJANGO_PYODBC_AZURE_CURSOR_FETCHONE_NEXTSET</span></code> is set (see
<a class="reference internal" href="../website_config/web_config_file.html#web-config-file"><span class="std std-ref">Web config file</span></a>). This proved easier than switching to
<code class="docutils literal notranslate"><span class="pre">django-mssql</span></code>.</p>
</div>
<div class="admonition-todo admonition" id="index-0">
<p class="first admonition-title">Todo</p>
<p class="last">Upgrade to <code class="docutils literal notranslate"><span class="pre">django-pyodbc-azure==2.0.6.1</span></code>, which will require
Django 2.0.6, pyodbc 3.0+.</p>
</div>
</div>
<div class="section" id="psycopg2">
<span id="id10"></span><h3>5.4.10. psycopg2<a class="headerlink" href="#psycopg2" title="Permalink to this headline">¶</a></h3>
<p>Python interface to <a class="reference external" href="https://www.postgresql.org/">PostgreSQL</a>.</p>
<table border="1" class="docutils">
<colgroup>
<col width="23%" />
<col width="77%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>Driver</td>
<td>psycopg2</td>
</tr>
<tr class="row-even"><td>Home page</td>
<td><a class="reference external" href="http://initd.org/psycopg/docs/">http://initd.org/psycopg/docs/</a></td>
</tr>
<tr class="row-odd"><td>Database</td>
<td><a class="reference external" href="https://www.postgresql.org/">PostgreSQL</a></td>
</tr>
<tr class="row-even"><td>Installation</td>
<td><code class="docutils literal notranslate"><span class="pre">pip</span> <span class="pre">install</span> <span class="pre">psycopg2</span></code></td>
</tr>
<tr class="row-odd"><td>Import</td>
<td><code class="docutils literal notranslate"><span class="pre">import</span> <span class="pre">psycopg2</span></code></td>
</tr>
<tr class="row-even"><td>Django <code class="docutils literal notranslate"><span class="pre">ENGINE</span></code></td>
<td><code class="docutils literal notranslate"><span class="pre">django.db.backends.postgresql_psycopg2</span></code></td>
</tr>
<tr class="row-odd"><td>SQLAlchemy URL</td>
<td><code class="docutils literal notranslate"><span class="pre">postgresql://user:password&#64;host/database</span></code></td>
</tr>
<tr class="row-even"><td>Licence</td>
<td>LGPL</td>
</tr>
</tbody>
</table>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">This module needs to compile itself from C/C++ source. Under Linux, this
should just work. Under Windows, you may need to install a compiler, which
must (to some degree) match the Python version you’re using. If you don’t
have a compiler, you will get errors relating to “query_vcvarsall”. For
Python 3.4, try Microsoft Visual Studio 2010 (Visual C++ 10.0) or Visual
C++ Express 2010. Under 64-bit Windows, or if you have a later version of
Visual Studio, see also <a class="reference external" href="http://stackoverflow.com/questions/28251314">http://stackoverflow.com/questions/28251314</a>; you’ll
need to set the <code class="docutils literal notranslate"><span class="pre">VS100COMNTOOLS</span></code> environment variable.</p>
</div>
</div>
<div class="section" id="others-to-ignore">
<h3>5.4.11. Others to ignore<a class="headerlink" href="#others-to-ignore" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li><strong>django-pyodbc</strong> doesn’t support Python 3
[<a class="reference external" href="https://pypi.python.org/pypi/django-pyodbc">https://pypi.python.org/pypi/django-pyodbc</a>].</li>
<li><strong>django-sqlserver</strong> failed in 2015 with Django 1.9rc1, and is documented as
buggy [<a class="reference external" href="https://github.com/denisenkom/django-sqlserver">https://github.com/denisenkom/django-sqlserver</a>; older version was
<a class="reference external" href="https://bitbucket.org/denisenkom/django-pytds">https://bitbucket.org/denisenkom/django-pytds</a>]. It was formerly known as
<code class="docutils literal notranslate"><span class="pre">django-pytds</span></code> and uses the python-tds interface
[<a class="reference external" href="https://pypi.python.org/pypi/python-tds">https://pypi.python.org/pypi/python-tds</a>].</li>
<li><strong>django-jython</strong> (via <strong>zxJDBC</strong> then JDBC, then jTDS or a native driver):
this requires running Django under Jython, adding complexity.</li>
<li><strong>mxODBC</strong>: ignored; commercial
[<a class="reference external" href="http://www.egenix.com/products/python/mxODBC/">http://www.egenix.com/products/python/mxODBC/</a>].</li>
<li><strong>adodbapi</strong>: Not implemented in SQLAlchemy 0.6+
[<a class="reference external" href="http://docs.sqlalchemy.org/en/latest/dialects/mssql.html">http://docs.sqlalchemy.org/en/latest/dialects/mssql.html</a>].</li>
</ul>
</div>
</div>
<div class="section" id="other-database-connection-components">
<h2>5.5. Other database connection components<a class="headerlink" href="#other-database-connection-components" title="Permalink to this headline">¶</a></h2>
<div class="section" id="odbc">
<span id="id11"></span><h3>5.5.1. ODBC<a class="headerlink" href="#odbc" title="Permalink to this headline">¶</a></h3>
<p>ODBC is a generic API for talking to databases; see
<a class="reference external" href="https://en.wikipedia.org/wiki/Open_Database_Connectivity">https://en.wikipedia.org/wiki/Open_Database_Connectivity</a>.</p>
<p>It’s normally easy for Python to talk to ODBC (via PyODBC). However, the ODBC
system also requires a database-specific driver, and sometimes this is fiddly.</p>
<p>For Windows, there shouldn’t be many problems. ODBC is built into Windows, and
database-specific drivers for e.g. SQL Server are installed with SQL Server
itself, or built in, or readily available.</p>
<p>ODBC is provided for Linux via third-party products, notably <a class="reference external" href="http://www.unixodbc.org/">unixODBC</a>.
However, the ODBC system also requires a database-specific driver, and
sometimes this is fiddly under Linux (e.g. for SQL Server).</p>
<p>There is some support in Python for JDBC. Here we have better drivers for SQL
Server. A full (“Type 4”) JDBC driver talks directly to the database, and does
so on any platform, as it runs in a Java virtual machine (JVM). There are two
of note: (1) Microsoft provide a Type 4 JDBC driver for SQL Server
[<a class="reference external" href="https://www.microsoft.com/en-gb/download/details.aspx?id=11774">https://www.microsoft.com/en-gb/download/details.aspx?id=11774</a>]; (2) jTDS is
an open-source Type 4 JDBC driver for SQL Server (based on FreeTDS)
[<a class="reference external" href="http://jtds.sourceforge.net/">http://jtds.sourceforge.net/</a>]. That sounds great, but the use of JDBC requires
Python to talk to Java. This brings some complexities. JDBC drivers for Python
can run Jython (Python in a JVM), but that’s getting complex (e.g. Django under
Jython → django-jython → zxJDBC → jTDS → SQL Server).</p>
</div>
<div class="section" id="freetds">
<span id="id12"></span><h3>5.5.2. FreeTDS<a class="headerlink" href="#freetds" title="Permalink to this headline">¶</a></h3>
<p>FreeTDS is a set of Unix/Linux C libraries to communicate natively with <a class="reference external" href="https://en.wikipedia.org/wiki/Microsoft_SQL_Server">SQL
Server</a>, via an open-source implementation of the TDS protocol. See
<a class="reference external" href="http://www.freetds.org/">http://www.freetds.org/</a>. (There is also a Java equivalent, <a class="reference external" href="http://jtds.sourceforge.net/">jTDS</a>, not discussed further.)</p>
<p><strong>Configuring?</strong> Under Linux, the system-wide file is
<code class="docutils literal notranslate"><span class="pre">/etc/freetds/freetds.conf</span></code>; this contains server/database settings
[<a class="reference external" href="http://www.freetds.org/userguide/freetdsconf.htm">http://www.freetds.org/userguide/freetdsconf.htm</a>].</p>
<p><strong>Testing.</strong> Use the <code class="docutils literal notranslate"><span class="pre">tsql</span></code> command to test it. See <code class="docutils literal notranslate"><span class="pre">man</span> <span class="pre">tsql</span></code>. For
example, to connect to a server called <code class="docutils literal notranslate"><span class="pre">wombatvmxp</span></code>, try: <code class="docutils literal notranslate"><span class="pre">tsql</span> <span class="pre">-L</span> <span class="pre">-H</span>
<span class="pre">wombatvmxp</span></code> to list instances, and <code class="docutils literal notranslate"><span class="pre">tsql</span> <span class="pre">-H</span> <span class="pre">wombatvmxp</span> <span class="pre">-p</span> <span class="pre">1433</span> <span class="pre">-U</span> <span class="pre">user</span> <span class="pre">-P</span>
<span class="pre">password</span></code> to connect. Once you have configured <code class="docutils literal notranslate"><span class="pre">/etc/freetds/freetds.conf</span></code>,
you can use the config section as the server name: <code class="docutils literal notranslate"><span class="pre">tsql</span> <span class="pre">-S</span>
<span class="pre">my_sqlserver_connection</span> <span class="pre">-U</span> <span class="pre">user</span> <span class="pre">-P</span> <span class="pre">password</span></code>, and you’ll need to get this
version working before you can use SQLAlchemy with FreeTDS. A command likely to
work at the TSQL command prompt is <code class="docutils literal notranslate"><span class="pre">SELECT</span> <span class="pre">*</span> <span class="pre">FROM</span> <span class="pre">information_schema.tables</span></code>.
Remember to type <code class="docutils literal notranslate"><span class="pre">GO</span></code> (the default batch separator) to execute a command
(<a class="reference external" href="http://stackoverflow.com/questions/2299249">http://stackoverflow.com/questions/2299249</a>). To specify a particular database
on the server: add <code class="docutils literal notranslate"><span class="pre">-D</span> <span class="pre">database</span></code> to the <code class="docutils literal notranslate"><span class="pre">tsql</span></code> command (it should say
“Default database being set to …”). Note that though
<a class="reference external" href="http://www.freetds.org/userguide/freetdsconf.htm">http://www.freetds.org/userguide/freetdsconf.htm</a> specifies a <code class="docutils literal notranslate"><span class="pre">database</span></code>
parameter, <code class="docutils literal notranslate"><span class="pre">man</span> <span class="pre">freetds.conf</span></code> doesn’t (for <code class="docutils literal notranslate"><span class="pre">tsql</span> <span class="pre">-C</span></code> showing a version of
0.91). Mind you, v0.91 is from 2011 (<a class="reference external" href="http://www.freetds.org/news.html">http://www.freetds.org/news.html</a>). So for
v0.91, <code class="docutils literal notranslate"><span class="pre">freetds.conf</span></code> is not the place to specify the database, it seems. But
specifying the database in the SQLAlchemy URL works.</p>
<p><strong>WARNING.</strong> FreeTDS prior to version 0.95 does not support MARS. Without this,
CRATE will fail (stopping during/after the first patient). Furthermore,
FreeTDS only supports MARS via ODBC [<a class="reference external" href="http://www.freetds.org/mars.html">http://www.freetds.org/mars.html</a>], i.e.
presumably not this way. Use pyodbc → FreeTDS instead.</p>
<p>To get this working under Linux:</p>
<p><strong>TL;DR: install FreeTDS 1.0 or higher, compiled for MARS; use TDS protocol 7.2
or higher; ensure MARS_Connection = Yes.</strong></p>
<p>Ubuntu 16.04 uses FreeTDS 0.91. However, this has one minor problem and one
major one. The minor one is that <code class="docutils literal notranslate"><span class="pre">freetds.conf</span></code> doesn’t support the
“database” parameter (but <code class="docutils literal notranslate"><span class="pre">tsql</span> <span class="pre">-D</span></code> does, and so does the SQL Alchemy URL).
The major one is that it doesn’t support MARS, so you can’t use it with CRATE
and SQL Server (CRATE will silently stop during processing of the first
patient).</p>
<p>To install FreeTDS 1.0, you have to get fairly low-level:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1"># http://www.freetds.org/userguide/config.htm</span>
<span class="c1"># http://www.linuxforums.org/forum/applications/199305-wmvolman-2-0-1-install-problems.html</span>
<span class="nb">cd</span> /tmp  <span class="c1"># or somewhere</span>
git clone https://github.com/FreeTDS/freetds.git
<span class="nb">cd</span> freetds
libtoolize --force
aclocal
autoheader
automake --force-missing --add-missing
autoconf
./configure --enable-mars<span class="o">=</span>yes
make
sudo make install
</pre></div>
</div>
<p>Note in particular <code class="docutils literal notranslate"><span class="pre">--enable-mars=yes</span></code>.</p>
<p>Use <code class="docutils literal notranslate"><span class="pre">tsql</span> <span class="pre">-C</span></code> to check the compile-time options (you should see “MARS: yes”).</p>
<p>Be aware that FreeTDS only supports MARS via ODBC. So don’t expect an
SQLAlchemy URL of</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>mssql+pymssql://username:password@freetds_name/database_name?charset=utf8
</pre></div>
</div>
<p>to work. Instead, use</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>mssql+pyodbc://username:password@odbc_name/?charset=utf8
</pre></div>
</div>
<p>If this fails, edit <code class="docutils literal notranslate"><span class="pre">/etc/odbc.ini</span></code> to add a logfile, e.g.</p>
<div class="highlight-ini notranslate"><div class="highlight"><pre><span></span><span class="k">[crate_sqlserver_odbc]</span>
<span class="na">description</span> <span class="o">=</span> <span class="s">&quot;CRATE test SQL Server database on Wombat VMXP&quot;</span>
<span class="na">driver</span> <span class="o">=</span> <span class="s">FreeTDS</span>
<span class="c1">; this is looked up in /etc/odbcinst.ini</span>
<span class="na">TDS_Version</span> <span class="o">=</span> <span class="s">7.4</span>
<span class="c1">; see http://www.freetds.org/userguide/choosingtdsprotocol.htm</span>
<span class="na">server</span> <span class="o">=</span> <span class="s">192.168.1.13</span>
<span class="na">port</span> <span class="o">=</span> <span class="s">1433</span>
<span class="na">Database</span> <span class="o">=</span> <span class="s">crate_test_src</span>
<span class="na">MARS_Connection</span> <span class="o">=</span> <span class="s">Yes</span>
<span class="na">DumpFile</span> <span class="o">=</span> <span class="s">/tmp/freedump.log</span>
</pre></div>
</div>
<p>to check the actual FreeTDS software version and TDS protocol version being
used; the lines are near the top and look like</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>log.c:196:Starting log file for FreeTDS 0.91
                                        ^^^ bad; need higher FreeTDS version
net.c:207:Connecting to 192.168.1.13 port 1433 (TDS version 7.1)
                                                                ^^^ bad; need TDS 7.2
</pre></div>
</div>
<p>Note that a TDS_Version of “8.0” in <code class="docutils literal notranslate"><span class="pre">/etc/odbc.ini</span></code> will be converted to
“7.1”; if you specify a version that exceeds your SQL Server (e.g. specify
“7.4” when you’re running SQL Server 2005) it will fall back to 4.2; and <strong>you
need 7.2 or higher</strong> for MARS.</p>
<p>In this case, the problem was the <code class="docutils literal notranslate"><span class="pre">TDS_Version</span> <span class="pre">=</span> <span class="pre">7.4</span></code> (should have been 7.2,
for a SQL Server 2005 backend), and the <code class="docutils literal notranslate"><span class="pre">driver</span> <span class="pre">=</span> <span class="pre">FreeTDS</span></code> referring to an
installation of FreeTDS 0.91. Here’s a working version:</p>
<div class="highlight-ini notranslate"><div class="highlight"><pre><span></span><span class="c1"># /etc/odbcinst.ini</span>

    <span class="k">[FreeTDS_v1_1]</span>
    <span class="na">Description</span> <span class="o">=</span> <span class="s">FreeTDS 1.1 (SQL Server protocol driver for Unix)</span>
<span class="s">    Driver = /usr/local/lib/libtdsodbc.so</span>
</pre></div>
</div>
<div class="highlight-ini notranslate"><div class="highlight"><pre><span></span><span class="c1"># /etc/odbc.ini</span>

    <span class="k">[crate_sqlserver_odbc]</span>
    <span class="na">description</span> <span class="o">=</span> <span class="s">&quot;CRATE test SQL Server database on Wombat VMXP&quot;</span>
<span class="s">    driver = FreeTDS_v1_1</span>
<span class="s">    TDS_Version = 7.2</span>
<span class="s">    server = 192.168.1.13</span>
<span class="s">    port = 1433</span>
<span class="s">    Database = crate_test_src</span>
<span class="s">    MARS_Connection = Yes</span>
<span class="s">    DumpFile = /tmp/freedump.log</span>
<span class="s">    ; remove this line after testing!</span>
</pre></div>
</div>
<p>This worked.</p>
<p class="rubric">Footnotes</p>
<table class="docutils footnote" frame="void" id="notbakedin" rules="none">
<colgroup><col class="label" /><col /></colgroup>
<tbody valign="top">
<tr><td class="label"><a class="fn-backref" href="#id2">[1]</a></td><td>Django supports several databases but doesn’t ship with the required
interfaces, except for SQLite support, which is part of the Python standard
library (<a class="reference external" href="https://docs.djangoproject.com/en/1.9/ref/databases">https://docs.djangoproject.com/en/1.9/ref/databases</a>). The same is
true of SQLAlchemy
(<a class="reference external" href="http://docs.sqlalchemy.org/en/rel_1_0/core/engines.html">http://docs.sqlalchemy.org/en/rel_1_0/core/engines.html</a>), and of the
old custom <code class="docutils literal notranslate"><span class="pre">rnc_db</span></code> library.</td></tr>
</tbody>
</table>
<table class="docutils footnote" frame="void" id="djangorecommendedmysql" rules="none">
<colgroup><col class="label" /><col /></colgroup>
<tbody valign="top">
<tr><td class="label"><a class="fn-backref" href="#id4">[2]</a></td><td><a class="reference external" href="https://docs.djangoproject.com/en/1.9/ref/databases/">https://docs.djangoproject.com/en/1.9/ref/databases/</a></td></tr>
</tbody>
</table>
<table class="docutils footnote" frame="void" id="mysqldbnotpython3" rules="none">
<colgroup><col class="label" /><col /></colgroup>
<tbody valign="top">
<tr><td class="label"><a class="fn-backref" href="#id3">[3]</a></td><td>April 2016: <a class="reference external" href="https://pypi.python.org/pypi/MySQL-python/1.2.4">https://pypi.python.org/pypi/MySQL-python/1.2.4</a>.
June 2018: Python 3 still unsupported:
<a class="reference external" href="https://pypi.org/project/MySQL-python/">https://pypi.org/project/MySQL-python/</a>.</td></tr>
</tbody>
</table>
<table class="docutils footnote" frame="void" id="gpldebate" rules="none">
<colgroup><col class="label" /><col /></colgroup>
<tbody valign="top">
<tr><td class="label"><a class="fn-backref" href="#id6">[4]</a></td><td>For debate on the law about bundling GPL code with software with less
copyleft licences, see <a class="reference external" href="http://opensource.stackexchange.com/questions/2139">http://opensource.stackexchange.com/questions/2139</a>;
<a class="reference external" href="http://opensource.stackexchange.com/questions/1640">http://opensource.stackexchange.com/questions/1640</a></td></tr>
</tbody>
</table>
<table class="docutils footnote" frame="void" id="mysqlcfast" rules="none">
<colgroup><col class="label" /><col /></colgroup>
<tbody valign="top">
<tr><td class="label"><a class="fn-backref" href="#id5">[5]</a></td><td><a class="reference external" href="http://techspot.zzzeek.org/2015/02/15/asynchronous-python-and-databases/">http://techspot.zzzeek.org/2015/02/15/asynchronous-python-and-databases/</a></td></tr>
</tbody>
</table>
<table class="docutils footnote" frame="void" id="mysqlconnectorslow" rules="none">
<colgroup><col class="label" /><col /></colgroup>
<tbody valign="top">
<tr><td class="label"><a class="fn-backref" href="#id7">[6]</a></td><td><a class="reference external" href="http://charlesnagy.info/it/python/python-mysqldb-vs-mysql-connector-query-performance">http://charlesnagy.info/it/python/python-mysqldb-vs-mysql-connector-query-performance</a></td></tr>
</tbody>
</table>
<table class="docutils footnote" frame="void" id="djangopyodbcazuremethod" rules="none">
<colgroup><col class="label" /><col /></colgroup>
<tbody valign="top">
<tr><td class="label"><a class="fn-backref" href="#id9">[7]</a></td><td><a class="reference external" href="https://pypi.python.org/pypi/django-pyodbc">https://pypi.python.org/pypi/django-pyodbc</a>. When things go wrong… insert
print() statements into
sqlalchemy/engine/default.py:DefaultDialect.connect(), if SQLAlchemy is
working, and into
sql_server/pyodbc/base.py:DatabaseWrapper.get_new_connection(), if Django
isn’t. Then use: import pyodbc; connstr = “something”; conn =
pyodbc.connect(connstr). Then fiddle until it works. Then back-translate to
the Django interface. For ODBC connection string details for SQL Server
Native Client, see https://msdn.microsoft.com/en-us/library/ms130822.aspx.</td></tr>
</tbody>
</table>
</div>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<h3><a href="../index.html">Table Of Contents</a></h3>
<p class="caption"><span class="caption-text">Contents:</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../introduction/overview.html">1. Overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="../introduction/package_elements.html">2. Package elements in brief</a></li>
<li class="toctree-l1"><a class="reference internal" href="../introduction/publications.html">3. Reference publications</a></li>
<li class="toctree-l1"><a class="reference internal" href="installation.html">4. Installation</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">5. Databases and database drivers</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#database-engines">5.1. Database engines</a></li>
<li class="toctree-l2"><a class="reference internal" href="#recommended-database-drivers">5.2. Recommended database drivers</a></li>
<li class="toctree-l2"><a class="reference internal" href="#more-detail">5.3. More detail</a></li>
<li class="toctree-l2"><a class="reference internal" href="#a-catalogue-of-python-database-drivers">5.4. A catalogue of Python database drivers</a></li>
<li class="toctree-l2"><a class="reference internal" href="#other-database-connection-components">5.5. Other database connection components</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../anonymisation/index.html">6. Anonymisation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../nlp/index.html">7. Natural language processing (NLP)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../website_config/index.html">8. Configuring the CRATE web interface</a></li>
<li class="toctree-l1"><a class="reference internal" href="../website_using/index.html">9. Using the CRATE web interface</a></li>
<li class="toctree-l1"><a class="reference internal" href="../misc/ancillary_tools.html">10. Ancillary tools</a></li>
<li class="toctree-l1"><a class="reference internal" href="../misc/troubleshooting.html">11. Troubleshooting</a></li>
<li class="toctree-l1"><a class="reference internal" href="../misc/technical_notes.html">12. Technical notes</a></li>
<li class="toctree-l1"><a class="reference internal" href="../misc/upgrading.html">13. Upgrading CRATE</a></li>
<li class="toctree-l1"><a class="reference internal" href="../misc/tcpip_ports.html">14. Common relevant TCP/IP ports</a></li>
<li class="toctree-l1"><a class="reference internal" href="../autodoc/index.html">15. Automatic documentation of source code</a></li>
<li class="toctree-l1"><a class="reference internal" href="../changelog.html">16. Change log/history</a></li>
<li class="toctree-l1"><a class="reference internal" href="../misc/to_do.html">17. Things to do</a></li>
<li class="toctree-l1"><a class="reference internal" href="../glossary.html">18. Abbreviations and glossary</a></li>
</ul>

  <h4>Previous topic</h4>
  <p class="topless"><a href="installation.html"
                        title="previous chapter">4. Installation</a></p>
  <h4>Next topic</h4>
  <p class="topless"><a href="../anonymisation/index.html"
                        title="next chapter">6. Anonymisation</a></p>
  <div role="note" aria-label="source link">
    <h3>This Page</h3>
    <ul class="this-page-menu">
      <li><a href="../_sources/installation/database_drivers.rst.txt"
            rel="nofollow">Show Source</a></li>
    </ul>
   </div>
<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    </div>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="../anonymisation/index.html" title="6. Anonymisation"
             >next</a> |</li>
        <li class="right" >
          <a href="installation.html" title="4. Installation"
             >previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="../index.html">CRATE  documentation</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="index.html" >&lt;no title&gt;</a> &#187;</li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
        &#169; Copyright 2018, Rudolf Cardinal.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.7.5.
    </div>
  </body>
</html>