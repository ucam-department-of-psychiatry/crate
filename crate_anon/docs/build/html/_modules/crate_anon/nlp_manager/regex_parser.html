
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="X-UA-Compatible" content="IE=Edge" />
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>crate_anon.nlp_manager.regex_parser &#8212; CRATE  documentation</title>
    <link rel="stylesheet" href="../../../_static/classic.css" type="text/css" />
    <link rel="stylesheet" href="../../../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="../../../_static/css/crate_docs.css" type="text/css" />
    <script type="text/javascript" id="documentation_options" data-url_root="../../../" src="../../../_static/documentation_options.js"></script>
    <script type="text/javascript" src="../../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../../_static/doctools.js"></script>
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" /> 
  </head><body>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../../../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../../index.html">CRATE  documentation</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="../../index.html" accesskey="U">Module code</a> &#187;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <h1>Source code for crate_anon.nlp_manager.regex_parser</h1><div class="highlight"><pre>
<span></span><span class="ch">#!/usr/bin/env python</span>
<span class="c1"># crate_anon/nlp_manager/regex_parser.py</span>

<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">===============================================================================</span>
<span class="sd">    Copyright (C) 2015-2018 Rudolf Cardinal (rudolf@pobox.com).</span>

<span class="sd">    This file is part of CRATE.</span>

<span class="sd">    CRATE is free software: you can redistribute it and/or modify</span>
<span class="sd">    it under the terms of the GNU General Public License as published by</span>
<span class="sd">    the Free Software Foundation, either version 3 of the License, or</span>
<span class="sd">    (at your option) any later version.</span>

<span class="sd">    CRATE is distributed in the hope that it will be useful,</span>
<span class="sd">    but WITHOUT ANY WARRANTY; without even the implied warranty of</span>
<span class="sd">    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the</span>
<span class="sd">    GNU General Public License for more details.</span>

<span class="sd">    You should have received a copy of the GNU General Public License</span>
<span class="sd">    along with CRATE. If not, see &lt;http://www.gnu.org/licenses/&gt;.</span>
<span class="sd">===============================================================================</span>
<span class="sd">&quot;&quot;&quot;</span>

<span class="c1"># Shared elements for regex-based NLP work.</span>

<span class="kn">import</span> <span class="nn">logging</span>
<span class="kn">import</span> <span class="nn">sys</span>
<span class="kn">from</span> <span class="nn">typing</span> <span class="k">import</span> <span class="n">Any</span><span class="p">,</span> <span class="n">Dict</span><span class="p">,</span> <span class="n">Generator</span><span class="p">,</span> <span class="n">List</span><span class="p">,</span> <span class="n">Tuple</span>

<span class="kn">from</span> <span class="nn">sqlalchemy</span> <span class="k">import</span> <span class="n">Column</span><span class="p">,</span> <span class="n">Integer</span><span class="p">,</span> <span class="n">Float</span><span class="p">,</span> <span class="n">String</span><span class="p">,</span> <span class="n">Text</span>

<span class="kn">from</span> <span class="nn">crate_anon.nlp_manager.constants</span> <span class="k">import</span> <span class="p">(</span>
    <span class="n">MAX_SQL_FIELD_LEN</span><span class="p">,</span>
    <span class="n">SqlTypeDbIdentifier</span><span class="p">,</span>
<span class="p">)</span>
<span class="kn">from</span> <span class="nn">crate_anon.nlp_manager.base_nlp_parser</span> <span class="k">import</span> <span class="n">BaseNlpParser</span>
<span class="kn">from</span> <span class="nn">crate_anon.nlp_manager.nlp_definition</span> <span class="k">import</span> <span class="n">NlpDefinition</span>
<span class="kn">from</span> <span class="nn">crate_anon.nlp_manager.number</span> <span class="k">import</span> <span class="n">to_float</span><span class="p">,</span> <span class="n">to_pos_float</span>
<span class="kn">from</span> <span class="nn">crate_anon.nlp_manager.regex_func</span> <span class="k">import</span> <span class="p">(</span>
    <span class="n">compile_regex</span><span class="p">,</span>
    <span class="n">compile_regex_dict</span><span class="p">,</span>
    <span class="n">get_regex_dict_match</span><span class="p">,</span>
<span class="p">)</span>
<span class="kn">from</span> <span class="nn">crate_anon.nlp_manager.regex_numbers</span> <span class="k">import</span> <span class="p">(</span>
    <span class="n">BILLION</span><span class="p">,</span>
    <span class="n">LIBERAL_NUMBER</span><span class="p">,</span>
    <span class="n">MINUS_SIGN</span><span class="p">,</span>
    <span class="n">MULTIPLY</span><span class="p">,</span>
    <span class="n">PLAIN_INTEGER</span><span class="p">,</span>
    <span class="n">PLAIN_INTEGER_W_THOUSAND_COMMAS</span><span class="p">,</span>
    <span class="n">PLUS_SIGN</span><span class="p">,</span>
    <span class="n">POWER</span><span class="p">,</span>
    <span class="n">POWER_INC_E</span><span class="p">,</span>
    <span class="n">SCIENTIFIC_NOTATION_EXPONENT</span><span class="p">,</span>
    <span class="n">SIGN</span><span class="p">,</span>
    <span class="n">SIGNED_FLOAT</span><span class="p">,</span>
    <span class="n">SIGNED_INTEGER</span><span class="p">,</span>
    <span class="n">UNSIGNED_FLOAT</span><span class="p">,</span>
    <span class="n">UNSIGNED_INTEGER</span><span class="p">,</span>
<span class="p">)</span>
<span class="kn">from</span> <span class="nn">crate_anon.nlp_manager.regex_test</span> <span class="k">import</span> <span class="n">test_text_regex</span>
<span class="kn">from</span> <span class="nn">crate_anon.nlp_manager.regex_units</span> <span class="k">import</span> <span class="p">(</span>
    <span class="n">CELLS</span><span class="p">,</span>
    <span class="n">CELLS_PER_CUBIC_MM</span><span class="p">,</span>
    <span class="n">CUBIC_MM</span><span class="p">,</span>
    <span class="n">OUT_OF_SEPARATOR</span><span class="p">,</span>
    <span class="n">PER_CUBIC_MM</span><span class="p">,</span>
    <span class="n">SCORE</span><span class="p">,</span>
<span class="p">)</span>

<span class="n">log</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="vm">__name__</span><span class="p">)</span>


<span class="c1"># =============================================================================</span>
<span class="c1">#  Generic entities</span>
<span class="c1"># =============================================================================</span>

<span class="n">WORD_BOUNDARY</span> <span class="o">=</span> <span class="sa">r</span><span class="s2">&quot;\b&quot;</span>

<span class="c1"># -----------------------------------------------------------------------------</span>
<span class="c1"># Blood results</span>
<span class="c1"># -----------------------------------------------------------------------------</span>

<span class="n">OPTIONAL_RESULTS_IGNORABLES</span> <span class="o">=</span> <span class="sa">r</span><span class="s2">&quot;&quot;&quot;</span>
<span class="s2">    (?:  # OPTIONAL_RESULTS_IGNORABLES</span>
<span class="s2">        \s | \| | \:          # whitespace, bar, colon</span>
<span class="s2">        | \bHH?\b | \(HH?\)   # H/HH at a word boundary; (H)/(HH)</span>
<span class="s2">        | \bLL?\b | \(LL?\)   # L/LL etc.</span>
<span class="s2">        | \* | \(\*\) | \(    # *, (*), isolated left parenthesis</span>
<span class="s2">        | — | --              # em dash, double hyphen-minus</span>
<span class="s2">        | –\s+ | -\s+ | ‐\s+  # en dash/hyphen-minus/Unicode hyphen; whitespace</span>
<span class="s2">    )*</span>
<span class="s2">&quot;&quot;&quot;</span>
<span class="c1"># - you often get | characters when people copy/paste tables</span>
<span class="c1"># - blood test abnormality markers can look like e.g.</span>
<span class="c1">#       17 (H), 17 (*), 17 HH</span>
<span class="c1"># - you can also see things like &quot;CRP (5)&quot;</span>
<span class="c1"># - However, if there&#39;s a right parenthesis only, that&#39;s less good, e.g.</span>
<span class="c1">#   &quot;Present: Nicola Adams (NA). 1.0. Minutes of the last meeting.&quot;</span>
<span class="c1">#   ... which we don&#39;t want to be interpreted as &quot;sodium 1.0&quot;.</span>
<span class="c1">#   HOW BEST TO DO THIS?</span>
<span class="c1"># - http://stackoverflow.com/questions/546433/regular-expression-to-match-outer-brackets  # noqa</span>
<span class="c1">#   http://stackoverflow.com/questions/7898310/using-regex-to-balance-match-parenthesis  # noqa</span>
<span class="c1"># - ... simplest is perhaps: base ignorables, or those with brackets, as above</span>
<span class="c1"># - ... even better than a nested thing is just a list of alternatives</span>

<span class="c1"># -----------------------------------------------------------------------------</span>
<span class="c1"># Tense indicators</span>
<span class="c1"># -----------------------------------------------------------------------------</span>

<span class="n">IS</span> <span class="o">=</span> <span class="s2">&quot;is&quot;</span>
<span class="n">WAS</span> <span class="o">=</span> <span class="s2">&quot;was&quot;</span>
<span class="n">TENSE_INDICATOR</span> <span class="o">=</span> <span class="sa">r</span><span class="s2">&quot;(?: \b </span><span class="si">{IS}</span><span class="s2"> \b | \b </span><span class="si">{WAS}</span><span class="s2"> \b )&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">IS</span><span class="o">=</span><span class="n">IS</span><span class="p">,</span> <span class="n">WAS</span><span class="o">=</span><span class="n">WAS</span><span class="p">)</span>

<span class="c1"># Standardized result values</span>
<span class="n">PAST</span> <span class="o">=</span> <span class="s2">&quot;past&quot;</span>
<span class="n">PRESENT</span> <span class="o">=</span> <span class="s2">&quot;present&quot;</span>
<span class="n">TENSE_LOOKUP</span> <span class="o">=</span> <span class="n">compile_regex_dict</span><span class="p">({</span>
    <span class="n">IS</span><span class="p">:</span> <span class="n">PRESENT</span><span class="p">,</span>
    <span class="n">WAS</span><span class="p">:</span> <span class="n">PAST</span><span class="p">,</span>
<span class="p">})</span>

<span class="c1"># -----------------------------------------------------------------------------</span>
<span class="c1"># Mathematical relations</span>
<span class="c1"># -----------------------------------------------------------------------------</span>
<span class="c1"># ... don&#39;t use unnamed groups here; EQ is also used as a return value</span>

<span class="n">LT</span> <span class="o">=</span> <span class="s2">&quot;(?: &lt; | less \s+ than )&quot;</span>
<span class="n">LE</span> <span class="o">=</span> <span class="s2">&quot;&lt;=&quot;</span>
<span class="n">EQ</span> <span class="o">=</span> <span class="s2">&quot;(?: = | equals | equal \s+ to )&quot;</span>
<span class="n">GE</span> <span class="o">=</span> <span class="s2">&quot;&gt;=&quot;</span>
<span class="n">GT</span> <span class="o">=</span> <span class="s2">&quot;(?: &gt; | (?:more|greater) \s+ than )&quot;</span>
<span class="c1"># OF = &quot;\b of \b&quot;  # as in: &quot;a BMI of 30&quot;... but too likely to be mistaken for a target?  # noqa</span>

<span class="n">RELATION</span> <span class="o">=</span> <span class="sa">r</span><span class="s2">&quot;(?: </span><span class="si">{LE}</span><span class="s2"> | </span><span class="si">{LT}</span><span class="s2"> | </span><span class="si">{EQ}</span><span class="s2"> | </span><span class="si">{GE}</span><span class="s2"> | </span><span class="si">{GT}</span><span class="s2"> )&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
    <span class="n">LE</span><span class="o">=</span><span class="n">LE</span><span class="p">,</span>
    <span class="n">LT</span><span class="o">=</span><span class="n">LT</span><span class="p">,</span>
    <span class="n">EQ</span><span class="o">=</span><span class="n">EQ</span><span class="p">,</span>
    <span class="n">GE</span><span class="o">=</span><span class="n">GE</span><span class="p">,</span>
    <span class="n">GT</span><span class="o">=</span><span class="n">GT</span><span class="p">,</span>
<span class="p">)</span>
<span class="c1"># ... ORDER MATTERS: greedier things first, i.e.</span>
<span class="c1"># - LE before LT</span>
<span class="c1"># - GE before GT</span>

<span class="n">RELATION_LOOKUP</span> <span class="o">=</span> <span class="n">compile_regex_dict</span><span class="p">({</span>
    <span class="c1"># To standardize the output, so (for example) &quot;=&quot; and &quot;equals&quot; can both</span>
    <span class="c1"># map to &quot;=&quot;.</span>
    <span class="n">LT</span><span class="p">:</span> <span class="s2">&quot;&lt;&quot;</span><span class="p">,</span>
    <span class="n">LE</span><span class="p">:</span> <span class="s2">&quot;&lt;=&quot;</span><span class="p">,</span>
    <span class="n">EQ</span><span class="p">:</span> <span class="s2">&quot;=&quot;</span><span class="p">,</span>
    <span class="n">GE</span><span class="p">:</span> <span class="s2">&quot;&gt;=&quot;</span><span class="p">,</span>
    <span class="n">GT</span><span class="p">:</span> <span class="s2">&quot;&gt;&quot;</span><span class="p">,</span>
<span class="p">})</span>

<span class="c1"># -----------------------------------------------------------------------------</span>
<span class="c1"># Punctuation</span>
<span class="c1"># -----------------------------------------------------------------------------</span>

<span class="n">APOSTROPHE</span> <span class="o">=</span> <span class="s2">&quot;[</span><span class="se">\&#39;</span><span class="s2">’]&quot;</span>  <span class="c1"># ASCII apostrophe; right single quote (U+2019)</span>

<span class="c1"># =============================================================================</span>
<span class="c1">#  Generic processors</span>
<span class="c1"># =============================================================================</span>

<span class="n">FN_VARIABLE_NAME</span> <span class="o">=</span> <span class="s1">&#39;variable_name&#39;</span>
<span class="n">FN_CONTENT</span> <span class="o">=</span> <span class="s1">&#39;_content&#39;</span>
<span class="n">FN_START</span> <span class="o">=</span> <span class="s1">&#39;_start&#39;</span>
<span class="n">FN_END</span> <span class="o">=</span> <span class="s1">&#39;_end&#39;</span>
<span class="n">FN_VARIABLE_TEXT</span> <span class="o">=</span> <span class="s1">&#39;variable_text&#39;</span>
<span class="n">FN_RELATION_TEXT</span> <span class="o">=</span> <span class="s1">&#39;relation_text&#39;</span>
<span class="n">FN_RELATION</span> <span class="o">=</span> <span class="s1">&#39;relation&#39;</span>
<span class="n">FN_VALUE_TEXT</span> <span class="o">=</span> <span class="s1">&#39;value_text&#39;</span>
<span class="n">FN_UNITS</span> <span class="o">=</span> <span class="s1">&#39;units&#39;</span>
<span class="n">FN_TENSE_TEXT</span> <span class="o">=</span> <span class="s1">&#39;tense_text&#39;</span>
<span class="n">FN_TENSE</span> <span class="o">=</span> <span class="s1">&#39;tense&#39;</span>

<span class="n">HELP_VARIABLE_NAME</span> <span class="o">=</span> <span class="s2">&quot;Variable name&quot;</span>
<span class="n">HELP_CONTENT</span> <span class="o">=</span> <span class="s2">&quot;Matching text contents&quot;</span>
<span class="n">HELP_START</span> <span class="o">=</span> <span class="s2">&quot;Start position (of matching string within whole text)&quot;</span>
<span class="n">HELP_END</span> <span class="o">=</span> <span class="s2">&quot;End position (of matching string within whole text)&quot;</span>
<span class="n">HELP_VARIABLE_TEXT</span> <span class="o">=</span> <span class="s2">&quot;Text that matched the variable name&quot;</span>
<span class="n">HELP_RELATION_TEXT</span> <span class="o">=</span> <span class="p">(</span>
    <span class="s2">&quot;Text that matched the mathematical relationship between variable and &quot;</span>
    <span class="s2">&quot;value (e.g. &#39;=&#39;, &#39;&lt;=&#39;, &#39;less than&#39;)&quot;</span>
<span class="p">)</span>
<span class="n">HELP_RELATION</span> <span class="o">=</span> <span class="p">(</span>
    <span class="s2">&quot;Standardized mathematical relationship between variable and value &quot;</span>
    <span class="s2">&quot;(e.g. &#39;=&#39;, &#39;&lt;=&#39;)&quot;</span>
<span class="p">)</span>
<span class="n">HELP_VALUE_TEXT</span> <span class="o">=</span> <span class="s2">&quot;Matched numerical value, as text&quot;</span>
<span class="n">HELP_UNITS</span> <span class="o">=</span> <span class="n">HELP_VALUE_TEXT</span>
<span class="n">HELP_TARGET_UNIT</span> <span class="o">=</span> <span class="s2">&quot;Numerical value in preferred units, if known&quot;</span>
<span class="n">HELP_TENSE_TEXT</span> <span class="o">=</span> <span class="s2">&quot;Tense text, if known (e.g. &#39;</span><span class="si">{}</span><span class="s2">&#39;, &#39;</span><span class="si">{}</span><span class="s2">&#39;)&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">IS</span><span class="p">,</span> <span class="n">WAS</span><span class="p">)</span>
<span class="n">HELP_TENSE</span> <span class="o">=</span> <span class="s2">&quot;Calculated tense, if known (e.g. &#39;</span><span class="si">{}</span><span class="s2">&#39;, &#39;</span><span class="si">{}</span><span class="s2">&#39;)&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">PAST</span><span class="p">,</span>
                                                                   <span class="n">PRESENT</span><span class="p">)</span>

<span class="n">MAX_RELATION_TEXT_LENGTH</span> <span class="o">=</span> <span class="mi">50</span>
<span class="n">MAX_RELATION_LENGTH</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">RELATION_LOOKUP</span><span class="o">.</span><span class="n">values</span><span class="p">())</span>
<span class="n">MAX_VALUE_TEXT_LENGTH</span> <span class="o">=</span> <span class="mi">50</span>
<span class="n">MAX_UNITS_LENGTH</span> <span class="o">=</span> <span class="mi">50</span>
<span class="n">MAX_TENSE_TEXT_LENGTH</span> <span class="o">=</span> <span class="mi">50</span>
<span class="n">MAX_TENSE_LENGTH</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">TENSE_LOOKUP</span><span class="o">.</span><span class="n">values</span><span class="p">())</span>


<div class="viewcode-block" id="common_tense"><a class="viewcode-back" href="../../../autodoc/nlp_manager/regex_parser.html#crate_anon.nlp_manager.regex_parser.common_tense">[docs]</a><span class="k">def</span> <span class="nf">common_tense</span><span class="p">(</span><span class="n">tense_text</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">relation_text</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">]:</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Sort out tense, if known, and impute that &quot;CRP was 72&quot; means that</span>
<span class="sd">    relation was EQ in the PAST, etc.</span>

<span class="sd">    Returns (tense, relation).</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">tense</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="k">if</span> <span class="n">tense_text</span><span class="p">:</span>
        <span class="n">_</span><span class="p">,</span> <span class="n">tense</span> <span class="o">=</span> <span class="n">get_regex_dict_match</span><span class="p">(</span><span class="n">tense_text</span><span class="p">,</span> <span class="n">TENSE_LOOKUP</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">relation_text</span><span class="p">:</span>
        <span class="n">_</span><span class="p">,</span> <span class="n">tense</span> <span class="o">=</span> <span class="n">get_regex_dict_match</span><span class="p">(</span><span class="n">relation_text</span><span class="p">,</span> <span class="n">TENSE_LOOKUP</span><span class="p">)</span>

    <span class="n">_</span><span class="p">,</span> <span class="n">relation</span> <span class="o">=</span> <span class="n">get_regex_dict_match</span><span class="p">(</span><span class="n">relation_text</span><span class="p">,</span> <span class="n">RELATION_LOOKUP</span><span class="p">,</span> <span class="s2">&quot;=&quot;</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">tense</span><span class="p">,</span> <span class="n">relation</span></div>


<div class="viewcode-block" id="NumericalResultParser"><a class="viewcode-back" href="../../../autodoc/nlp_manager/regex_parser.html#crate_anon.nlp_manager.regex_parser.NumericalResultParser">[docs]</a><span class="k">class</span> <span class="nc">NumericalResultParser</span><span class="p">(</span><span class="n">BaseNlpParser</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;DO NOT USE DIRECTLY. Base class for generic numerical results, where</span>
<span class="sd">    a SINGLE variable is produced.&quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
                 <span class="n">nlpdef</span><span class="p">:</span> <span class="n">NlpDefinition</span><span class="p">,</span>
                 <span class="n">cfgsection</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
                 <span class="n">variable</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
                 <span class="n">target_unit</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
                 <span class="n">regex_str_for_debugging</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
                 <span class="n">commit</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">nlpdef</span><span class="o">=</span><span class="n">nlpdef</span><span class="p">,</span> <span class="n">cfgsection</span><span class="o">=</span><span class="n">cfgsection</span><span class="p">,</span> <span class="n">commit</span><span class="o">=</span><span class="n">commit</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">variable</span> <span class="o">=</span> <span class="n">variable</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">target_unit</span> <span class="o">=</span> <span class="n">target_unit</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">regex_str_for_debugging</span> <span class="o">=</span> <span class="n">regex_str_for_debugging</span>

        <span class="k">if</span> <span class="n">nlpdef</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>  <span class="c1"># only None for debugging!</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">tablename</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assume_preferred_unit</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">tablename</span> <span class="o">=</span> <span class="n">nlpdef</span><span class="o">.</span><span class="n">opt_str</span><span class="p">(</span>
                <span class="n">cfgsection</span><span class="p">,</span> <span class="s1">&#39;desttable&#39;</span><span class="p">,</span> <span class="n">required</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assume_preferred_unit</span> <span class="o">=</span> <span class="n">nlpdef</span><span class="o">.</span><span class="n">opt_bool</span><span class="p">(</span>
                <span class="n">cfgsection</span><span class="p">,</span> <span class="s1">&#39;assume_preferred_unit&#39;</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

        <span class="c1"># Sanity checks</span>
        <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">variable</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="n">MAX_SQL_FIELD_LEN</span><span class="p">,</span> <span class="p">(</span>
            <span class="s2">&quot;Variable name too long (max </span><span class="si">{}</span><span class="s2"> characters)&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                <span class="n">MAX_SQL_FIELD_LEN</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">print_info</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">file</span><span class="o">=</span><span class="n">sys</span><span class="o">.</span><span class="n">stdout</span><span class="p">):</span>
        <span class="nb">print</span><span class="p">(</span>
            <span class="s2">&quot;NLP class to find numerical results. Regular expression: &quot;</span>
            <span class="s2">&quot;</span><span class="se">\n\n</span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">regex_str_for_debugging</span><span class="p">),</span> <span class="n">file</span><span class="o">=</span><span class="n">file</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">get_regex_str_for_debugging</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">regex_str_for_debugging</span>

<div class="viewcode-block" id="NumericalResultParser.set_tablename"><a class="viewcode-back" href="../../../autodoc/nlp_manager/regex_parser.html#crate_anon.nlp_manager.regex_parser.NumericalResultParser.set_tablename">[docs]</a>    <span class="k">def</span> <span class="nf">set_tablename</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">tablename</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;In case a friend class wants to override.&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tablename</span> <span class="o">=</span> <span class="n">tablename</span></div>

<div class="viewcode-block" id="NumericalResultParser.dest_tables_columns"><a class="viewcode-back" href="../../../autodoc/nlp_manager/regex_parser.html#crate_anon.nlp_manager.regex_parser.NumericalResultParser.dest_tables_columns">[docs]</a>    <span class="k">def</span> <span class="nf">dest_tables_columns</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">List</span><span class="p">[</span><span class="n">Column</span><span class="p">]]:</span>
        <span class="k">return</span> <span class="p">{</span><span class="bp">self</span><span class="o">.</span><span class="n">tablename</span><span class="p">:</span> <span class="p">[</span>
            <span class="n">Column</span><span class="p">(</span><span class="n">FN_VARIABLE_NAME</span><span class="p">,</span> <span class="n">SqlTypeDbIdentifier</span><span class="p">,</span>
                   <span class="n">doc</span><span class="o">=</span><span class="n">HELP_VARIABLE_NAME</span><span class="p">),</span>
            <span class="n">Column</span><span class="p">(</span><span class="n">FN_CONTENT</span><span class="p">,</span> <span class="n">Text</span><span class="p">,</span> <span class="n">doc</span><span class="o">=</span><span class="n">HELP_CONTENT</span><span class="p">),</span>
            <span class="n">Column</span><span class="p">(</span><span class="n">FN_START</span><span class="p">,</span> <span class="n">Integer</span><span class="p">,</span> <span class="n">doc</span><span class="o">=</span><span class="n">HELP_START</span><span class="p">),</span>
            <span class="n">Column</span><span class="p">(</span><span class="n">FN_END</span><span class="p">,</span> <span class="n">Integer</span><span class="p">,</span> <span class="n">doc</span><span class="o">=</span><span class="n">HELP_END</span><span class="p">),</span>
            <span class="n">Column</span><span class="p">(</span><span class="n">FN_VARIABLE_TEXT</span><span class="p">,</span> <span class="n">Text</span><span class="p">,</span> <span class="n">doc</span><span class="o">=</span><span class="n">HELP_VARIABLE_TEXT</span><span class="p">),</span>
            <span class="n">Column</span><span class="p">(</span><span class="n">FN_RELATION_TEXT</span><span class="p">,</span> <span class="n">String</span><span class="p">(</span><span class="n">MAX_RELATION_TEXT_LENGTH</span><span class="p">),</span>
                   <span class="n">doc</span><span class="o">=</span><span class="n">HELP_RELATION_TEXT</span><span class="p">),</span>
            <span class="n">Column</span><span class="p">(</span><span class="n">FN_RELATION</span><span class="p">,</span> <span class="n">String</span><span class="p">(</span><span class="n">MAX_RELATION_LENGTH</span><span class="p">),</span>
                   <span class="n">doc</span><span class="o">=</span><span class="n">HELP_RELATION</span><span class="p">),</span>
            <span class="n">Column</span><span class="p">(</span><span class="n">FN_VALUE_TEXT</span><span class="p">,</span> <span class="n">Text</span><span class="p">,</span> <span class="n">doc</span><span class="o">=</span><span class="n">HELP_VALUE_TEXT</span><span class="p">),</span>
            <span class="n">Column</span><span class="p">(</span><span class="n">FN_UNITS</span><span class="p">,</span> <span class="n">String</span><span class="p">(</span><span class="n">MAX_UNITS_LENGTH</span><span class="p">),</span> <span class="n">doc</span><span class="o">=</span><span class="n">HELP_UNITS</span><span class="p">),</span>
            <span class="n">Column</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">target_unit</span><span class="p">,</span> <span class="n">Float</span><span class="p">,</span> <span class="n">doc</span><span class="o">=</span><span class="n">HELP_TARGET_UNIT</span><span class="p">),</span>
            <span class="n">Column</span><span class="p">(</span><span class="n">FN_TENSE_TEXT</span><span class="p">,</span> <span class="n">String</span><span class="p">(</span><span class="n">MAX_TENSE_TEXT_LENGTH</span><span class="p">),</span>
                   <span class="n">doc</span><span class="o">=</span><span class="n">HELP_TENSE_TEXT</span><span class="p">),</span>
            <span class="n">Column</span><span class="p">(</span><span class="n">FN_TENSE</span><span class="p">,</span> <span class="n">String</span><span class="p">(</span><span class="n">MAX_TENSE_LENGTH</span><span class="p">),</span> <span class="n">doc</span><span class="o">=</span><span class="n">HELP_TENSE</span><span class="p">),</span>
        <span class="p">]}</span></div>

<div class="viewcode-block" id="NumericalResultParser.parse"><a class="viewcode-back" href="../../../autodoc/nlp_manager/regex_parser.html#crate_anon.nlp_manager.regex_parser.NumericalResultParser.parse">[docs]</a>    <span class="k">def</span> <span class="nf">parse</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">text</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Generator</span><span class="p">[</span><span class="n">Tuple</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]],</span> <span class="kc">None</span><span class="p">,</span>
                                            <span class="kc">None</span><span class="p">]:</span>
        <span class="sd">&quot;&quot;&quot;Default parser for NumericalResultParser.&quot;&quot;&quot;</span>
        <span class="k">raise</span> <span class="ne">NotImplementedError</span></div>

<div class="viewcode-block" id="NumericalResultParser.test_numerical_parser"><a class="viewcode-back" href="../../../autodoc/nlp_manager/regex_parser.html#crate_anon.nlp_manager.regex_parser.NumericalResultParser.test_numerical_parser">[docs]</a>    <span class="k">def</span> <span class="nf">test_numerical_parser</span><span class="p">(</span>
            <span class="bp">self</span><span class="p">,</span>
            <span class="n">test_expected_list</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">Tuple</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">List</span><span class="p">[</span><span class="nb">float</span><span class="p">]]],</span>
            <span class="n">verbose</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        test_expected_list: list of tuples of (a) test string and</span>
<span class="sd">         (b) list of expected numerical (float) results, which can be an</span>
<span class="sd">         empty list</span>
<span class="sd">        Returne: none; will assert on failure</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Testing parser: </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="vm">__name__</span><span class="p">))</span>
        <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;... regex string:</span><span class="se">\n</span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">regex_str_for_debugging</span><span class="p">))</span>
        <span class="k">for</span> <span class="n">test_string</span><span class="p">,</span> <span class="n">expected_values</span> <span class="ow">in</span> <span class="n">test_expected_list</span><span class="p">:</span>
            <span class="n">actual_values</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span>
                <span class="n">x</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">target_unit</span><span class="p">]</span> <span class="k">for</span> <span class="n">t</span><span class="p">,</span> <span class="n">x</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">parse</span><span class="p">(</span><span class="n">test_string</span><span class="p">)</span>
            <span class="p">)</span>
            <span class="k">assert</span> <span class="n">actual_values</span> <span class="o">==</span> <span class="n">expected_values</span><span class="p">,</span> <span class="p">(</span>
                <span class="s2">&quot;Parser </span><span class="si">{name}</span><span class="s2">: Expected </span><span class="si">{expected}</span><span class="s2">, got </span><span class="si">{actual}</span><span class="s2">, when &quot;</span>
                <span class="s2">&quot;parsing </span><span class="si">{test_string}</span><span class="s2">; full result:</span><span class="se">\n</span><span class="si">{full}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                    <span class="n">name</span><span class="o">=</span><span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="vm">__name__</span><span class="p">,</span>
                    <span class="n">expected</span><span class="o">=</span><span class="n">expected_values</span><span class="p">,</span>
                    <span class="n">actual</span><span class="o">=</span><span class="n">actual_values</span><span class="p">,</span>
                    <span class="n">test_string</span><span class="o">=</span><span class="nb">repr</span><span class="p">(</span><span class="n">test_string</span><span class="p">),</span>
                    <span class="n">full</span><span class="o">=</span><span class="nb">repr</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">parse</span><span class="p">(</span><span class="n">test_string</span><span class="p">))),</span>
                <span class="p">)</span>
            <span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;... OK&quot;</span><span class="p">)</span></div>

    <span class="c1"># noinspection PyUnusedLocal</span>
    <span class="k">def</span> <span class="nf">detailed_test</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">text</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">expected</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]],</span>
                      <span class="n">verbose</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">for</span> <span class="n">_</span><span class="p">,</span> <span class="n">values</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">parse</span><span class="p">(</span><span class="n">text</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">i</span> <span class="o">&gt;=</span> <span class="nb">len</span><span class="p">(</span><span class="n">expected</span><span class="p">):</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Too few expected values. Extra result is: &quot;</span>
                                 <span class="s2">&quot;</span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">repr</span><span class="p">(</span><span class="n">values</span><span class="p">)))</span>
            <span class="n">expected_values</span> <span class="o">=</span> <span class="n">expected</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
            <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">exp_val</span> <span class="ow">in</span> <span class="n">expected_values</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="k">if</span> <span class="n">key</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">values</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                        <span class="s2">&quot;Test built wrong: expected key </span><span class="si">{}</span><span class="s2"> missing; result &quot;</span>
                        <span class="s2">&quot;was </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">repr</span><span class="p">(</span><span class="n">key</span><span class="p">),</span> <span class="nb">repr</span><span class="p">(</span><span class="n">values</span><span class="p">)))</span>
                <span class="k">if</span> <span class="n">values</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">!=</span> <span class="n">exp_val</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                        <span class="s2">&quot;For key </span><span class="si">{key}</span><span class="s2">, expected </span><span class="si">{exp_val}</span><span class="s2">, got </span><span class="si">{actual_val}</span><span class="s2">; &quot;</span>
                        <span class="s2">&quot;full result is </span><span class="si">{values}</span><span class="s2">; test text is </span><span class="si">{text}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                            <span class="n">key</span><span class="o">=</span><span class="nb">repr</span><span class="p">(</span><span class="n">key</span><span class="p">),</span>
                            <span class="n">exp_val</span><span class="o">=</span><span class="nb">repr</span><span class="p">(</span><span class="n">exp_val</span><span class="p">),</span>
                            <span class="n">actual_val</span><span class="o">=</span><span class="nb">repr</span><span class="p">(</span><span class="n">values</span><span class="p">[</span><span class="n">key</span><span class="p">]),</span>
                            <span class="n">values</span><span class="o">=</span><span class="nb">repr</span><span class="p">(</span><span class="n">values</span><span class="p">),</span>
                            <span class="n">text</span><span class="o">=</span><span class="nb">repr</span><span class="p">(</span><span class="n">text</span><span class="p">)))</span>
            <span class="n">i</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;... detailed_test: pass&quot;</span><span class="p">)</span></div>


<div class="viewcode-block" id="SimpleNumericalResultParser"><a class="viewcode-back" href="../../../autodoc/nlp_manager/regex_parser.html#crate_anon.nlp_manager.regex_parser.SimpleNumericalResultParser">[docs]</a><span class="k">class</span> <span class="nc">SimpleNumericalResultParser</span><span class="p">(</span><span class="n">NumericalResultParser</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Base class for simple single-format numerical results. Use this when</span>
<span class="sd">    not only do you have a single variable to produce, but you have a single</span>
<span class="sd">    regex (in a standard format) that can produce it.&quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
                 <span class="n">nlpdef</span><span class="p">:</span> <span class="n">NlpDefinition</span><span class="p">,</span>
                 <span class="n">cfgsection</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
                 <span class="n">regex_str</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
                 <span class="n">variable</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
                 <span class="n">target_unit</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
                 <span class="n">units_to_factor</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">float</span><span class="p">],</span>
                 <span class="n">take_absolute</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
                 <span class="n">commit</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
                 <span class="n">debug</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        This class operates with compiled regexes having this group format:</span>
<span class="sd">          - variable</span>
<span class="sd">          - tense_indicator</span>
<span class="sd">          - relation</span>
<span class="sd">          - value</span>
<span class="sd">          - units</span>

<span class="sd">        units_to_factor: dictionary, mapping</span>
<span class="sd">            FROM (compiled regex for units)</span>
<span class="sd">            TO EITHER</span>
<span class="sd">                - float [multiple] to multiple those units by, to get preferred</span>
<span class="sd">                   unit</span>
<span class="sd">            OR  - function taking text parameter and returning float value</span>
<span class="sd">                  in preferred unit</span>

<span class="sd">            - any units present in the regex but absent from units_to_factor</span>
<span class="sd">              will lead the result to be ignored -- for example, allowing you</span>
<span class="sd">              to ignore a relative neutrophil count (&quot;neutrophils 2.2%&quot;) while</span>
<span class="sd">              detecting absolute neutrophil counts (&quot;neutrophils 2.2&quot;), or</span>
<span class="sd">              ignoring &quot;docusate sodium 100mg&quot; but detecting &quot;sodium 140 mM&quot;.</span>

<span class="sd">        take_absolute: converts negative values to positive ones.</span>
<span class="sd">            Typical text requiring this might look like:</span>
<span class="sd">                CRP-4</span>
<span class="sd">                CRP-106</span>
<span class="sd">                CRP -97</span>
<span class="sd">                Blood results for today as follows: Na- 142, K-4.1, ...</span>
<span class="sd">            ... occurring in 23 / 8054 for CRP of one test set in our data.</span>
<span class="sd">            For many quantities, we know that they cannot be negative,</span>
<span class="sd">            so this is just a notation rather than a minus sign.</span>
<span class="sd">            We have to account for it, or it&#39;ll distort our values.</span>
<span class="sd">            Preferable to account for it here rather than later; see manual.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">nlpdef</span><span class="o">=</span><span class="n">nlpdef</span><span class="p">,</span>
                         <span class="n">cfgsection</span><span class="o">=</span><span class="n">cfgsection</span><span class="p">,</span>
                         <span class="n">variable</span><span class="o">=</span><span class="n">variable</span><span class="p">,</span>
                         <span class="n">target_unit</span><span class="o">=</span><span class="n">target_unit</span><span class="p">,</span>
                         <span class="n">regex_str_for_debugging</span><span class="o">=</span><span class="n">regex_str</span><span class="p">,</span>
                         <span class="n">commit</span><span class="o">=</span><span class="n">commit</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">debug</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Regex for </span><span class="si">{}</span><span class="s2">: </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="vm">__name__</span><span class="p">,</span> <span class="n">regex_str</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">compiled_regex</span> <span class="o">=</span> <span class="n">compile_regex</span><span class="p">(</span><span class="n">regex_str</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">units_to_factor</span> <span class="o">=</span> <span class="n">compile_regex_dict</span><span class="p">(</span><span class="n">units_to_factor</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">take_absolute</span> <span class="o">=</span> <span class="n">take_absolute</span>

<div class="viewcode-block" id="SimpleNumericalResultParser.parse"><a class="viewcode-back" href="../../../autodoc/nlp_manager/regex_parser.html#crate_anon.nlp_manager.regex_parser.SimpleNumericalResultParser.parse">[docs]</a>    <span class="k">def</span> <span class="nf">parse</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">text</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
              <span class="n">debug</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Generator</span><span class="p">[</span><span class="n">Tuple</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]],</span>
                                                <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">]:</span>
        <span class="sd">&quot;&quot;&quot;Default parser for SimpleNumericalResultParser.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">text</span><span class="p">:</span>
            <span class="k">return</span>
        <span class="k">for</span> <span class="n">m</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">compiled_regex</span><span class="o">.</span><span class="n">finditer</span><span class="p">(</span><span class="n">text</span><span class="p">):</span>
            <span class="n">startpos</span> <span class="o">=</span> <span class="n">m</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>
            <span class="n">endpos</span> <span class="o">=</span> <span class="n">m</span><span class="o">.</span><span class="n">end</span><span class="p">()</span>
            <span class="c1"># groups = repr(m.groups())  # all matching groups</span>
            <span class="n">matching_text</span> <span class="o">=</span> <span class="n">m</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>  <span class="c1"># the whole thing</span>
            <span class="c1"># matching_text = text[startpos:endpos]  # same thing</span>

            <span class="n">variable_text</span> <span class="o">=</span> <span class="n">m</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
            <span class="n">tense_text</span> <span class="o">=</span> <span class="n">m</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
            <span class="n">relation_text</span> <span class="o">=</span> <span class="n">m</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
            <span class="n">value_text</span> <span class="o">=</span> <span class="n">m</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span>
            <span class="n">units</span> <span class="o">=</span> <span class="n">m</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>

            <span class="c1"># If units are known (or we&#39;re choosing to assume preferred units</span>
            <span class="c1"># if none are specified), calculate an absolute value</span>
            <span class="n">value_in_target_units</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="k">if</span> <span class="n">units</span><span class="p">:</span>
                <span class="n">matched_unit</span><span class="p">,</span> <span class="n">multiple_or_fn</span> <span class="o">=</span> <span class="n">get_regex_dict_match</span><span class="p">(</span>
                    <span class="n">units</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">units_to_factor</span><span class="p">)</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">matched_unit</span><span class="p">:</span>
                    <span class="c1"># None of our units match. But there is a unit, and the</span>
                    <span class="c1"># regex matched. So this is a BAD unit. Skip the value.</span>
                    <span class="k">continue</span>
                <span class="c1"># Otherwise: we did match a unit.</span>
                <span class="k">if</span> <span class="n">callable</span><span class="p">(</span><span class="n">multiple_or_fn</span><span class="p">):</span>
                    <span class="n">value_in_target_units</span> <span class="o">=</span> <span class="n">multiple_or_fn</span><span class="p">(</span><span class="n">value_text</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">value_in_target_units</span> <span class="o">=</span> <span class="p">(</span><span class="n">to_float</span><span class="p">(</span><span class="n">value_text</span><span class="p">)</span> <span class="o">*</span>
                                             <span class="n">multiple_or_fn</span><span class="p">)</span>
            <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">assume_preferred_unit</span><span class="p">:</span>  <span class="c1"># unit is None or empty</span>
                <span class="n">value_in_target_units</span> <span class="o">=</span> <span class="n">to_float</span><span class="p">(</span><span class="n">value_text</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">value_in_target_units</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">take_absolute</span><span class="p">:</span>
                <span class="n">value_in_target_units</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="n">value_in_target_units</span><span class="p">)</span>

            <span class="n">tense</span><span class="p">,</span> <span class="n">relation</span> <span class="o">=</span> <span class="n">common_tense</span><span class="p">(</span><span class="n">tense_text</span><span class="p">,</span> <span class="n">relation_text</span><span class="p">)</span>

            <span class="n">result</span> <span class="o">=</span> <span class="p">{</span>
                <span class="n">FN_VARIABLE_NAME</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">variable</span><span class="p">,</span>
                <span class="n">FN_CONTENT</span><span class="p">:</span> <span class="n">matching_text</span><span class="p">,</span>
                <span class="n">FN_START</span><span class="p">:</span> <span class="n">startpos</span><span class="p">,</span>
                <span class="n">FN_END</span><span class="p">:</span> <span class="n">endpos</span><span class="p">,</span>

                <span class="n">FN_VARIABLE_TEXT</span><span class="p">:</span> <span class="n">variable_text</span><span class="p">,</span>
                <span class="n">FN_RELATION_TEXT</span><span class="p">:</span> <span class="n">relation_text</span><span class="p">,</span>
                <span class="n">FN_RELATION</span><span class="p">:</span> <span class="n">relation</span><span class="p">,</span>
                <span class="n">FN_VALUE_TEXT</span><span class="p">:</span> <span class="n">value_text</span><span class="p">,</span>
                <span class="n">FN_UNITS</span><span class="p">:</span> <span class="n">units</span><span class="p">,</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">target_unit</span><span class="p">:</span> <span class="n">value_in_target_units</span><span class="p">,</span>
                <span class="n">FN_TENSE_TEXT</span><span class="p">:</span> <span class="n">tense_text</span><span class="p">,</span>
                <span class="n">FN_TENSE</span><span class="p">:</span> <span class="n">tense</span><span class="p">,</span>
            <span class="p">}</span>
            <span class="c1"># log.critical(result)</span>
            <span class="k">if</span> <span class="n">debug</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Match </span><span class="si">{}</span><span class="s2"> for </span><span class="si">{}</span><span class="s2"> -&gt; </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">m</span><span class="p">,</span> <span class="nb">repr</span><span class="p">(</span><span class="n">text</span><span class="p">),</span> <span class="n">result</span><span class="p">))</span>
            <span class="k">yield</span> <span class="bp">self</span><span class="o">.</span><span class="n">tablename</span><span class="p">,</span> <span class="n">result</span></div></div>


<div class="viewcode-block" id="NumeratorOutOfDenominatorParser"><a class="viewcode-back" href="../../../autodoc/nlp_manager/regex_parser.html#crate_anon.nlp_manager.regex_parser.NumeratorOutOfDenominatorParser">[docs]</a><span class="k">class</span> <span class="nc">NumeratorOutOfDenominatorParser</span><span class="p">(</span><span class="n">BaseNlpParser</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Base class for X-out-of-Y numerical results, e.g. for MMSE/ACE.</span>
<span class="sd">    Integer denominator, expected to be positive.</span>
<span class="sd">    Otherwise similar to SimpleNumericalResultParser.&quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
                 <span class="n">nlpdef</span><span class="p">:</span> <span class="n">NlpDefinition</span><span class="p">,</span>
                 <span class="n">cfgsection</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
                 <span class="n">variable_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>  <span class="c1"># e.g. &quot;MMSE&quot;</span>
                 <span class="n">variable_regex_str</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>  <span class="c1"># e.g. regex for MMSE</span>
                 <span class="n">expected_denominator</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
                 <span class="n">numerator_text_fieldname</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;numerator_text&quot;</span><span class="p">,</span>
                 <span class="n">numerator_fieldname</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;numerator&quot;</span><span class="p">,</span>
                 <span class="n">denominator_text_fieldname</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;denominator_text&quot;</span><span class="p">,</span>
                 <span class="n">denominator_fieldname</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;denominator&quot;</span><span class="p">,</span>
                 <span class="n">correct_numerator_fieldname</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>  <span class="c1"># default below</span>
                 <span class="n">take_absolute</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
                 <span class="n">commit</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
                 <span class="n">debug</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        This class operates with compiled regexes having this group format:</span>
<span class="sd">          - quantity_regex_str: e.g. to find &quot;MMSE&quot;</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">variable_name</span> <span class="o">=</span> <span class="n">variable_name</span>
        <span class="k">assert</span><span class="p">(</span><span class="n">expected_denominator</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">expected_denominator</span> <span class="o">=</span> <span class="n">expected_denominator</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">numerator_text_fieldname</span> <span class="o">=</span> <span class="n">numerator_text_fieldname</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">numerator_fieldname</span> <span class="o">=</span> <span class="n">numerator_fieldname</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">denominator_text_fieldname</span> <span class="o">=</span> <span class="n">denominator_text_fieldname</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">denominator_fieldname</span> <span class="o">=</span> <span class="n">denominator_fieldname</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">correct_numerator_fieldname</span> <span class="o">=</span> <span class="p">(</span>
            <span class="n">correct_numerator_fieldname</span> <span class="ow">or</span>
            <span class="s2">&quot;out_of_</span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">expected_denominator</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">take_absolute</span> <span class="o">=</span> <span class="n">take_absolute</span>

        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">nlpdef</span><span class="o">=</span><span class="n">nlpdef</span><span class="p">,</span>
                         <span class="n">cfgsection</span><span class="o">=</span><span class="n">cfgsection</span><span class="p">,</span>
                         <span class="n">commit</span><span class="o">=</span><span class="n">commit</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">nlpdef</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>  <span class="c1"># only None for debugging!</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">tablename</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">tablename</span> <span class="o">=</span> <span class="n">nlpdef</span><span class="o">.</span><span class="n">opt_str</span><span class="p">(</span>
                <span class="n">cfgsection</span><span class="p">,</span> <span class="s1">&#39;desttable&#39;</span><span class="p">,</span> <span class="n">required</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

        <span class="n">regex_str</span> <span class="o">=</span> <span class="sa">r</span><span class="s2">&quot;&quot;&quot;</span>
<span class="s2">            ( </span><span class="si">{variable}</span><span class="s2"> )                     # 1. group for variable (thing being measured)</span>
<span class="s2">            </span><span class="si">{OPTIONAL_RESULTS_IGNORABLES}</span><span class="s2"></span>
<span class="s2">            </span><span class="si">{SCORE}</span><span class="s2">?                           # optional &quot;score&quot; or similar</span>
<span class="s2">            </span><span class="si">{OPTIONAL_RESULTS_IGNORABLES}</span><span class="s2"></span>
<span class="s2">            ( </span><span class="si">{TENSE_INDICATOR}</span><span class="s2"> )?             # 2. optional group for tense indicator</span>
<span class="s2">            </span><span class="si">{OPTIONAL_RESULTS_IGNORABLES}</span><span class="s2"></span>
<span class="s2">            ( </span><span class="si">{RELATION}</span><span class="s2"> )?                    # 3. optional group for relation</span>
<span class="s2">            </span><span class="si">{OPTIONAL_RESULTS_IGNORABLES}</span><span class="s2"></span>
<span class="s2">            ( </span><span class="si">{SIGNED_FLOAT}</span><span class="s2"> )                 # 4. group for numerator</span>
<span class="s2">            (?:                                # optional &quot;/ denominator&quot;</span>
<span class="s2">                \s* </span><span class="si">{OUT_OF_SEPARATOR}</span><span class="s2"> \s*</span>
<span class="s2">                ( </span><span class="si">{UNSIGNED_INTEGER}</span><span class="s2"> )         # 5. group for denominator</span>
<span class="s2">            )?</span>
<span class="s2">        &quot;&quot;&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>  <span class="c1"># noqa</span>
            <span class="n">variable</span><span class="o">=</span><span class="n">variable_regex_str</span><span class="p">,</span>
            <span class="n">OPTIONAL_RESULTS_IGNORABLES</span><span class="o">=</span><span class="n">OPTIONAL_RESULTS_IGNORABLES</span><span class="p">,</span>
            <span class="n">SCORE</span><span class="o">=</span><span class="n">SCORE</span><span class="p">,</span>
            <span class="n">TENSE_INDICATOR</span><span class="o">=</span><span class="n">TENSE_INDICATOR</span><span class="p">,</span>
            <span class="n">RELATION</span><span class="o">=</span><span class="n">RELATION</span><span class="p">,</span>
            <span class="n">SIGNED_FLOAT</span><span class="o">=</span><span class="n">SIGNED_FLOAT</span><span class="p">,</span>
            <span class="n">OUT_OF_SEPARATOR</span><span class="o">=</span><span class="n">OUT_OF_SEPARATOR</span><span class="p">,</span>
            <span class="n">UNSIGNED_INTEGER</span><span class="o">=</span><span class="n">UNSIGNED_INTEGER</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="k">if</span> <span class="n">debug</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Regex for </span><span class="si">{}</span><span class="s2">: </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="vm">__name__</span><span class="p">,</span> <span class="n">regex_str</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">regex_str</span> <span class="o">=</span> <span class="n">regex_str</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">compiled_regex</span> <span class="o">=</span> <span class="n">compile_regex</span><span class="p">(</span><span class="n">regex_str</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">print_info</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">file</span><span class="o">=</span><span class="n">sys</span><span class="o">.</span><span class="n">stdout</span><span class="p">):</span>
        <span class="nb">print</span><span class="p">(</span>
            <span class="s2">&quot;NLP class to find X-out-of-Y results. Regular expression: &quot;</span>
            <span class="s2">&quot;</span><span class="se">\n\n</span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">regex_str</span><span class="p">),</span> <span class="n">file</span><span class="o">=</span><span class="n">file</span><span class="p">)</span>

<div class="viewcode-block" id="NumeratorOutOfDenominatorParser.dest_tables_columns"><a class="viewcode-back" href="../../../autodoc/nlp_manager/regex_parser.html#crate_anon.nlp_manager.regex_parser.NumeratorOutOfDenominatorParser.dest_tables_columns">[docs]</a>    <span class="k">def</span> <span class="nf">dest_tables_columns</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">List</span><span class="p">[</span><span class="n">Column</span><span class="p">]]:</span>
        <span class="k">return</span> <span class="p">{</span><span class="bp">self</span><span class="o">.</span><span class="n">tablename</span><span class="p">:</span> <span class="p">[</span>
            <span class="n">Column</span><span class="p">(</span><span class="n">FN_VARIABLE_NAME</span><span class="p">,</span> <span class="n">SqlTypeDbIdentifier</span><span class="p">,</span>
                   <span class="n">doc</span><span class="o">=</span><span class="n">HELP_VARIABLE_NAME</span><span class="p">),</span>
            <span class="n">Column</span><span class="p">(</span><span class="n">FN_CONTENT</span><span class="p">,</span> <span class="n">Text</span><span class="p">,</span> <span class="n">doc</span><span class="o">=</span><span class="n">HELP_CONTENT</span><span class="p">),</span>
            <span class="n">Column</span><span class="p">(</span><span class="n">FN_START</span><span class="p">,</span> <span class="n">Integer</span><span class="p">,</span> <span class="n">doc</span><span class="o">=</span><span class="n">HELP_START</span><span class="p">),</span>
            <span class="n">Column</span><span class="p">(</span><span class="n">FN_END</span><span class="p">,</span> <span class="n">Integer</span><span class="p">,</span> <span class="n">doc</span><span class="o">=</span><span class="n">HELP_END</span><span class="p">),</span>
            <span class="n">Column</span><span class="p">(</span><span class="n">FN_VARIABLE_TEXT</span><span class="p">,</span> <span class="n">Text</span><span class="p">,</span> <span class="n">doc</span><span class="o">=</span><span class="n">HELP_VARIABLE_TEXT</span><span class="p">),</span>
            <span class="n">Column</span><span class="p">(</span><span class="n">FN_RELATION_TEXT</span><span class="p">,</span> <span class="n">String</span><span class="p">(</span><span class="n">MAX_RELATION_TEXT_LENGTH</span><span class="p">),</span>
                   <span class="n">doc</span><span class="o">=</span><span class="n">HELP_RELATION_TEXT</span><span class="p">),</span>
            <span class="n">Column</span><span class="p">(</span><span class="n">FN_RELATION</span><span class="p">,</span> <span class="n">String</span><span class="p">(</span><span class="n">MAX_RELATION_LENGTH</span><span class="p">),</span>
                   <span class="n">doc</span><span class="o">=</span><span class="n">HELP_RELATION</span><span class="p">),</span>
            <span class="n">Column</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">numerator_text_fieldname</span><span class="p">,</span>
                   <span class="n">String</span><span class="p">(</span><span class="n">MAX_VALUE_TEXT_LENGTH</span><span class="p">),</span>
                   <span class="n">doc</span><span class="o">=</span><span class="s2">&quot;Numerator, as text&quot;</span><span class="p">),</span>
            <span class="n">Column</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">numerator_fieldname</span><span class="p">,</span> <span class="n">Float</span><span class="p">,</span>
                   <span class="n">doc</span><span class="o">=</span><span class="s2">&quot;Numerator&quot;</span><span class="p">),</span>
            <span class="n">Column</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">denominator_text_fieldname</span><span class="p">,</span>
                   <span class="n">String</span><span class="p">(</span><span class="n">MAX_VALUE_TEXT_LENGTH</span><span class="p">),</span>
                   <span class="n">doc</span><span class="o">=</span><span class="s2">&quot;Denominator, as text&quot;</span><span class="p">),</span>
            <span class="n">Column</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">denominator_fieldname</span><span class="p">,</span> <span class="n">Float</span><span class="p">,</span>
                   <span class="n">doc</span><span class="o">=</span><span class="s2">&quot;Denominator&quot;</span><span class="p">),</span>
            <span class="n">Column</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">correct_numerator_fieldname</span><span class="p">,</span> <span class="n">Float</span><span class="p">,</span>
                   <span class="n">doc</span><span class="o">=</span><span class="s2">&quot;Numerator, if denominator is as expected (units are &quot;</span>
                       <span class="s2">&quot;correct)&quot;</span><span class="p">),</span>
            <span class="n">Column</span><span class="p">(</span><span class="n">FN_TENSE</span><span class="p">,</span> <span class="n">String</span><span class="p">(</span><span class="n">MAX_TENSE_LENGTH</span><span class="p">),</span> <span class="n">doc</span><span class="o">=</span><span class="n">HELP_TENSE</span><span class="p">),</span>
        <span class="p">]}</span></div>

<div class="viewcode-block" id="NumeratorOutOfDenominatorParser.parse"><a class="viewcode-back" href="../../../autodoc/nlp_manager/regex_parser.html#crate_anon.nlp_manager.regex_parser.NumeratorOutOfDenominatorParser.parse">[docs]</a>    <span class="k">def</span> <span class="nf">parse</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">text</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
              <span class="n">debug</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Generator</span><span class="p">[</span><span class="n">Tuple</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]],</span>
                                                <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">]:</span>
        <span class="sd">&quot;&quot;&quot;Default parser for NumeratorOutOfDenominatorParser.&quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">m</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">compiled_regex</span><span class="o">.</span><span class="n">finditer</span><span class="p">(</span><span class="n">text</span><span class="p">):</span>
            <span class="n">startpos</span> <span class="o">=</span> <span class="n">m</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>
            <span class="n">endpos</span> <span class="o">=</span> <span class="n">m</span><span class="o">.</span><span class="n">end</span><span class="p">()</span>
            <span class="c1"># groups = repr(m.groups())  # all matching groups</span>
            <span class="n">matching_text</span> <span class="o">=</span> <span class="n">m</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>  <span class="c1"># the whole thing</span>
            <span class="c1"># matching_text = text[startpos:endpos]  # same thing</span>

            <span class="n">variable_text</span> <span class="o">=</span> <span class="n">m</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
            <span class="n">tense_text</span> <span class="o">=</span> <span class="n">m</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
            <span class="n">relation_text</span> <span class="o">=</span> <span class="n">m</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
            <span class="n">numerator_text</span> <span class="o">=</span> <span class="n">m</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span>
            <span class="n">denominator_text</span> <span class="o">=</span> <span class="n">m</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>

            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">take_absolute</span><span class="p">:</span>
                <span class="n">numerator</span> <span class="o">=</span> <span class="n">to_pos_float</span><span class="p">(</span><span class="n">numerator_text</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">numerator</span> <span class="o">=</span> <span class="n">to_float</span><span class="p">(</span><span class="n">numerator_text</span><span class="p">)</span>
            <span class="n">denominator</span> <span class="o">=</span> <span class="n">to_float</span><span class="p">(</span><span class="n">denominator_text</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">numerator</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">log</span><span class="o">.</span><span class="n">critical</span><span class="p">(</span><span class="s2">&quot;bug - numerator is None, should be impossible&quot;</span><span class="p">)</span>
                <span class="k">continue</span>
            <span class="n">correct_numerator</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="k">if</span> <span class="n">denominator</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">numerator</span> <span class="o">&lt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">expected_denominator</span><span class="p">:</span>
                    <span class="n">correct_numerator</span> <span class="o">=</span> <span class="n">numerator</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">numerator</span> <span class="o">&lt;=</span> <span class="n">denominator</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">expected_denominator</span><span class="p">:</span>
                    <span class="n">correct_numerator</span> <span class="o">=</span> <span class="n">numerator</span>

            <span class="n">tense</span><span class="p">,</span> <span class="n">relation</span> <span class="o">=</span> <span class="n">common_tense</span><span class="p">(</span><span class="n">tense_text</span><span class="p">,</span> <span class="n">relation_text</span><span class="p">)</span>

            <span class="n">result</span> <span class="o">=</span> <span class="p">{</span>
                <span class="n">FN_VARIABLE_NAME</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">variable_name</span><span class="p">,</span>
                <span class="n">FN_CONTENT</span><span class="p">:</span> <span class="n">matching_text</span><span class="p">,</span>
                <span class="n">FN_START</span><span class="p">:</span> <span class="n">startpos</span><span class="p">,</span>
                <span class="n">FN_END</span><span class="p">:</span> <span class="n">endpos</span><span class="p">,</span>

                <span class="n">FN_VARIABLE_TEXT</span><span class="p">:</span> <span class="n">variable_text</span><span class="p">,</span>
                <span class="n">FN_RELATION_TEXT</span><span class="p">:</span> <span class="n">relation_text</span><span class="p">,</span>
                <span class="n">FN_RELATION</span><span class="p">:</span> <span class="n">relation</span><span class="p">,</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">numerator_text_fieldname</span><span class="p">:</span> <span class="n">numerator_text</span><span class="p">,</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">numerator_fieldname</span><span class="p">:</span> <span class="n">numerator</span><span class="p">,</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">denominator_text_fieldname</span><span class="p">:</span> <span class="n">denominator_text</span><span class="p">,</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">denominator_fieldname</span><span class="p">:</span> <span class="n">denominator</span><span class="p">,</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">correct_numerator_fieldname</span><span class="p">:</span> <span class="n">correct_numerator</span><span class="p">,</span>
                <span class="n">FN_TENSE_TEXT</span><span class="p">:</span> <span class="n">tense_text</span><span class="p">,</span>
                <span class="n">FN_TENSE</span><span class="p">:</span> <span class="n">tense</span><span class="p">,</span>
            <span class="p">}</span>
            <span class="c1"># log.critical(result)</span>
            <span class="k">if</span> <span class="n">debug</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Match </span><span class="si">{}</span><span class="s2"> for </span><span class="si">{}</span><span class="s2"> -&gt; </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">m</span><span class="p">,</span> <span class="nb">repr</span><span class="p">(</span><span class="n">text</span><span class="p">),</span> <span class="n">result</span><span class="p">))</span>
            <span class="k">yield</span> <span class="bp">self</span><span class="o">.</span><span class="n">tablename</span><span class="p">,</span> <span class="n">result</span></div>

<div class="viewcode-block" id="NumeratorOutOfDenominatorParser.test_numerator_denominator_parser"><a class="viewcode-back" href="../../../autodoc/nlp_manager/regex_parser.html#crate_anon.nlp_manager.regex_parser.NumeratorOutOfDenominatorParser.test_numerator_denominator_parser">[docs]</a>    <span class="k">def</span> <span class="nf">test_numerator_denominator_parser</span><span class="p">(</span>
            <span class="bp">self</span><span class="p">,</span>
            <span class="n">test_expected_list</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span>
                <span class="n">Tuple</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">List</span><span class="p">[</span><span class="n">Tuple</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="nb">float</span><span class="p">]]]</span>
            <span class="p">],</span>
            <span class="n">verbose</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        test_expected_list: list of tuples of (a) test string and</span>
<span class="sd">         (b) list of expected numerical (numerator, denominator) results, which</span>
<span class="sd">         can be an empty list</span>
<span class="sd">        Returns: none; will assert on failure</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Testing parser: </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="vm">__name__</span><span class="p">))</span>
        <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;... regex:</span><span class="se">\n</span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">regex_str</span><span class="p">))</span>
        <span class="k">for</span> <span class="n">test_string</span><span class="p">,</span> <span class="n">expected_values</span> <span class="ow">in</span> <span class="n">test_expected_list</span><span class="p">:</span>
            <span class="n">actual_values</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span>
                <span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">numerator_fieldname</span><span class="p">],</span> <span class="n">x</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">denominator_fieldname</span><span class="p">])</span>
                <span class="k">for</span> <span class="n">t</span><span class="p">,</span> <span class="n">x</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">parse</span><span class="p">(</span><span class="n">test_string</span><span class="p">)</span>
            <span class="p">)</span>
            <span class="k">assert</span> <span class="n">actual_values</span> <span class="o">==</span> <span class="n">expected_values</span><span class="p">,</span> <span class="p">(</span>
                <span class="s2">&quot;Parser </span><span class="si">{name}</span><span class="s2">: Expected </span><span class="si">{expected}</span><span class="s2">, got </span><span class="si">{actual}</span><span class="s2">, when &quot;</span>
                <span class="s2">&quot;parsing </span><span class="si">{test_string}</span><span class="s2">; full result:</span><span class="se">\n</span><span class="si">{full}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                    <span class="n">name</span><span class="o">=</span><span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="vm">__name__</span><span class="p">,</span>
                    <span class="n">expected</span><span class="o">=</span><span class="n">expected_values</span><span class="p">,</span>
                    <span class="n">actual</span><span class="o">=</span><span class="n">actual_values</span><span class="p">,</span>
                    <span class="n">test_string</span><span class="o">=</span><span class="nb">repr</span><span class="p">(</span><span class="n">test_string</span><span class="p">),</span>
                    <span class="n">full</span><span class="o">=</span><span class="nb">repr</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">parse</span><span class="p">(</span><span class="n">test_string</span><span class="p">))),</span>
                <span class="p">)</span>
            <span class="p">)</span></div></div>


<span class="c1"># =============================================================================</span>
<span class="c1">#  More general testing</span>
<span class="c1"># =============================================================================</span>

<div class="viewcode-block" id="ValidatorBase"><a class="viewcode-back" href="../../../autodoc/nlp_manager/regex_parser.html#crate_anon.nlp_manager.regex_parser.ValidatorBase">[docs]</a><span class="k">class</span> <span class="nc">ValidatorBase</span><span class="p">(</span><span class="n">BaseNlpParser</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;DO NOT USE DIRECTLY. Base class for validating regex parser sensitivity.</span>
<span class="sd">    The validator will find fields that refer to the variable, whether or not</span>
<span class="sd">    they meet the other criteria of the actual NLP processors (i.e. whether or</span>
<span class="sd">    not they contain a valid value). More explanation below.</span>

<span class="sd">    Suppose we&#39;re validating C-reactive protein (CRP). Key concepts:</span>
<span class="sd">        - source (true state of the world): Pr present, Ab absent</span>
<span class="sd">        - software decision: Y yes, N no</span>
<span class="sd">        - signal detection theory classification:</span>
<span class="sd">            hit = Pr &amp; Y = true positive</span>
<span class="sd">            miss = Pr &amp; N = false negative</span>
<span class="sd">            false alarm = Ab &amp; Y = false positive</span>
<span class="sd">            correct rejection = Ab &amp; N = true negative</span>
<span class="sd">        - common SDT metrics:</span>
<span class="sd">            positive predictive value, PPV = P(Pr | Y) = precision (*)</span>
<span class="sd">            negative predictive value, NPV = P(Ab | N)</span>
<span class="sd">            sensitivity = P(Y | Pr) = recall (*) = true positive rate</span>
<span class="sd">            specificity = P(N | Ab) = true negative rate</span>
<span class="sd">            (*) common names used in the NLP context.</span>
<span class="sd">        - other common classifier metric:</span>
<span class="sd">            F_beta score = (1 + beta^2) * precision * recall /</span>
<span class="sd">                           ((beta^2 * precision) + recall)</span>
<span class="sd">            ... which measures performance when you value recall beta times as</span>
<span class="sd">            much as precision; e.g. the F1 score when beta = 1. See</span>
<span class="sd">            https://en.wikipedia.org/wiki/F1_score</span>

<span class="sd">    Working from source to NLP, we can see there are a few types of &quot;absent&quot;:</span>
<span class="sd">        - X. unselected database field containing text</span>
<span class="sd">            - Q. field contains &quot;CRP&quot;, &quot;C-reactive protein&quot;, etc.; something</span>
<span class="sd">                that a human (or as a proxy: a machine) would judge as</span>
<span class="sd">                containing a textual reference to CRP.</span>
<span class="sd">                - Pr. Present: a human would judge that a CRP value is present,</span>
<span class="sd">                    e.g. &quot;today her CRP is 7, which I am not concerned about.&quot;</span>
<span class="sd">                    - H.  Hit: software reports the value.</span>
<span class="sd">                    - M.  Miss: software misses the value.</span>
<span class="sd">                        (maybe: &quot;his CRP was twenty-one&quot;.)</span>
<span class="sd">                - Ab1. Absent: reference to CRP, but no numerical information,</span>
<span class="sd">                    e.g. &quot;her CRP was normal&quot;.</span>
<span class="sd">                    - FA1. False alarm: software reports a numerical value.</span>
<span class="sd">                        (maybe: &quot;my CRP was 7 hours behind my boss&#39;s deadline&quot;)</span>
<span class="sd">                    - CR1. Correct rejection: software doesn&#39;t report a value.</span>
<span class="sd">            - Ab2. field contains no reference to CRP at all.</span>
<span class="sd">                    - FA2. False alarm: software reports a numerical value.</span>
<span class="sd">                        (a bit hard to think of examples...)</span>
<span class="sd">                    - CR2. Correct rejection: software doesn&#39;t report a value.</span>

<span class="sd">    From NLP backwards to source:</span>
<span class="sd">        - Y. Software says value present.</span>
<span class="sd">            - H. Hit: value is present.</span>
<span class="sd">            - FA. False alarm: value is absent.</span>
<span class="sd">        - N. Software says value absent.</span>
<span class="sd">            - CR. Correct rejection: value is absent.</span>
<span class="sd">            - M. Miss: value is present.</span>

<span class="sd">    The key metrics are:</span>
<span class="sd">        - precision = positive predictive value = P(Pr | Y)</span>
<span class="sd">            ... relatively easy to check; find all the &quot;Y&quot; records and check</span>
<span class="sd">            manually that they&#39;re correct.</span>
<span class="sd">        - sensitivity = recall = P(Y | Pr)</span>
<span class="sd">            ... Here, we want a sample that is enriched for &quot;symptom actually</span>
<span class="sd">            present&quot;, for human reasons. For example, if 0.1% of text entries</span>
<span class="sd">            refer to CRP, then to assess 100 &quot;Pr&quot; samples we would have to</span>
<span class="sd">            review 100,000 text records, 99,900 of which are completely</span>
<span class="sd">            irrelevant. So we want an automated way of finding &quot;Pr&quot; records.</span>
<span class="sd">            That&#39;s what the validator classes do.</span>

<span class="sd">    You can enrich for &quot;Pr&quot; records with SQL, e.g.</span>
<span class="sd">        SELECT textfield FROM sometable WHERE (</span>
<span class="sd">            textfield LIKE &#39;%CRP%&#39;</span>
<span class="sd">            OR textfield LIKE &#39;%C-reactive protein%&#39;);</span>
<span class="sd">    or similar, but really we want the best &quot;CRP detector&quot; possible. That is</span>
<span class="sd">    probably to use a regex, either in SQL (... &quot;WHERE textfield REGEX</span>
<span class="sd">    &#39;myregex&#39;&quot;) or using these validator classes. (The main NLP regexes don&#39;t</span>
<span class="sd">    distinguish between &quot;CRP present, no valid value&quot; and &quot;CRP absent&quot;,</span>
<span class="sd">    because regexes either match or don&#39;t.)</span>

<span class="sd">    Each validator class implements the core variable-finding part of its</span>
<span class="sd">    corresponding NLP regex class, but without the value or units. For example,</span>
<span class="sd">    the CRP class looks for things like &quot;CRP is 6&quot; or &quot;CRP 20 mg/L&quot;, whereas</span>
<span class="sd">    the CRP validator looks for things like &quot;CRP&quot;.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
                 <span class="n">nlpdef</span><span class="p">:</span> <span class="n">NlpDefinition</span><span class="p">,</span>
                 <span class="n">cfgsection</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
                 <span class="n">regex_str_list</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span>
                 <span class="n">validated_variable</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
                 <span class="n">commit</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        This class operates with compiled regexes having this group format:</span>
<span class="sd">          - variable</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">nlpdef</span><span class="o">=</span><span class="n">nlpdef</span><span class="p">,</span> <span class="n">cfgsection</span><span class="o">=</span><span class="n">cfgsection</span><span class="p">,</span> <span class="n">commit</span><span class="o">=</span><span class="n">commit</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">regex_str_list</span> <span class="o">=</span> <span class="n">regex_str_list</span>  <span class="c1"># for debugging only</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">compiled_regex_list</span> <span class="o">=</span> <span class="p">[</span><span class="n">compile_regex</span><span class="p">(</span><span class="n">r</span><span class="p">)</span> <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="n">regex_str_list</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">variable</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">{}</span><span class="s2">_validator&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">validated_variable</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">NAME</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">variable</span>

        <span class="k">if</span> <span class="n">nlpdef</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>  <span class="c1"># only None for debugging!</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">tablename</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">tablename</span> <span class="o">=</span> <span class="n">nlpdef</span><span class="o">.</span><span class="n">opt_str</span><span class="p">(</span>
                <span class="n">cfgsection</span><span class="p">,</span> <span class="s1">&#39;desttable&#39;</span><span class="p">,</span> <span class="n">required</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">print_info</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">file</span><span class="o">=</span><span class="n">sys</span><span class="o">.</span><span class="n">stdout</span><span class="p">):</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;NLP class to validate other NLP processors. Regular &quot;</span>
              <span class="s2">&quot;expressions:</span><span class="se">\n\n</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">file</span><span class="o">=</span><span class="n">file</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">regex_str_list</span><span class="p">),</span> <span class="n">file</span><span class="o">=</span><span class="n">file</span><span class="p">)</span>

<div class="viewcode-block" id="ValidatorBase.set_tablename"><a class="viewcode-back" href="../../../autodoc/nlp_manager/regex_parser.html#crate_anon.nlp_manager.regex_parser.ValidatorBase.set_tablename">[docs]</a>    <span class="k">def</span> <span class="nf">set_tablename</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">tablename</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;In case a friend class wants to override.&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tablename</span> <span class="o">=</span> <span class="n">tablename</span></div>

<div class="viewcode-block" id="ValidatorBase.dest_tables_columns"><a class="viewcode-back" href="../../../autodoc/nlp_manager/regex_parser.html#crate_anon.nlp_manager.regex_parser.ValidatorBase.dest_tables_columns">[docs]</a>    <span class="k">def</span> <span class="nf">dest_tables_columns</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">List</span><span class="p">[</span><span class="n">Column</span><span class="p">]]:</span>
        <span class="k">return</span> <span class="p">{</span><span class="bp">self</span><span class="o">.</span><span class="n">tablename</span><span class="p">:</span> <span class="p">[</span>
            <span class="n">Column</span><span class="p">(</span><span class="n">FN_VARIABLE_NAME</span><span class="p">,</span> <span class="n">SqlTypeDbIdentifier</span><span class="p">,</span>
                   <span class="n">doc</span><span class="o">=</span><span class="n">HELP_VARIABLE_NAME</span><span class="p">),</span>
            <span class="n">Column</span><span class="p">(</span><span class="n">FN_CONTENT</span><span class="p">,</span> <span class="n">Text</span><span class="p">,</span> <span class="n">doc</span><span class="o">=</span><span class="n">HELP_CONTENT</span><span class="p">),</span>
            <span class="n">Column</span><span class="p">(</span><span class="n">FN_START</span><span class="p">,</span> <span class="n">Integer</span><span class="p">,</span> <span class="n">doc</span><span class="o">=</span><span class="n">HELP_START</span><span class="p">),</span>
            <span class="n">Column</span><span class="p">(</span><span class="n">FN_END</span><span class="p">,</span> <span class="n">Integer</span><span class="p">,</span> <span class="n">doc</span><span class="o">=</span><span class="n">HELP_END</span><span class="p">),</span>
        <span class="p">]}</span></div>

<div class="viewcode-block" id="ValidatorBase.parse"><a class="viewcode-back" href="../../../autodoc/nlp_manager/regex_parser.html#crate_anon.nlp_manager.regex_parser.ValidatorBase.parse">[docs]</a>    <span class="k">def</span> <span class="nf">parse</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">text</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Generator</span><span class="p">[</span><span class="n">Tuple</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]],</span>
                                            <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">]:</span>
        <span class="sd">&quot;&quot;&quot;Parser for ValidatorBase.&quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">compiled_regex</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">compiled_regex_list</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">m</span> <span class="ow">in</span> <span class="n">compiled_regex</span><span class="o">.</span><span class="n">finditer</span><span class="p">(</span><span class="n">text</span><span class="p">):</span>
                <span class="n">startpos</span> <span class="o">=</span> <span class="n">m</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>
                <span class="n">endpos</span> <span class="o">=</span> <span class="n">m</span><span class="o">.</span><span class="n">end</span><span class="p">()</span>
                <span class="c1"># groups = repr(m.groups())  # all matching groups</span>
                <span class="n">matching_text</span> <span class="o">=</span> <span class="n">m</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>  <span class="c1"># the whole thing</span>
                <span class="c1"># matching_text = text[startpos:endpos]  # same thing</span>

                <span class="k">yield</span> <span class="bp">self</span><span class="o">.</span><span class="n">tablename</span><span class="p">,</span> <span class="p">{</span>
                    <span class="n">FN_VARIABLE_NAME</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">variable</span><span class="p">,</span>
                    <span class="n">FN_CONTENT</span><span class="p">:</span> <span class="n">matching_text</span><span class="p">,</span>
                    <span class="n">FN_START</span><span class="p">:</span> <span class="n">startpos</span><span class="p">,</span>
                    <span class="n">FN_END</span><span class="p">:</span> <span class="n">endpos</span><span class="p">,</span>
                <span class="p">}</span></div>

<div class="viewcode-block" id="ValidatorBase.test_validator"><a class="viewcode-back" href="../../../autodoc/nlp_manager/regex_parser.html#crate_anon.nlp_manager.regex_parser.ValidatorBase.test_validator">[docs]</a>    <span class="k">def</span> <span class="nf">test_validator</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">test_expected_list</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">Tuple</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">bool</span><span class="p">]],</span>
                       <span class="n">verbose</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        The &#39;bool&#39; part of test_expected_list is: should it match any?</span>
<span class="sd">        ... noting that &quot;match anywhere&quot; is the &quot;search&quot; function, whereas</span>
<span class="sd">            &quot;match&quot; matches at the beginning:</span>
<span class="sd">            https://docs.python.org/3/library/re.html#re.regex.match</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Testing validator: </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="vm">__name__</span><span class="p">))</span>
        <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
            <span class="n">n</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">regex_str_list</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">r</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">regex_str_list</span><span class="p">):</span>
                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;... regex #</span><span class="si">{i}</span><span class="s2">/</span><span class="si">{n}</span><span class="s2">: </span><span class="si">{r}</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">i</span><span class="o">=</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">n</span><span class="o">=</span><span class="n">n</span><span class="p">,</span> <span class="n">r</span><span class="o">=</span><span class="n">r</span><span class="p">))</span>
        <span class="k">for</span> <span class="n">test_string</span><span class="p">,</span> <span class="n">expected_match</span> <span class="ow">in</span> <span class="n">test_expected_list</span><span class="p">:</span>
            <span class="n">actual_match</span> <span class="o">=</span> <span class="nb">any</span><span class="p">(</span><span class="n">r</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="n">test_string</span><span class="p">)</span>
                               <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">compiled_regex_list</span><span class="p">)</span>
            <span class="k">assert</span> <span class="n">actual_match</span> <span class="o">==</span> <span class="n">expected_match</span><span class="p">,</span> <span class="p">(</span>
                <span class="s2">&quot;Validator </span><span class="si">{name}</span><span class="s2">: Expected &#39;any search&#39;=</span><span class="si">{expected}</span><span class="s2">, got &quot;</span>
                <span class="s2">&quot;</span><span class="si">{actual}</span><span class="s2">, when parsing </span><span class="si">{test_string}</span><span class="s2">; full=</span><span class="si">{full}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                    <span class="n">name</span><span class="o">=</span><span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="vm">__name__</span><span class="p">,</span>
                    <span class="n">expected</span><span class="o">=</span><span class="n">expected_match</span><span class="p">,</span>
                    <span class="n">actual</span><span class="o">=</span><span class="n">actual_match</span><span class="p">,</span>
                    <span class="n">test_string</span><span class="o">=</span><span class="nb">repr</span><span class="p">(</span><span class="n">test_string</span><span class="p">),</span>
                    <span class="n">full</span><span class="o">=</span><span class="nb">list</span><span class="p">(</span><span class="n">r</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="n">test_string</span><span class="p">)</span>
                              <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">compiled_regex_list</span><span class="p">),</span>
                <span class="p">)</span>
            <span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;... OK&quot;</span><span class="p">)</span></div>

    <span class="k">def</span> <span class="nf">test</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">verbose</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;... no tests implemented for validator </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
            <span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="vm">__name__</span><span class="p">))</span></div>


<span class="c1"># =============================================================================</span>
<span class="c1">#  More general testing</span>
<span class="c1"># =============================================================================</span>

<span class="k">def</span> <span class="nf">learning_alternative_regex_groups</span><span class="p">():</span>
    <span class="n">regex_str</span> <span class="o">=</span> <span class="sa">r</span><span class="s2">&quot;&quot;&quot;</span>
<span class="s2">        (</span>
<span class="s2">            (?:</span>
<span class="s2">                \s*</span>
<span class="s2">                (?: (a) | (b) | (c) | (d) )</span>
<span class="s2">                \s*</span>
<span class="s2">            )*</span>
<span class="s2">            ( fish )?</span>
<span class="s2">        )</span>
<span class="s2">    &quot;&quot;&quot;</span>
    <span class="n">compiled_regex</span> <span class="o">=</span> <span class="n">compile_regex</span><span class="p">(</span><span class="n">regex_str</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">test_str</span> <span class="ow">in</span> <span class="p">(</span><span class="s2">&quot;a&quot;</span><span class="p">,</span> <span class="s2">&quot;b&quot;</span><span class="p">,</span> <span class="s2">&quot;a c&quot;</span><span class="p">,</span> <span class="s2">&quot;d&quot;</span><span class="p">,</span> <span class="s2">&quot;e&quot;</span><span class="p">,</span> <span class="s2">&quot;a fish&quot;</span><span class="p">,</span> <span class="s2">&quot;c c c&quot;</span><span class="p">):</span>
        <span class="n">m</span> <span class="o">=</span> <span class="n">compiled_regex</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="n">test_str</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Match: </span><span class="si">{}</span><span class="s2">; groups: </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">m</span><span class="p">,</span> <span class="n">m</span><span class="o">.</span><span class="n">groups</span><span class="p">()))</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    So:</span>
<span class="sd">        - groups can overlap</span>
<span class="sd">        - groups are ordered by their opening bracket</span>
<span class="sd">        - matches are filled in neatly</span>
<span class="sd">    &quot;&quot;&quot;</span>


<span class="k">def</span> <span class="nf">test_base_regexes</span><span class="p">(</span><span class="n">verbose</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
    <span class="c1"># -------------------------------------------------------------------------</span>
    <span class="c1"># Operators, etc.</span>
    <span class="c1"># -------------------------------------------------------------------------</span>
    <span class="n">test_text_regex</span><span class="p">(</span><span class="s2">&quot;MULTIPLY&quot;</span><span class="p">,</span> <span class="n">MULTIPLY</span><span class="p">,</span> <span class="p">[</span>
        <span class="p">(</span><span class="s2">&quot;a * b&quot;</span><span class="p">,</span> <span class="p">[</span><span class="s2">&quot;*&quot;</span><span class="p">]),</span>
        <span class="p">(</span><span class="s2">&quot;a x b&quot;</span><span class="p">,</span> <span class="p">[</span><span class="s2">&quot;x&quot;</span><span class="p">]),</span>
        <span class="p">(</span><span class="s2">&quot;a × b&quot;</span><span class="p">,</span> <span class="p">[</span><span class="s2">&quot;×&quot;</span><span class="p">]),</span>
        <span class="p">(</span><span class="s2">&quot;a ⋅ b&quot;</span><span class="p">,</span> <span class="p">[</span><span class="s2">&quot;⋅&quot;</span><span class="p">]),</span>
        <span class="p">(</span><span class="s2">&quot;a blah b&quot;</span><span class="p">,</span> <span class="p">[]),</span>
    <span class="p">],</span> <span class="n">verbose</span><span class="o">=</span><span class="n">verbose</span><span class="p">)</span>
    <span class="n">test_text_regex</span><span class="p">(</span><span class="s2">&quot;POWER&quot;</span><span class="p">,</span> <span class="n">POWER</span><span class="p">,</span> <span class="p">[</span>
        <span class="p">(</span><span class="s2">&quot;a ^ b&quot;</span><span class="p">,</span> <span class="p">[</span><span class="s2">&quot;^&quot;</span><span class="p">]),</span>
        <span class="p">(</span><span class="s2">&quot;a ** b&quot;</span><span class="p">,</span> <span class="p">[</span><span class="s2">&quot;**&quot;</span><span class="p">]),</span>
        <span class="p">(</span><span class="s2">&quot;10e5&quot;</span><span class="p">,</span> <span class="p">[]),</span>
        <span class="p">(</span><span class="s2">&quot;10E5&quot;</span><span class="p">,</span> <span class="p">[]),</span>
        <span class="p">(</span><span class="s2">&quot;a blah b&quot;</span><span class="p">,</span> <span class="p">[]),</span>
    <span class="p">],</span> <span class="n">verbose</span><span class="o">=</span><span class="n">verbose</span><span class="p">)</span>
    <span class="n">test_text_regex</span><span class="p">(</span><span class="s2">&quot;POWER_INC_E&quot;</span><span class="p">,</span> <span class="n">POWER_INC_E</span><span class="p">,</span> <span class="p">[</span>
        <span class="p">(</span><span class="s2">&quot;a ^ b&quot;</span><span class="p">,</span> <span class="p">[</span><span class="s2">&quot;^&quot;</span><span class="p">]),</span>
        <span class="p">(</span><span class="s2">&quot;a ** b&quot;</span><span class="p">,</span> <span class="p">[</span><span class="s2">&quot;**&quot;</span><span class="p">]),</span>
        <span class="p">(</span><span class="s2">&quot;10e5&quot;</span><span class="p">,</span> <span class="p">[</span><span class="s2">&quot;e&quot;</span><span class="p">]),</span>
        <span class="p">(</span><span class="s2">&quot;10E5&quot;</span><span class="p">,</span> <span class="p">[</span><span class="s2">&quot;E&quot;</span><span class="p">]),</span>
        <span class="p">(</span><span class="s2">&quot;a blah b&quot;</span><span class="p">,</span> <span class="p">[]),</span>
    <span class="p">],</span> <span class="n">verbose</span><span class="o">=</span><span class="n">verbose</span><span class="p">)</span>
    <span class="n">test_text_regex</span><span class="p">(</span><span class="s2">&quot;BILLION&quot;</span><span class="p">,</span> <span class="n">BILLION</span><span class="p">,</span> <span class="p">[</span>
        <span class="p">(</span><span class="s2">&quot;10 x 10^9/l&quot;</span><span class="p">,</span> <span class="p">[</span><span class="s2">&quot;x 10^9&quot;</span><span class="p">]),</span>
    <span class="p">],</span> <span class="n">verbose</span><span class="o">=</span><span class="n">verbose</span><span class="p">)</span>
    <span class="n">test_text_regex</span><span class="p">(</span><span class="s2">&quot;PLUS_SIGN&quot;</span><span class="p">,</span> <span class="n">PLUS_SIGN</span><span class="p">,</span> <span class="p">[</span>
        <span class="p">(</span><span class="s2">&quot;a + b&quot;</span><span class="p">,</span> <span class="p">[</span><span class="s2">&quot;+&quot;</span><span class="p">]),</span>
        <span class="p">(</span><span class="s2">&quot;a blah b&quot;</span><span class="p">,</span> <span class="p">[]),</span>
    <span class="p">],</span> <span class="n">verbose</span><span class="o">=</span><span class="n">verbose</span><span class="p">)</span>
    <span class="n">test_text_regex</span><span class="p">(</span><span class="s2">&quot;MINUS_SIGN&quot;</span><span class="p">,</span> <span class="n">MINUS_SIGN</span><span class="p">,</span> <span class="p">[</span>
        <span class="c1"># good:</span>
        <span class="p">(</span><span class="s2">&quot;a - b&quot;</span><span class="p">,</span> <span class="p">[</span><span class="s2">&quot;-&quot;</span><span class="p">]),</span>  <span class="c1"># ASCII hyphen-minus</span>
        <span class="p">(</span><span class="s2">&quot;a − b&quot;</span><span class="p">,</span> <span class="p">[</span><span class="s2">&quot;−&quot;</span><span class="p">]),</span>  <span class="c1"># Unicode minus</span>
        <span class="p">(</span><span class="s2">&quot;a – b&quot;</span><span class="p">,</span> <span class="p">[</span><span class="s2">&quot;–&quot;</span><span class="p">]),</span>  <span class="c1"># en dash</span>
        <span class="c1"># bad:</span>
        <span class="p">(</span><span class="s2">&quot;a — b&quot;</span><span class="p">,</span> <span class="p">[]),</span>  <span class="c1"># em dash</span>
        <span class="p">(</span><span class="s2">&quot;a ‐ b&quot;</span><span class="p">,</span> <span class="p">[]),</span>  <span class="c1"># Unicode formal hyphen</span>
        <span class="p">(</span><span class="s2">&quot;a blah b&quot;</span><span class="p">,</span> <span class="p">[]),</span>
    <span class="p">],</span> <span class="n">verbose</span><span class="o">=</span><span class="n">verbose</span><span class="p">)</span>
    <span class="c1"># Can&#39;t test optional regexes very easily! They match nothing.</span>
    <span class="n">test_text_regex</span><span class="p">(</span><span class="s2">&quot;SIGN&quot;</span><span class="p">,</span> <span class="n">SIGN</span><span class="p">,</span> <span class="p">[</span>
        <span class="c1"># good:</span>
        <span class="p">(</span><span class="s2">&quot;a + b&quot;</span><span class="p">,</span> <span class="p">[</span><span class="s2">&quot;+&quot;</span><span class="p">]),</span>
        <span class="p">(</span><span class="s2">&quot;a - b&quot;</span><span class="p">,</span> <span class="p">[</span><span class="s2">&quot;-&quot;</span><span class="p">]),</span>  <span class="c1"># ASCII hyphen-minus</span>
        <span class="p">(</span><span class="s2">&quot;a − b&quot;</span><span class="p">,</span> <span class="p">[</span><span class="s2">&quot;−&quot;</span><span class="p">]),</span>  <span class="c1"># Unicode minus</span>
        <span class="p">(</span><span class="s2">&quot;a – b&quot;</span><span class="p">,</span> <span class="p">[</span><span class="s2">&quot;–&quot;</span><span class="p">]),</span>  <span class="c1"># en dash</span>
        <span class="c1"># bad:</span>
        <span class="p">(</span><span class="s2">&quot;a — b&quot;</span><span class="p">,</span> <span class="p">[]),</span>  <span class="c1"># em dash</span>
        <span class="p">(</span><span class="s2">&quot;a ‐ b&quot;</span><span class="p">,</span> <span class="p">[]),</span>  <span class="c1"># Unicode formal hyphen</span>
        <span class="p">(</span><span class="s2">&quot;a blah b&quot;</span><span class="p">,</span> <span class="p">[]),</span>
    <span class="p">],</span> <span class="n">verbose</span><span class="o">=</span><span class="n">verbose</span><span class="p">)</span>

    <span class="c1"># -------------------------------------------------------------------------</span>
    <span class="c1"># Number elements</span>
    <span class="c1"># -------------------------------------------------------------------------</span>
    <span class="n">test_text_regex</span><span class="p">(</span><span class="s2">&quot;PLAIN_INTEGER&quot;</span><span class="p">,</span> <span class="n">PLAIN_INTEGER</span><span class="p">,</span> <span class="p">[</span>
        <span class="p">(</span><span class="s2">&quot;a 1234 b&quot;</span><span class="p">,</span> <span class="p">[</span><span class="s2">&quot;1234&quot;</span><span class="p">]),</span>
        <span class="p">(</span><span class="s2">&quot;a 1234.5 b&quot;</span><span class="p">,</span> <span class="p">[</span><span class="s2">&quot;1234&quot;</span><span class="p">,</span> <span class="s2">&quot;5&quot;</span><span class="p">]),</span>
        <span class="p">(</span><span class="s2">&quot;a 12,000 b&quot;</span><span class="p">,</span> <span class="p">[</span><span class="s2">&quot;12&quot;</span><span class="p">,</span> <span class="s2">&quot;000&quot;</span><span class="p">]),</span>
    <span class="p">],</span> <span class="n">verbose</span><span class="o">=</span><span class="n">verbose</span><span class="p">)</span>
    <span class="n">test_text_regex</span><span class="p">(</span>
        <span class="s2">&quot;PLAIN_INTEGER_W_THOUSAND_COMMAS&quot;</span><span class="p">,</span>
        <span class="n">PLAIN_INTEGER_W_THOUSAND_COMMAS</span><span class="p">,</span>
        <span class="p">[</span>
            <span class="p">(</span><span class="s2">&quot;a 1234 b&quot;</span><span class="p">,</span> <span class="p">[</span><span class="s2">&quot;1234&quot;</span><span class="p">]),</span>
            <span class="p">(</span><span class="s2">&quot;a 1234.5 b&quot;</span><span class="p">,</span> <span class="p">[</span><span class="s2">&quot;1234&quot;</span><span class="p">,</span> <span class="s2">&quot;5&quot;</span><span class="p">]),</span>
            <span class="p">(</span><span class="s2">&quot;a 12,000 b&quot;</span><span class="p">,</span> <span class="p">[</span><span class="s2">&quot;12,000&quot;</span><span class="p">]),</span>
        <span class="p">],</span>
        <span class="n">verbose</span><span class="o">=</span><span class="n">verbose</span>
    <span class="p">)</span>
    <span class="n">test_text_regex</span><span class="p">(</span>
        <span class="s2">&quot;SCIENTIFIC_NOTATION_EXPONENT&quot;</span><span class="p">,</span>
        <span class="n">SCIENTIFIC_NOTATION_EXPONENT</span><span class="p">,</span>
        <span class="p">[</span>
            <span class="p">(</span><span class="s2">&quot;a 1234 b&quot;</span><span class="p">,</span> <span class="p">[]),</span>
            <span class="p">(</span><span class="s2">&quot;E-4&quot;</span><span class="p">,</span> <span class="p">[</span><span class="s2">&quot;E-4&quot;</span><span class="p">]),</span>
            <span class="p">(</span><span class="s2">&quot;e15&quot;</span><span class="p">,</span> <span class="p">[</span><span class="s2">&quot;e15&quot;</span><span class="p">]),</span>
            <span class="p">(</span><span class="s2">&quot;e15.3&quot;</span><span class="p">,</span> <span class="p">[</span><span class="s2">&quot;e15&quot;</span><span class="p">]),</span>
        <span class="p">],</span>
        <span class="n">verbose</span><span class="o">=</span><span class="n">verbose</span>
    <span class="p">)</span>

    <span class="c1"># -------------------------------------------------------------------------</span>
    <span class="c1"># Number types</span>
    <span class="c1"># -------------------------------------------------------------------------</span>

    <span class="n">test_text_regex</span><span class="p">(</span><span class="s2">&quot;UNSIGNED_INTEGER&quot;</span><span class="p">,</span> <span class="n">UNSIGNED_INTEGER</span><span class="p">,</span> <span class="p">[</span>
        <span class="p">(</span><span class="s2">&quot;1&quot;</span><span class="p">,</span> <span class="p">[</span><span class="s2">&quot;1&quot;</span><span class="p">]),</span>
        <span class="p">(</span><span class="s2">&quot;12345&quot;</span><span class="p">,</span> <span class="p">[</span><span class="s2">&quot;12345&quot;</span><span class="p">]),</span>
        <span class="p">(</span><span class="s2">&quot;-1&quot;</span><span class="p">,</span> <span class="p">[</span><span class="s2">&quot;1&quot;</span><span class="p">]),</span>  <span class="c1"># will drop sign</span>
        <span class="p">(</span><span class="s2">&quot;1.2&quot;</span><span class="p">,</span> <span class="p">[</span><span class="s2">&quot;1&quot;</span><span class="p">,</span> <span class="s2">&quot;2&quot;</span><span class="p">]),</span>
        <span class="p">(</span><span class="s2">&quot;-3.4&quot;</span><span class="p">,</span> <span class="p">[</span><span class="s2">&quot;3&quot;</span><span class="p">,</span> <span class="s2">&quot;4&quot;</span><span class="p">]),</span>
        <span class="p">(</span><span class="s2">&quot;+3.4&quot;</span><span class="p">,</span> <span class="p">[</span><span class="s2">&quot;3&quot;</span><span class="p">,</span> <span class="s2">&quot;4&quot;</span><span class="p">]),</span>
        <span class="p">(</span><span class="s2">&quot;-3.4e27.3&quot;</span><span class="p">,</span> <span class="p">[</span><span class="s2">&quot;3&quot;</span><span class="p">,</span> <span class="s2">&quot;4&quot;</span><span class="p">,</span> <span class="s2">&quot;27&quot;</span><span class="p">,</span> <span class="s2">&quot;3&quot;</span><span class="p">]),</span>
        <span class="p">(</span><span class="s2">&quot;3.4e-27&quot;</span><span class="p">,</span> <span class="p">[</span><span class="s2">&quot;3&quot;</span><span class="p">,</span> <span class="s2">&quot;4&quot;</span><span class="p">,</span> <span class="s2">&quot;27&quot;</span><span class="p">]),</span>
        <span class="p">(</span><span class="s2">&quot;9,800&quot;</span><span class="p">,</span> <span class="p">[</span><span class="s2">&quot;9,800&quot;</span><span class="p">]),</span>
        <span class="p">(</span><span class="s2">&quot;17,600.34&quot;</span><span class="p">,</span> <span class="p">[</span><span class="s2">&quot;17,600&quot;</span><span class="p">,</span> <span class="s2">&quot;34&quot;</span><span class="p">]),</span>
        <span class="p">(</span><span class="s2">&quot;-17,300.6588&quot;</span><span class="p">,</span> <span class="p">[</span><span class="s2">&quot;17,300&quot;</span><span class="p">,</span> <span class="s2">&quot;6588&quot;</span><span class="p">]),</span>
    <span class="p">],</span> <span class="n">verbose</span><span class="o">=</span><span class="n">verbose</span><span class="p">)</span>
    <span class="n">test_text_regex</span><span class="p">(</span><span class="s2">&quot;SIGNED_INTEGER&quot;</span><span class="p">,</span> <span class="n">SIGNED_INTEGER</span><span class="p">,</span> <span class="p">[</span>
        <span class="p">(</span><span class="s2">&quot;1&quot;</span><span class="p">,</span> <span class="p">[</span><span class="s2">&quot;1&quot;</span><span class="p">]),</span>
        <span class="p">(</span><span class="s2">&quot;12345&quot;</span><span class="p">,</span> <span class="p">[</span><span class="s2">&quot;12345&quot;</span><span class="p">]),</span>
        <span class="p">(</span><span class="s2">&quot;-1&quot;</span><span class="p">,</span> <span class="p">[</span><span class="s2">&quot;-1&quot;</span><span class="p">]),</span>
        <span class="p">(</span><span class="s2">&quot;1.2&quot;</span><span class="p">,</span> <span class="p">[</span><span class="s2">&quot;1&quot;</span><span class="p">,</span> <span class="s2">&quot;2&quot;</span><span class="p">]),</span>
        <span class="p">(</span><span class="s2">&quot;-3.4&quot;</span><span class="p">,</span> <span class="p">[</span><span class="s2">&quot;-3&quot;</span><span class="p">,</span> <span class="s2">&quot;4&quot;</span><span class="p">]),</span>
        <span class="p">(</span><span class="s2">&quot;+3.4&quot;</span><span class="p">,</span> <span class="p">[</span><span class="s2">&quot;+3&quot;</span><span class="p">,</span> <span class="s2">&quot;4&quot;</span><span class="p">]),</span>
        <span class="p">(</span><span class="s2">&quot;-3.4e27.3&quot;</span><span class="p">,</span> <span class="p">[</span><span class="s2">&quot;-3&quot;</span><span class="p">,</span> <span class="s2">&quot;4&quot;</span><span class="p">,</span> <span class="s2">&quot;27&quot;</span><span class="p">,</span> <span class="s2">&quot;3&quot;</span><span class="p">]),</span>
        <span class="p">(</span><span class="s2">&quot;3.4e-27&quot;</span><span class="p">,</span> <span class="p">[</span><span class="s2">&quot;3&quot;</span><span class="p">,</span> <span class="s2">&quot;4&quot;</span><span class="p">,</span> <span class="s2">&quot;-27&quot;</span><span class="p">]),</span>
        <span class="p">(</span><span class="s2">&quot;9,800&quot;</span><span class="p">,</span> <span class="p">[</span><span class="s2">&quot;9,800&quot;</span><span class="p">]),</span>
        <span class="p">(</span><span class="s2">&quot;17,600.34&quot;</span><span class="p">,</span> <span class="p">[</span><span class="s2">&quot;17,600&quot;</span><span class="p">,</span> <span class="s2">&quot;34&quot;</span><span class="p">]),</span>
        <span class="p">(</span><span class="s2">&quot;-17,300.6588&quot;</span><span class="p">,</span> <span class="p">[</span><span class="s2">&quot;-17,300&quot;</span><span class="p">,</span> <span class="s2">&quot;6588&quot;</span><span class="p">]),</span>
    <span class="p">],</span> <span class="n">verbose</span><span class="o">=</span><span class="n">verbose</span><span class="p">)</span>
    <span class="n">test_text_regex</span><span class="p">(</span><span class="s2">&quot;UNSIGNED_FLOAT&quot;</span><span class="p">,</span> <span class="n">UNSIGNED_FLOAT</span><span class="p">,</span> <span class="p">[</span>
        <span class="p">(</span><span class="s2">&quot;1&quot;</span><span class="p">,</span> <span class="p">[</span><span class="s2">&quot;1&quot;</span><span class="p">]),</span>
        <span class="p">(</span><span class="s2">&quot;12345&quot;</span><span class="p">,</span> <span class="p">[</span><span class="s2">&quot;12345&quot;</span><span class="p">]),</span>
        <span class="p">(</span><span class="s2">&quot;-1&quot;</span><span class="p">,</span> <span class="p">[</span><span class="s2">&quot;1&quot;</span><span class="p">]),</span>
        <span class="p">(</span><span class="s2">&quot;1.2&quot;</span><span class="p">,</span> <span class="p">[</span><span class="s2">&quot;1.2&quot;</span><span class="p">]),</span>
        <span class="p">(</span><span class="s2">&quot;-3.4&quot;</span><span class="p">,</span> <span class="p">[</span><span class="s2">&quot;3.4&quot;</span><span class="p">]),</span>
        <span class="p">(</span><span class="s2">&quot;+3.4&quot;</span><span class="p">,</span> <span class="p">[</span><span class="s2">&quot;+3.4&quot;</span><span class="p">]),</span>
        <span class="p">(</span><span class="s2">&quot;-3.4e27.3&quot;</span><span class="p">,</span> <span class="p">[</span><span class="s2">&quot;3.4&quot;</span><span class="p">,</span> <span class="s2">&quot;27.3&quot;</span><span class="p">]),</span>
        <span class="p">(</span><span class="s2">&quot;3.4e-27&quot;</span><span class="p">,</span> <span class="p">[</span><span class="s2">&quot;3.4&quot;</span><span class="p">,</span> <span class="s2">&quot;27&quot;</span><span class="p">]),</span>
        <span class="p">(</span><span class="s2">&quot;9,800&quot;</span><span class="p">,</span> <span class="p">[</span><span class="s2">&quot;9,800&quot;</span><span class="p">]),</span>
        <span class="p">(</span><span class="s2">&quot;17,600.34&quot;</span><span class="p">,</span> <span class="p">[</span><span class="s2">&quot;17,600.34&quot;</span><span class="p">]),</span>
        <span class="p">(</span><span class="s2">&quot;-17,300.6588&quot;</span><span class="p">,</span> <span class="p">[</span><span class="s2">&quot;17,300.6588&quot;</span><span class="p">]),</span>
    <span class="p">],</span> <span class="n">verbose</span><span class="o">=</span><span class="n">verbose</span><span class="p">)</span>
    <span class="n">test_text_regex</span><span class="p">(</span><span class="s2">&quot;SIGNED_FLOAT&quot;</span><span class="p">,</span> <span class="n">SIGNED_FLOAT</span><span class="p">,</span> <span class="p">[</span>
        <span class="p">(</span><span class="s2">&quot;1&quot;</span><span class="p">,</span> <span class="p">[</span><span class="s2">&quot;1&quot;</span><span class="p">]),</span>
        <span class="p">(</span><span class="s2">&quot;12345&quot;</span><span class="p">,</span> <span class="p">[</span><span class="s2">&quot;12345&quot;</span><span class="p">]),</span>
        <span class="p">(</span><span class="s2">&quot;-1&quot;</span><span class="p">,</span> <span class="p">[</span><span class="s2">&quot;-1&quot;</span><span class="p">]),</span>
        <span class="p">(</span><span class="s2">&quot;1.2&quot;</span><span class="p">,</span> <span class="p">[</span><span class="s2">&quot;1.2&quot;</span><span class="p">]),</span>
        <span class="p">(</span><span class="s2">&quot;-3.4&quot;</span><span class="p">,</span> <span class="p">[</span><span class="s2">&quot;-3.4&quot;</span><span class="p">]),</span>
        <span class="p">(</span><span class="s2">&quot;+3.4&quot;</span><span class="p">,</span> <span class="p">[</span><span class="s2">&quot;+3.4&quot;</span><span class="p">]),</span>
        <span class="p">(</span><span class="s2">&quot;-3.4e27.3&quot;</span><span class="p">,</span> <span class="p">[</span><span class="s2">&quot;-3.4&quot;</span><span class="p">,</span> <span class="s2">&quot;27.3&quot;</span><span class="p">]),</span>
        <span class="p">(</span><span class="s2">&quot;3.4e-27&quot;</span><span class="p">,</span> <span class="p">[</span><span class="s2">&quot;3.4&quot;</span><span class="p">,</span> <span class="s2">&quot;-27&quot;</span><span class="p">]),</span>
        <span class="p">(</span><span class="s2">&quot;9,800&quot;</span><span class="p">,</span> <span class="p">[</span><span class="s2">&quot;9,800&quot;</span><span class="p">]),</span>
        <span class="p">(</span><span class="s2">&quot;17,600.34&quot;</span><span class="p">,</span> <span class="p">[</span><span class="s2">&quot;17,600.34&quot;</span><span class="p">]),</span>
        <span class="p">(</span><span class="s2">&quot;-17,300.6588&quot;</span><span class="p">,</span> <span class="p">[</span><span class="s2">&quot;-17,300.6588&quot;</span><span class="p">]),</span>
    <span class="p">],</span> <span class="n">verbose</span><span class="o">=</span><span class="n">verbose</span><span class="p">)</span>
    <span class="n">test_text_regex</span><span class="p">(</span><span class="s2">&quot;LIBERAL_NUMBER&quot;</span><span class="p">,</span> <span class="n">LIBERAL_NUMBER</span><span class="p">,</span> <span class="p">[</span>
        <span class="p">(</span><span class="s2">&quot;1&quot;</span><span class="p">,</span> <span class="p">[</span><span class="s2">&quot;1&quot;</span><span class="p">]),</span>
        <span class="p">(</span><span class="s2">&quot;12345&quot;</span><span class="p">,</span> <span class="p">[</span><span class="s2">&quot;12345&quot;</span><span class="p">]),</span>
        <span class="p">(</span><span class="s2">&quot;-1&quot;</span><span class="p">,</span> <span class="p">[</span><span class="s2">&quot;-1&quot;</span><span class="p">]),</span>
        <span class="p">(</span><span class="s2">&quot;1.2&quot;</span><span class="p">,</span> <span class="p">[</span><span class="s2">&quot;1.2&quot;</span><span class="p">]),</span>
        <span class="p">(</span><span class="s2">&quot;-3.4&quot;</span><span class="p">,</span> <span class="p">[</span><span class="s2">&quot;-3.4&quot;</span><span class="p">]),</span>
        <span class="p">(</span><span class="s2">&quot;+3.4&quot;</span><span class="p">,</span> <span class="p">[</span><span class="s2">&quot;+3.4&quot;</span><span class="p">]),</span>
        <span class="p">(</span><span class="s2">&quot;-3.4e27.3&quot;</span><span class="p">,</span> <span class="p">[</span><span class="s2">&quot;-3.4e27&quot;</span><span class="p">,</span> <span class="s2">&quot;3&quot;</span><span class="p">]),</span>  <span class="c1"># not valid scientific notation</span>
        <span class="p">(</span><span class="s2">&quot;3.4e-27&quot;</span><span class="p">,</span> <span class="p">[</span><span class="s2">&quot;3.4e-27&quot;</span><span class="p">]),</span>
        <span class="p">(</span><span class="s2">&quot;9,800&quot;</span><span class="p">,</span> <span class="p">[</span><span class="s2">&quot;9,800&quot;</span><span class="p">]),</span>
        <span class="p">(</span><span class="s2">&quot;17,600.34&quot;</span><span class="p">,</span> <span class="p">[</span><span class="s2">&quot;17,600.34&quot;</span><span class="p">]),</span>
        <span class="p">(</span><span class="s2">&quot;-17,300.6588&quot;</span><span class="p">,</span> <span class="p">[</span><span class="s2">&quot;-17,300.6588&quot;</span><span class="p">]),</span>
    <span class="p">],</span> <span class="n">verbose</span><span class="o">=</span><span class="n">verbose</span><span class="p">)</span>

    <span class="c1"># -------------------------------------------------------------------------</span>
    <span class="c1"># Units</span>
    <span class="c1"># -------------------------------------------------------------------------</span>

    <span class="n">test_text_regex</span><span class="p">(</span><span class="s2">&quot;CELLS&quot;</span><span class="p">,</span> <span class="n">CELLS</span><span class="p">,</span> <span class="p">[</span>
        <span class="p">(</span><span class="s2">&quot;cells&quot;</span><span class="p">,</span> <span class="p">[</span><span class="s2">&quot;cells&quot;</span><span class="p">]),</span>
        <span class="p">(</span><span class="s2">&quot;blibble&quot;</span><span class="p">,</span> <span class="p">[]),</span>
    <span class="p">],</span> <span class="n">verbose</span><span class="o">=</span><span class="n">verbose</span><span class="p">)</span>
    <span class="n">test_text_regex</span><span class="p">(</span><span class="s2">&quot;CUBIC_MM&quot;</span><span class="p">,</span> <span class="n">CUBIC_MM</span><span class="p">,</span> <span class="p">[</span>
        <span class="p">(</span><span class="s2">&quot;mm3&quot;</span><span class="p">,</span> <span class="p">[</span><span class="s2">&quot;mm3&quot;</span><span class="p">]),</span>
        <span class="p">(</span><span class="s2">&quot;blibble&quot;</span><span class="p">,</span> <span class="p">[]),</span>
    <span class="p">],</span> <span class="n">verbose</span><span class="o">=</span><span class="n">verbose</span><span class="p">)</span>
    <span class="n">test_text_regex</span><span class="p">(</span><span class="s2">&quot;PER_CUBIC_MM&quot;</span><span class="p">,</span> <span class="n">PER_CUBIC_MM</span><span class="p">,</span> <span class="p">[</span>
        <span class="p">(</span><span class="s2">&quot;per cubic mm&quot;</span><span class="p">,</span> <span class="p">[</span><span class="s2">&quot;per cubic mm&quot;</span><span class="p">]),</span>
    <span class="p">],</span> <span class="n">verbose</span><span class="o">=</span><span class="n">verbose</span><span class="p">)</span>
    <span class="n">test_text_regex</span><span class="p">(</span><span class="s2">&quot;CELLS_PER_CUBIC_MM&quot;</span><span class="p">,</span> <span class="n">CELLS_PER_CUBIC_MM</span><span class="p">,</span> <span class="p">[</span>
        <span class="p">(</span><span class="s2">&quot;cells/mm3&quot;</span><span class="p">,</span> <span class="p">[</span><span class="s2">&quot;cells/mm3&quot;</span><span class="p">]),</span>
        <span class="p">(</span><span class="s2">&quot;blibble&quot;</span><span class="p">,</span> <span class="p">[]),</span>
    <span class="p">],</span> <span class="n">verbose</span><span class="o">=</span><span class="n">verbose</span><span class="p">)</span>

    <span class="c1"># -------------------------------------------------------------------------</span>
    <span class="c1"># Things to ignore</span>
    <span class="c1"># -------------------------------------------------------------------------</span>

    <span class="n">test_text_regex</span><span class="p">(</span>
        <span class="s2">&quot;OPTIONAL_RESULTS_IGNORABLES&quot;</span><span class="p">,</span>
        <span class="n">OPTIONAL_RESULTS_IGNORABLES</span><span class="p">,</span> <span class="p">[</span>
            <span class="p">(</span><span class="s2">&quot;(H)&quot;</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;(H)&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">]),</span>
            <span class="p">(</span><span class="s2">&quot; (H) &quot;</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39; (H) &#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">]),</span>
            <span class="p">(</span><span class="s2">&quot; (H) mg/L&quot;</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39; (H) &#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="s1">&#39;L&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">]),</span>
            <span class="p">(</span><span class="s2">&quot;(HH)&quot;</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;(HH)&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">]),</span>
            <span class="p">(</span><span class="s2">&quot;(L)&quot;</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;(L)&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">]),</span>
            <span class="p">(</span><span class="s2">&quot;(LL)&quot;</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;(LL)&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">]),</span>
            <span class="p">(</span><span class="s2">&quot;(*)&quot;</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;(*)&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">]),</span>
            <span class="p">(</span><span class="s2">&quot;  |  (H)  |  &quot;</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;  |  (H)  |  &#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">]),</span>
        <span class="p">],</span>
        <span class="n">verbose</span><span class="o">=</span><span class="n">verbose</span>
    <span class="p">)</span>

    <span class="c1"># -------------------------------------------------------------------------</span>
    <span class="c1"># Tense indicators</span>
    <span class="c1"># -------------------------------------------------------------------------</span>

    <span class="n">test_text_regex</span><span class="p">(</span><span class="s2">&quot;TENSE_INDICATOR&quot;</span><span class="p">,</span> <span class="n">TENSE_INDICATOR</span><span class="p">,</span> <span class="p">[</span>
        <span class="p">(</span><span class="s2">&quot;a is b&quot;</span><span class="p">,</span> <span class="p">[</span><span class="s2">&quot;is&quot;</span><span class="p">]),</span>
        <span class="p">(</span><span class="s2">&quot;a was b&quot;</span><span class="p">,</span> <span class="p">[</span><span class="s2">&quot;was&quot;</span><span class="p">]),</span>
        <span class="p">(</span><span class="s2">&quot;a blah b&quot;</span><span class="p">,</span> <span class="p">[]),</span>
    <span class="p">],</span> <span class="n">verbose</span><span class="o">=</span><span class="n">verbose</span><span class="p">)</span>

    <span class="c1"># -------------------------------------------------------------------------</span>
    <span class="c1"># Mathematical relations</span>
    <span class="c1"># -------------------------------------------------------------------------</span>

    <span class="n">test_text_regex</span><span class="p">(</span><span class="s2">&quot;RELATION&quot;</span><span class="p">,</span> <span class="n">RELATION</span><span class="p">,</span> <span class="p">[</span>
        <span class="p">(</span><span class="s2">&quot;a &lt; b&quot;</span><span class="p">,</span> <span class="p">[</span><span class="s2">&quot;&lt;&quot;</span><span class="p">]),</span>
        <span class="p">(</span><span class="s2">&quot;a less than b&quot;</span><span class="p">,</span> <span class="p">[</span><span class="s2">&quot;less than&quot;</span><span class="p">]),</span>
        <span class="p">(</span><span class="s2">&quot;a &lt;= b&quot;</span><span class="p">,</span> <span class="p">[</span><span class="s2">&quot;&lt;=&quot;</span><span class="p">]),</span>
        <span class="p">(</span><span class="s2">&quot;a = b&quot;</span><span class="p">,</span> <span class="p">[</span><span class="s2">&quot;=&quot;</span><span class="p">]),</span>
        <span class="p">(</span><span class="s2">&quot;a equals b&quot;</span><span class="p">,</span> <span class="p">[</span><span class="s2">&quot;equals&quot;</span><span class="p">]),</span>
        <span class="p">(</span><span class="s2">&quot;a equal to b&quot;</span><span class="p">,</span> <span class="p">[</span><span class="s2">&quot;equal to&quot;</span><span class="p">]),</span>
        <span class="p">(</span><span class="s2">&quot;a &gt;= b&quot;</span><span class="p">,</span> <span class="p">[</span><span class="s2">&quot;&gt;=&quot;</span><span class="p">]),</span>
        <span class="p">(</span><span class="s2">&quot;a &gt; b&quot;</span><span class="p">,</span> <span class="p">[</span><span class="s2">&quot;&gt;&quot;</span><span class="p">]),</span>
        <span class="p">(</span><span class="s2">&quot;a more than b&quot;</span><span class="p">,</span> <span class="p">[</span><span class="s2">&quot;more than&quot;</span><span class="p">]),</span>
        <span class="p">(</span><span class="s2">&quot;a greater than b&quot;</span><span class="p">,</span> <span class="p">[</span><span class="s2">&quot;greater than&quot;</span><span class="p">]),</span>
        <span class="p">(</span><span class="s2">&quot;a blah b&quot;</span><span class="p">,</span> <span class="p">[]),</span>
    <span class="p">],</span> <span class="n">verbose</span><span class="o">=</span><span class="n">verbose</span><span class="p">)</span>


<span class="c1"># =============================================================================</span>
<span class="c1">#  Command-line entry point</span>
<span class="c1"># =============================================================================</span>

<span class="k">def</span> <span class="nf">test_all</span><span class="p">(</span><span class="n">verbose</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
    <span class="n">test_base_regexes</span><span class="p">(</span><span class="n">verbose</span><span class="o">=</span><span class="n">verbose</span><span class="p">)</span>
    <span class="c1"># learning_alternative_regex_groups()</span>


<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s1">&#39;__main__&#39;</span><span class="p">:</span>
    <span class="n">test_all</span><span class="p">()</span>
</pre></div>

          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<h3><a href="../../../index.html">Table Of Contents</a></h3>
<p class="caption"><span class="caption-text">Contents:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../introduction/overview.html">1. Overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../introduction/package_elements.html">2. Package elements in brief</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../introduction/publications.html">3. Reference publications</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../installation/installation.html">4. Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../installation/database_drivers.html">5. Databases and database drivers</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../anonymisation/index.html">6. Anonymisation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../nlp/index.html">7. Natural language processing (NLP)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../website_config/index.html">8. Configuring the CRATE web interface</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../website_using/index.html">9. Using the CRATE web interface</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../misc/ancillary_tools.html">10. Ancillary tools</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../misc/troubleshooting.html">11. Troubleshooting</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../misc/technical_notes.html">12. Technical notes</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../misc/upgrading.html">13. Upgrading CRATE</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../misc/tcpip_ports.html">14. Common relevant TCP/IP ports</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../autodoc/index.html">15. Automatic documentation of source code</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../changelog.html">16. Change log/history</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../misc/to_do.html">17. Things to do</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../glossary.html">18. Abbreviations and glossary</a></li>
</ul>

<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../../../search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    </div>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="../../../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../../index.html">CRATE  documentation</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="../../index.html" >Module code</a> &#187;</li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
        &#169; Copyright 2018, Rudolf Cardinal.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.7.5.
    </div>
  </body>
</html>