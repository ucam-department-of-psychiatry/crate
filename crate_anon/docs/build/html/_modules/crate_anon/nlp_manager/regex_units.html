
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="X-UA-Compatible" content="IE=Edge" />
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>crate_anon.nlp_manager.regex_units &#8212; CRATE  documentation</title>
    <link rel="stylesheet" href="../../../_static/classic.css" type="text/css" />
    <link rel="stylesheet" href="../../../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="../../../_static/css/crate_docs.css" type="text/css" />
    <script type="text/javascript" id="documentation_options" data-url_root="../../../" src="../../../_static/documentation_options.js"></script>
    <script type="text/javascript" src="../../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../../_static/doctools.js"></script>
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" /> 
  </head><body>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../../../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../../index.html">CRATE  documentation</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="../../index.html" accesskey="U">Module code</a> &#187;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <h1>Source code for crate_anon.nlp_manager.regex_units</h1><div class="highlight"><pre>
<span></span><span class="ch">#!/usr/bin/env python</span>
<span class="c1"># crate_anon/nlp_manager/regex_units.py</span>

<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">===============================================================================</span>

<span class="sd">    Copyright (C) 2015-2018 Rudolf Cardinal (rudolf@pobox.com).</span>

<span class="sd">    This file is part of CRATE.</span>

<span class="sd">    CRATE is free software: you can redistribute it and/or modify</span>
<span class="sd">    it under the terms of the GNU General Public License as published by</span>
<span class="sd">    the Free Software Foundation, either version 3 of the License, or</span>
<span class="sd">    (at your option) any later version.</span>

<span class="sd">    CRATE is distributed in the hope that it will be useful,</span>
<span class="sd">    but WITHOUT ANY WARRANTY; without even the implied warranty of</span>
<span class="sd">    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the</span>
<span class="sd">    GNU General Public License for more details.</span>

<span class="sd">    You should have received a copy of the GNU General Public License</span>
<span class="sd">    along with CRATE. If not, see &lt;http://www.gnu.org/licenses/&gt;.</span>

<span class="sd">===============================================================================</span>
<span class="sd">&quot;&quot;&quot;</span>

<span class="kn">from</span> <span class="nn">typing</span> <span class="k">import</span> <span class="n">List</span><span class="p">,</span> <span class="n">Optional</span><span class="p">,</span> <span class="n">Tuple</span>
<span class="kn">from</span> <span class="nn">crate_anon.nlp_manager.regex_test</span> <span class="k">import</span> <span class="n">test_text_regex</span>
<span class="kn">from</span> <span class="nn">crate_anon.nlp_manager.regex_numbers</span> <span class="k">import</span> <span class="p">(</span>
    <span class="n">BILLION</span><span class="p">,</span>
    <span class="n">MULTIPLY_OR_SPACE</span><span class="p">,</span>
    <span class="n">PLAIN_INTEGER</span><span class="p">,</span>
    <span class="n">POWER</span><span class="p">,</span>
<span class="p">)</span>


<span class="c1"># =============================================================================</span>
<span class="c1"># Physical units</span>
<span class="c1"># =============================================================================</span>

<span class="n">OUT_OF_SEPARATOR</span> <span class="o">=</span> <span class="sa">r</span><span class="s2">&quot;(?: \/ | \b out \s+ of \b )&quot;</span>


<span class="k">def</span> <span class="nf">per</span><span class="p">(</span><span class="n">numerator</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">denominator</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">include_power_minus1</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
    <span class="c1"># Copes with blank/optional numerators, too.</span>
    <span class="n">options</span> <span class="o">=</span> <span class="p">[</span>
        <span class="sa">r</span><span class="s2">&quot;(?: </span><span class="si">{numerator}</span><span class="s2"> \s* (?: \/ | \b per \b) \s* </span><span class="si">{denominator}</span><span class="s2"> )&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
            <span class="n">numerator</span><span class="o">=</span><span class="n">numerator</span><span class="p">,</span> <span class="n">denominator</span><span class="o">=</span><span class="n">denominator</span><span class="p">),</span>
    <span class="p">]</span>
    <span class="k">if</span> <span class="n">include_power_minus1</span><span class="p">:</span>
        <span class="n">options</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
            <span class="sa">r</span><span class="s2">&quot;(?: </span><span class="si">{numerator}</span><span class="s2"> \s* \b </span><span class="si">{denominator}</span><span class="s2"> \s* -1 )&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                <span class="n">numerator</span><span class="o">=</span><span class="n">numerator</span><span class="p">,</span> <span class="n">denominator</span><span class="o">=</span><span class="n">denominator</span><span class="p">))</span>
    <span class="k">return</span> <span class="sa">r</span><span class="s2">&quot;(?: </span><span class="si">{}</span><span class="s2"> )&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot; | &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">options</span><span class="p">))</span>
    <span class="c1"># Use of &quot;\s* \b&quot; rather than &quot;\s+&quot; is so we can have a BLANK numerator.</span>


<span class="k">def</span> <span class="nf">_out_of_str</span><span class="p">(</span><span class="n">n_as_regex</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
    <span class="c1"># / n</span>
    <span class="c1"># out of n</span>
    <span class="k">return</span> <span class="sa">r</span><span class="s2">&quot;(?: </span><span class="si">{out_of}</span><span class="s2"> \s* </span><span class="si">{n}</span><span class="s2"> \b)&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">out_of</span><span class="o">=</span><span class="n">OUT_OF_SEPARATOR</span><span class="p">,</span>
                                              <span class="n">n</span><span class="o">=</span><span class="n">n_as_regex</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">out_of</span><span class="p">(</span><span class="n">n</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
    <span class="k">return</span> <span class="n">_out_of_str</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">n</span><span class="p">))</span>


<span class="k">def</span> <span class="nf">out_of_anything</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
    <span class="c1"># out_of(n) where n is any number</span>
    <span class="k">return</span> <span class="n">_out_of_str</span><span class="p">(</span><span class="n">PLAIN_INTEGER</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">power</span><span class="p">(</span><span class="n">x</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">n</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">allow_no_operator</span><span class="p">:</span> <span class="nb">bool</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
    <span class="k">return</span> <span class="sa">r</span><span class="s2">&quot;(?: </span><span class="si">{x}</span><span class="s2"> \s* </span><span class="si">{power}{optional}</span><span class="s2"> \s* </span><span class="si">{n}</span><span class="s2">)&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
        <span class="n">x</span><span class="o">=</span><span class="n">x</span><span class="p">,</span>
        <span class="n">power</span><span class="o">=</span><span class="n">POWER</span><span class="p">,</span>
        <span class="n">optional</span><span class="o">=</span><span class="s2">&quot;?&quot;</span> <span class="k">if</span> <span class="n">allow_no_operator</span> <span class="k">else</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
        <span class="n">n</span><span class="o">=</span><span class="n">n</span><span class="p">,</span>
    <span class="p">)</span>


<div class="viewcode-block" id="units_times"><a class="viewcode-back" href="../../../autodoc/nlp_manager/regex_units.html#crate_anon.nlp_manager.regex_units.units_times">[docs]</a><span class="k">def</span> <span class="nf">units_times</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;For units, where they are notionally multiplied.&quot;&quot;&quot;</span>
    <span class="n">multiply</span> <span class="o">=</span> <span class="n">MULTIPLY_OR_SPACE</span> <span class="o">+</span> <span class="s2">&quot;?&quot;</span>
    <span class="n">joined</span> <span class="o">=</span> <span class="n">multiply</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">args</span><span class="p">)</span>
    <span class="k">return</span> <span class="sa">r</span><span class="s2">&quot;(?: </span><span class="si">{}</span><span class="s2"> )&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">joined</span><span class="p">)</span></div>


<span class="k">def</span> <span class="nf">units_by_dimension</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">:</span> <span class="n">Tuple</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">int</span><span class="p">],</span>  <span class="c1"># specify type of *one* arg!</span>
                       <span class="n">allow_no_operator</span><span class="p">:</span> <span class="nb">bool</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
    <span class="n">multiply</span> <span class="o">=</span> <span class="s2">&quot; &quot;</span> <span class="o">+</span> <span class="n">MULTIPLY_OR_SPACE</span> <span class="o">+</span> <span class="s2">&quot; &quot;</span>
    <span class="n">power_elements</span> <span class="o">=</span> <span class="p">[]</span>  <span class="c1"># type: List[str]</span>
    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">unit_exponent</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">args</span><span class="p">):</span>
        <span class="n">unit</span><span class="p">,</span> <span class="n">exponent</span> <span class="o">=</span> <span class="n">unit_exponent</span>
        <span class="k">assert</span><span class="p">(</span><span class="n">exponent</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">)</span>
        <span class="n">power_elements</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
            <span class="n">power</span><span class="p">(</span><span class="n">unit</span><span class="p">,</span> <span class="n">exponent</span><span class="p">,</span> <span class="n">allow_no_operator</span><span class="o">=</span><span class="n">allow_no_operator</span><span class="p">))</span>
    <span class="n">joined_power_elements</span> <span class="o">=</span> <span class="n">multiply</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">power_elements</span><span class="p">)</span>
    <span class="n">power_style</span> <span class="o">=</span> <span class="sa">r</span><span class="s2">&quot;(?: </span><span class="si">{}</span><span class="s2"> )&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">joined_power_elements</span><span class="p">)</span>
    <span class="n">options</span> <span class="o">=</span> <span class="p">[</span><span class="n">power_style</span><span class="p">]</span>
    <span class="c1"># noinspection PyChainedComparisons</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">args</span><span class="p">)</span> <span class="o">==</span> <span class="mi">2</span> <span class="ow">and</span> <span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">args</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="c1"># x per y</span>
        <span class="n">options</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">per</span><span class="p">(</span><span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="n">args</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span>
                           <span class="n">include_power_minus1</span><span class="o">=</span><span class="kc">False</span><span class="p">))</span>
    <span class="k">return</span> <span class="sa">r</span><span class="s2">&quot;(?: </span><span class="si">{}</span><span class="s2"> )&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot; | &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">options</span><span class="p">))</span>


<span class="c1"># -----------------------------------------------------------------------------</span>
<span class="c1"># Distance</span>
<span class="c1"># -----------------------------------------------------------------------------</span>

<span class="n">M</span> <span class="o">=</span> <span class="sa">r</span><span class="s2">&quot;(?: met(?:re|er)s? | m )&quot;</span>  <span class="c1"># m, metre(s), meter(s)</span>
<span class="n">CM</span> <span class="o">=</span> <span class="sa">r</span><span class="s2">&quot;(?: cm | centimet(?:re|er)s? )&quot;</span>   <span class="c1"># cm, centimetre(s), centimeter(s)</span>
<span class="n">MM</span> <span class="o">=</span> <span class="sa">r</span><span class="s2">&quot;(?: mm | millimet(?:re|er)s? )&quot;</span>   <span class="c1"># mm, millimetre(s), millimeter(s)</span>

<span class="n">FEET</span> <span class="o">=</span> <span class="sa">r</span><span class="s2">&quot;&quot;&quot;(?: f(?:ee|oo)?t | \&#39; | ’ | ′ )&quot;&quot;&quot;</span>
<span class="c1"># ... feet, foot, ft</span>
<span class="c1"># ... apostrophe, right single quote (U+2019), prime (U+2032)</span>
<span class="n">INCHES</span> <span class="o">=</span> <span class="sa">r</span><span class="s1">&#39;&#39;&#39;(?: in(?:ch(?:e)?)?s? | \&quot; | ” | ″)&#39;&#39;&#39;</span>
<span class="c1"># ... in, ins, inch, inches, [inchs = typo but clear]</span>
<span class="c1"># ... &quot;, right double quote (U+2014), double prime (U+2033)</span>

<span class="c1"># -----------------------------------------------------------------------------</span>
<span class="c1"># Mass</span>
<span class="c1"># -----------------------------------------------------------------------------</span>

<span class="n">MCG</span> <span class="o">=</span> <span class="sa">r</span><span class="s2">&quot;(?: mcg | microgram(?:me)?s? | [μu]g )&quot;</span>  <span class="c1"># you won&#39;t stop people using ug...  # noqa</span>
<span class="n">MG</span> <span class="o">=</span> <span class="sa">r</span><span class="s2">&quot;(?: mg | milligram(?:me)?s? )&quot;</span>  <span class="c1"># mg, milligram, milligrams, milligramme, milligrammes  # noqa</span>
<span class="n">G</span> <span class="o">=</span> <span class="sa">r</span><span class="s2">&quot;(?: gram(?:me)?s? | g )&quot;</span>  <span class="c1"># g, gram, grams, gramme, grammes  # noqa</span>
<span class="n">KG</span> <span class="o">=</span> <span class="sa">r</span><span class="s2">&quot;(?: kgs? | kilo(?:gram(?:me)?)?s? )&quot;</span>  <span class="c1"># kg, kgs, kilos ... kilogrammes etc.  # noqa</span>
<span class="n">LB</span> <span class="o">=</span> <span class="sa">r</span><span class="s2">&quot;(?: pounds? | lbs? )&quot;</span>  <span class="c1"># pound(s), lb(s)</span>
<span class="n">STONES</span> <span class="o">=</span> <span class="sa">r</span><span class="s2">&quot;(?: stones? | st\.? )&quot;</span>  <span class="c1"># stone(s), st, st.</span>

<span class="c1"># -----------------------------------------------------------------------------</span>
<span class="c1"># Volume</span>
<span class="c1"># -----------------------------------------------------------------------------</span>

<span class="n">L</span> <span class="o">=</span> <span class="sa">r</span><span class="s2">&quot;(?: lit(?:re|er)s? | L )&quot;</span>  <span class="c1"># L, litre(s), liter(s)</span>
<span class="n">DL</span> <span class="o">=</span> <span class="sa">r</span><span class="s2">&quot;(?: d(?:eci)?</span><span class="si">{L}</span><span class="s2"> )&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">L</span><span class="o">=</span><span class="n">L</span><span class="p">)</span>
<span class="n">ML</span> <span class="o">=</span> <span class="sa">r</span><span class="s2">&quot;(?: m(?:illi)?</span><span class="si">{L}</span><span class="s2"> )&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">L</span><span class="o">=</span><span class="n">L</span><span class="p">)</span>
<span class="n">CUBIC_MM</span> <span class="o">=</span> <span class="sa">r</span><span class="s2">&quot;&quot;&quot;(?: (?:\b cubic \s+ </span><span class="si">{mm}</span><span class="s2">) | </span><span class="si">{mm_cubed}</span><span class="s2"> )&quot;&quot;&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
    <span class="n">mm</span><span class="o">=</span><span class="n">MM</span><span class="p">,</span>
    <span class="n">mm_cubed</span><span class="o">=</span><span class="n">power</span><span class="p">(</span><span class="n">MM</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="n">allow_no_operator</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="p">)</span>
<span class="c1"># cubic mm, etc. | mm^3, mm3, mm 3, etc.</span>

<span class="c1"># -----------------------------------------------------------------------------</span>
<span class="c1"># Inverse volume</span>
<span class="c1"># -----------------------------------------------------------------------------</span>

<span class="n">PER_CUBIC_MM</span> <span class="o">=</span> <span class="n">per</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">CUBIC_MM</span><span class="p">)</span>

<span class="c1"># -----------------------------------------------------------------------------</span>
<span class="c1"># Time</span>
<span class="c1"># -----------------------------------------------------------------------------</span>

<span class="n">HOUR</span> <span class="o">=</span> <span class="sa">r</span><span class="s2">&quot;(?:h(?:rs?|ours?)?)&quot;</span>   <span class="c1"># h, hr, hrs, hour, hours</span>

<span class="c1"># -----------------------------------------------------------------------------</span>
<span class="c1"># Counts, proportions</span>
<span class="c1"># -----------------------------------------------------------------------------</span>

<span class="n">PERCENT</span> <span class="o">=</span> <span class="sa">r</span><span class="s2">&quot;&quot;&quot;(?:%|pe?r?\s?ce?n?t)&quot;&quot;&quot;</span>
<span class="c1"># must have pct, other characters optional</span>

<span class="c1"># -----------------------------------------------------------------------------</span>
<span class="c1"># Arbitrary count things</span>
<span class="c1"># -----------------------------------------------------------------------------</span>

<span class="n">CELLS</span> <span class="o">=</span> <span class="sa">r</span><span class="s2">&quot;(?:\b cells? \b)&quot;</span>
<span class="n">OPTIONAL_CELLS</span> <span class="o">=</span> <span class="n">CELLS</span> <span class="o">+</span> <span class="s2">&quot;?&quot;</span>
<span class="n">MILLIMOLES</span> <span class="o">=</span> <span class="sa">r</span><span class="s2">&quot;(?: m(?:illi)?mol(?:es?)? )&quot;</span>
<span class="n">MILLIEQ</span> <span class="o">=</span> <span class="sa">r</span><span class="s2">&quot;(?:m(?:illi)?Eq)&quot;</span>

<span class="n">UNITS</span> <span class="o">=</span> <span class="sa">r</span><span class="s2">&quot;(?:[I]?U)&quot;</span>  <span class="c1"># U units, IU international units</span>
<span class="n">MILLIUNITS</span> <span class="o">=</span> <span class="sa">r</span><span class="s2">&quot;(?:m[I]?U)&quot;</span>
<span class="n">MICROUNITS</span> <span class="o">=</span> <span class="sa">r</span><span class="s2">&quot;(?:[μu][I]?U)&quot;</span>

<span class="n">SCORE</span> <span class="o">=</span> <span class="sa">r</span><span class="s2">&quot;(?:scored?)&quot;</span>  <span class="c1"># score(d)</span>

<span class="c1"># -----------------------------------------------------------------------------</span>
<span class="c1"># Concentration</span>
<span class="c1"># -----------------------------------------------------------------------------</span>

<span class="n">MILLIMOLAR</span> <span class="o">=</span> <span class="sa">r</span><span class="s2">&quot;(?:mM)&quot;</span>  <span class="c1"># NB case-insensitive... confusable with millimetres</span>
<span class="n">MG_PER_DL</span> <span class="o">=</span> <span class="n">per</span><span class="p">(</span><span class="n">MG</span><span class="p">,</span> <span class="n">DL</span><span class="p">)</span>
<span class="n">MG_PER_L</span> <span class="o">=</span> <span class="n">per</span><span class="p">(</span><span class="n">MG</span><span class="p">,</span> <span class="n">L</span><span class="p">)</span>
<span class="n">MILLIMOLES_PER_L</span> <span class="o">=</span> <span class="n">per</span><span class="p">(</span><span class="n">MILLIMOLES</span><span class="p">,</span> <span class="n">L</span><span class="p">)</span>
<span class="n">MILLIEQ_PER_L</span> <span class="o">=</span> <span class="n">per</span><span class="p">(</span><span class="n">MILLIEQ</span><span class="p">,</span> <span class="n">L</span><span class="p">)</span>
<span class="n">BILLION_PER_L</span> <span class="o">=</span> <span class="n">per</span><span class="p">(</span><span class="n">BILLION</span><span class="p">,</span> <span class="n">L</span><span class="p">)</span>
<span class="n">CELLS_PER_CUBIC_MM</span> <span class="o">=</span> <span class="n">per</span><span class="p">(</span><span class="n">OPTIONAL_CELLS</span><span class="p">,</span> <span class="n">CUBIC_MM</span><span class="p">)</span>

<span class="n">MILLIUNITS_PER_L</span> <span class="o">=</span> <span class="n">per</span><span class="p">(</span><span class="n">MILLIUNITS</span><span class="p">,</span> <span class="n">L</span><span class="p">)</span>
<span class="n">MICROUNITS_PER_ML</span> <span class="o">=</span> <span class="n">per</span><span class="p">(</span><span class="n">MICROUNITS</span><span class="p">,</span> <span class="n">ML</span><span class="p">)</span>

<span class="c1"># -----------------------------------------------------------------------------</span>
<span class="c1"># Speed</span>
<span class="c1"># -----------------------------------------------------------------------------</span>

<span class="n">MM_PER_H</span> <span class="o">=</span> <span class="n">per</span><span class="p">(</span><span class="n">MM</span><span class="p">,</span> <span class="n">HOUR</span><span class="p">)</span>

<span class="c1"># -----------------------------------------------------------------------------</span>
<span class="c1"># Pressure</span>
<span class="c1"># -----------------------------------------------------------------------------</span>

<span class="n">MM_HG</span> <span class="o">=</span> <span class="sa">r</span><span class="s2">&quot;(?: mm \s* Hg )&quot;</span>  <span class="c1"># mmHg, mm Hg</span>
<span class="c1"># ... likelihood of &quot;millimetres of mercury&quot; quite small?</span>

<span class="c1"># -----------------------------------------------------------------------------</span>
<span class="c1"># Things to powers</span>
<span class="c1"># -----------------------------------------------------------------------------</span>

<span class="n">SQ_M</span> <span class="o">=</span> <span class="sa">r</span><span class="s2">&quot;&quot;&quot;</span>
<span class="s2">    (?:  # square metres</span>
<span class="s2">        (?: sq(?:uare)? \s+ </span><span class="si">{m}</span><span class="s2"> )       # sq m, square metres, etc.</span>
<span class="s2">        | (?: </span><span class="si">{m}</span><span class="s2"> \s+ sq(?:uared?)? )   # m sq, metres square(d), etc.</span>
<span class="s2">        | </span><span class="si">{m_sq}</span><span class="s2">                        # m ^ 2, etc.</span>
<span class="s2">    )</span>
<span class="s2">&quot;&quot;&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">m</span><span class="o">=</span><span class="n">M</span><span class="p">,</span> <span class="n">m_sq</span><span class="o">=</span><span class="n">power</span><span class="p">(</span><span class="n">M</span><span class="p">,</span> <span class="mi">2</span><span class="p">))</span>

<span class="c1"># BMI</span>
<span class="n">KG_PER_SQ_M</span> <span class="o">=</span> <span class="sa">r</span><span class="s2">&quot;(?: </span><span class="si">{kg_per_sqm}</span><span class="s2"> | </span><span class="si">{kg_sqm_pow_minus2}</span><span class="s2"> )&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
    <span class="n">kg_per_sqm</span><span class="o">=</span><span class="n">per</span><span class="p">(</span><span class="n">KG</span><span class="p">,</span> <span class="n">SQ_M</span><span class="p">,</span> <span class="n">include_power_minus1</span><span class="o">=</span><span class="kc">False</span><span class="p">),</span>
    <span class="n">kg_sqm_pow_minus2</span><span class="o">=</span><span class="n">units_times</span><span class="p">(</span><span class="n">KG</span><span class="p">,</span> <span class="n">power</span><span class="p">(</span><span class="n">M</span><span class="p">,</span> <span class="o">-</span><span class="mi">2</span><span class="p">)),</span>
<span class="p">)</span>


<span class="c1"># =============================================================================</span>
<span class="c1">#  Generic conversion functions</span>
<span class="c1"># =============================================================================</span>

<span class="k">def</span> <span class="nf">kg_from_st_lb_oz</span><span class="p">(</span><span class="n">stones</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
                     <span class="n">pounds</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
                     <span class="n">ounces</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mi">0</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">float</span><span class="p">]:</span>
    <span class="c1"># 16 ounces in a pound</span>
    <span class="c1"># 14 pounds in a stone</span>
    <span class="c1"># 1 avoirdupois pound = 0.45359237 kg</span>
    <span class="c1"># https://en.wikipedia.org/wiki/Pound_(mass)</span>
    <span class="c1"># Have you the peas? &quot;Goods of weight&quot;; aveir de peis (OFr.; see OED).</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">total_pounds</span> <span class="o">=</span> <span class="p">(</span><span class="n">stones</span> <span class="o">*</span> <span class="mi">14</span><span class="p">)</span> <span class="o">+</span> <span class="n">pounds</span> <span class="o">+</span> <span class="p">(</span><span class="n">ounces</span> <span class="o">/</span> <span class="mi">16</span><span class="p">)</span>
        <span class="k">return</span> <span class="mf">0.45359237</span> <span class="o">*</span> <span class="n">total_pounds</span>
    <span class="k">except</span> <span class="p">(</span><span class="ne">TypeError</span><span class="p">,</span> <span class="ne">ValueError</span><span class="p">):</span>
        <span class="k">return</span> <span class="kc">None</span>


<span class="k">def</span> <span class="nf">m_from_ft_in</span><span class="p">(</span><span class="n">feet</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">inches</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mi">0</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">float</span><span class="p">]:</span>
    <span class="c1"># 12 inches in a foot</span>
    <span class="c1"># 1 inch = 25.4 mm</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">total_inches</span> <span class="o">=</span> <span class="p">(</span><span class="n">feet</span> <span class="o">*</span> <span class="mi">12</span><span class="p">)</span> <span class="o">+</span> <span class="n">inches</span>
        <span class="k">return</span> <span class="n">total_inches</span> <span class="o">*</span> <span class="mf">25.4</span> <span class="o">/</span> <span class="mi">1000</span>
    <span class="k">except</span> <span class="p">(</span><span class="ne">TypeError</span><span class="p">,</span> <span class="ne">ValueError</span><span class="p">):</span>
        <span class="k">return</span> <span class="kc">None</span>


<span class="k">def</span> <span class="nf">m_from_m_cm</span><span class="p">(</span><span class="n">metres</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">centimetres</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mi">0</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">float</span><span class="p">]:</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">metres</span> <span class="o">+</span> <span class="p">(</span><span class="n">centimetres</span> <span class="o">/</span> <span class="mi">100</span><span class="p">)</span>
    <span class="k">except</span> <span class="p">(</span><span class="ne">TypeError</span><span class="p">,</span> <span class="ne">ValueError</span><span class="p">):</span>
        <span class="k">return</span> <span class="kc">None</span>


<div class="viewcode-block" id="assemble_units"><a class="viewcode-back" href="../../../autodoc/nlp_manager/regex_units.html#crate_anon.nlp_manager.regex_units.assemble_units">[docs]</a><span class="k">def</span> <span class="nf">assemble_units</span><span class="p">(</span><span class="n">components</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]])</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;Takes e.g. [&quot;ft&quot;, &quot;in&quot;] and makes &quot;ft in&quot;.&quot;&quot;&quot;</span>
    <span class="n">active_components</span> <span class="o">=</span> <span class="p">[</span><span class="n">c</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">components</span> <span class="k">if</span> <span class="n">c</span><span class="p">]</span>
    <span class="k">return</span> <span class="s2">&quot; &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">active_components</span><span class="p">)</span></div>


<span class="c1"># =============================================================================</span>
<span class="c1">#  Tests</span>
<span class="c1"># =============================================================================</span>

<span class="k">def</span> <span class="nf">test_unit_regexes</span><span class="p">(</span><span class="n">verbose</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
    <span class="n">test_text_regex</span><span class="p">(</span><span class="s2">&quot;per(n, d)&quot;</span><span class="p">,</span> <span class="n">per</span><span class="p">(</span><span class="s2">&quot;n&quot;</span><span class="p">,</span> <span class="s2">&quot;d&quot;</span><span class="p">),</span> <span class="p">[</span>
        <span class="p">(</span><span class="s2">&quot;blah n per d blah&quot;</span><span class="p">,</span> <span class="p">[</span><span class="s2">&quot;n per d&quot;</span><span class="p">]),</span>
        <span class="p">(</span><span class="s2">&quot;blah n/d blah&quot;</span><span class="p">,</span> <span class="p">[</span><span class="s2">&quot;n/d&quot;</span><span class="p">]),</span>
        <span class="p">(</span><span class="s2">&quot;n / d&quot;</span><span class="p">,</span> <span class="p">[</span><span class="s2">&quot;n / d&quot;</span><span class="p">]),</span>
        <span class="p">(</span><span class="s2">&quot;n d -1&quot;</span><span class="p">,</span> <span class="p">[</span><span class="s2">&quot;n d -1&quot;</span><span class="p">]),</span>
        <span class="p">(</span><span class="s2">&quot;n d -1&quot;</span><span class="p">,</span> <span class="p">[</span><span class="s2">&quot;n d -1&quot;</span><span class="p">]),</span>
        <span class="p">(</span><span class="s2">&quot;n blah d&quot;</span><span class="p">,</span> <span class="p">[]),</span>
    <span class="p">],</span> <span class="n">verbose</span><span class="o">=</span><span class="n">verbose</span><span class="p">)</span>
    <span class="n">test_text_regex</span><span class="p">(</span><span class="s2">&quot;out_of(5)&quot;</span><span class="p">,</span> <span class="n">out_of</span><span class="p">(</span><span class="mi">5</span><span class="p">),</span> <span class="p">[</span>
        <span class="p">(</span><span class="s2">&quot;4 out of 5&quot;</span><span class="p">,</span> <span class="p">[</span><span class="s2">&quot;out of 5&quot;</span><span class="p">]),</span>
        <span class="p">(</span><span class="s2">&quot;4/5&quot;</span><span class="p">,</span> <span class="p">[</span><span class="s2">&quot;/5&quot;</span><span class="p">]),</span>
        <span class="p">(</span><span class="s2">&quot;4 / 5&quot;</span><span class="p">,</span> <span class="p">[</span><span class="s2">&quot;/ 5&quot;</span><span class="p">]),</span>
    <span class="p">],</span> <span class="n">verbose</span><span class="o">=</span><span class="n">verbose</span><span class="p">)</span>

    <span class="n">test_text_regex</span><span class="p">(</span><span class="s2">&quot;M&quot;</span><span class="p">,</span> <span class="n">M</span><span class="p">,</span> <span class="p">[</span>
        <span class="p">(</span><span class="s2">&quot;5 metres long&quot;</span><span class="p">,</span> <span class="p">[</span><span class="s2">&quot;metres&quot;</span><span class="p">]),</span>
        <span class="p">(</span><span class="s2">&quot;5 meters long&quot;</span><span class="p">,</span> <span class="p">[</span><span class="s2">&quot;meters&quot;</span><span class="p">]),</span>
        <span class="p">(</span><span class="s2">&quot;5m long&quot;</span><span class="p">,</span> <span class="p">[</span><span class="s2">&quot;m&quot;</span><span class="p">]),</span>
    <span class="p">],</span> <span class="n">verbose</span><span class="o">=</span><span class="n">verbose</span><span class="p">)</span>
    <span class="n">test_text_regex</span><span class="p">(</span><span class="s2">&quot;CM&quot;</span><span class="p">,</span> <span class="n">CM</span><span class="p">,</span> <span class="p">[</span>
        <span class="p">(</span><span class="s2">&quot;5 centimetres long&quot;</span><span class="p">,</span> <span class="p">[</span><span class="s2">&quot;centimetres&quot;</span><span class="p">]),</span>
        <span class="p">(</span><span class="s2">&quot;5 centimeters long&quot;</span><span class="p">,</span> <span class="p">[</span><span class="s2">&quot;centimeters&quot;</span><span class="p">]),</span>
        <span class="p">(</span><span class="s2">&quot;5cm long&quot;</span><span class="p">,</span> <span class="p">[</span><span class="s2">&quot;cm&quot;</span><span class="p">]),</span>
    <span class="p">],</span> <span class="n">verbose</span><span class="o">=</span><span class="n">verbose</span><span class="p">)</span>
    <span class="n">test_text_regex</span><span class="p">(</span><span class="s2">&quot;MM&quot;</span><span class="p">,</span> <span class="n">MM</span><span class="p">,</span> <span class="p">[</span>
        <span class="p">(</span><span class="s2">&quot;5 millimetres long&quot;</span><span class="p">,</span> <span class="p">[</span><span class="s2">&quot;millimetres&quot;</span><span class="p">]),</span>
        <span class="p">(</span><span class="s2">&quot;5 millimeters long&quot;</span><span class="p">,</span> <span class="p">[</span><span class="s2">&quot;millimeters&quot;</span><span class="p">]),</span>
        <span class="p">(</span><span class="s2">&quot;5mm long&quot;</span><span class="p">,</span> <span class="p">[</span><span class="s2">&quot;mm&quot;</span><span class="p">]),</span>
    <span class="p">],</span> <span class="n">verbose</span><span class="o">=</span><span class="n">verbose</span><span class="p">)</span>
    <span class="n">test_text_regex</span><span class="p">(</span><span class="s2">&quot;FEET&quot;</span><span class="p">,</span> <span class="n">FEET</span><span class="p">,</span> <span class="p">[</span>
        <span class="p">(</span><span class="s2">&quot;5 feet long&quot;</span><span class="p">,</span> <span class="p">[</span><span class="s2">&quot;feet&quot;</span><span class="p">]),</span>
        <span class="p">(</span><span class="s2">&quot;5 foot long&quot;</span><span class="p">,</span> <span class="p">[</span><span class="s2">&quot;foot&quot;</span><span class="p">]),</span>
        <span class="p">(</span><span class="s2">&quot;5&#39; long&quot;</span><span class="p">,</span> <span class="p">[</span><span class="s2">&quot;&#39;&quot;</span><span class="p">]),</span>  <span class="c1"># ASCII apostrophe</span>
        <span class="p">(</span><span class="s2">&quot;5’ long&quot;</span><span class="p">,</span> <span class="p">[</span><span class="s2">&quot;’&quot;</span><span class="p">]),</span>  <span class="c1"># right single quote (U+2019)</span>
        <span class="p">(</span><span class="s2">&quot;5′ long&quot;</span><span class="p">,</span> <span class="p">[</span><span class="s2">&quot;′&quot;</span><span class="p">]),</span>  <span class="c1"># prime (U+2032)</span>
    <span class="p">],</span> <span class="n">verbose</span><span class="o">=</span><span class="n">verbose</span><span class="p">)</span>
    <span class="n">test_text_regex</span><span class="p">(</span><span class="s2">&quot;INCHES&quot;</span><span class="p">,</span> <span class="n">INCHES</span><span class="p">,</span> <span class="p">[</span>
        <span class="p">(</span><span class="s2">&quot;5 inches long&quot;</span><span class="p">,</span> <span class="p">[</span><span class="s2">&quot;inches&quot;</span><span class="p">]),</span>
        <span class="p">(</span><span class="s2">&quot;5 in long&quot;</span><span class="p">,</span> <span class="p">[</span><span class="s2">&quot;in&quot;</span><span class="p">]),</span>
        <span class="p">(</span><span class="s1">&#39;5&quot; long&#39;</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;&quot;&#39;</span><span class="p">]),</span>  <span class="c1"># ASCII double quote</span>
        <span class="p">(</span><span class="s2">&quot;5” long&quot;</span><span class="p">,</span> <span class="p">[</span><span class="s2">&quot;”&quot;</span><span class="p">]),</span>  <span class="c1"># right double quote (U+2014)</span>
        <span class="p">(</span><span class="s2">&quot;5″ long&quot;</span><span class="p">,</span> <span class="p">[</span><span class="s2">&quot;″&quot;</span><span class="p">]),</span>  <span class="c1"># double prime (U+2033)</span>
    <span class="p">],</span> <span class="n">verbose</span><span class="o">=</span><span class="n">verbose</span><span class="p">)</span>

    <span class="n">test_text_regex</span><span class="p">(</span><span class="s2">&quot;MCG&quot;</span><span class="p">,</span> <span class="n">MCG</span><span class="p">,</span> <span class="p">[</span>
        <span class="p">(</span><span class="s2">&quot;5 micrograms&quot;</span><span class="p">,</span> <span class="p">[</span><span class="s2">&quot;micrograms&quot;</span><span class="p">]),</span>
        <span class="p">(</span><span class="s2">&quot;5 mcg&quot;</span><span class="p">,</span> <span class="p">[</span><span class="s2">&quot;mcg&quot;</span><span class="p">]),</span>
        <span class="p">(</span><span class="s2">&quot;5 ug&quot;</span><span class="p">,</span> <span class="p">[</span><span class="s2">&quot;ug&quot;</span><span class="p">]),</span>
        <span class="p">(</span><span class="s2">&quot;5 μg&quot;</span><span class="p">,</span> <span class="p">[</span><span class="s2">&quot;μg&quot;</span><span class="p">]),</span>
    <span class="p">],</span> <span class="n">verbose</span><span class="o">=</span><span class="n">verbose</span><span class="p">)</span>
    <span class="n">test_text_regex</span><span class="p">(</span><span class="s2">&quot;MG&quot;</span><span class="p">,</span> <span class="n">MG</span><span class="p">,</span> <span class="p">[</span>
        <span class="p">(</span><span class="s2">&quot;5 milligrams&quot;</span><span class="p">,</span> <span class="p">[</span><span class="s2">&quot;milligrams&quot;</span><span class="p">]),</span>
        <span class="p">(</span><span class="s2">&quot;5 mg&quot;</span><span class="p">,</span> <span class="p">[</span><span class="s2">&quot;mg&quot;</span><span class="p">]),</span>
    <span class="p">],</span> <span class="n">verbose</span><span class="o">=</span><span class="n">verbose</span><span class="p">)</span>
    <span class="n">test_text_regex</span><span class="p">(</span><span class="s2">&quot;G&quot;</span><span class="p">,</span> <span class="n">G</span><span class="p">,</span> <span class="p">[</span>
        <span class="p">(</span><span class="s2">&quot;5 grams&quot;</span><span class="p">,</span> <span class="p">[</span><span class="s2">&quot;grams&quot;</span><span class="p">]),</span>
        <span class="p">(</span><span class="s2">&quot;5 g&quot;</span><span class="p">,</span> <span class="p">[</span><span class="s2">&quot;g&quot;</span><span class="p">]),</span>
    <span class="p">],</span> <span class="n">verbose</span><span class="o">=</span><span class="n">verbose</span><span class="p">)</span>
    <span class="n">test_text_regex</span><span class="p">(</span><span class="s2">&quot;KG&quot;</span><span class="p">,</span> <span class="n">KG</span><span class="p">,</span> <span class="p">[</span>
        <span class="p">(</span><span class="s2">&quot;5 kilograms&quot;</span><span class="p">,</span> <span class="p">[</span><span class="s2">&quot;kilograms&quot;</span><span class="p">]),</span>
        <span class="p">(</span><span class="s2">&quot;5 kg&quot;</span><span class="p">,</span> <span class="p">[</span><span class="s2">&quot;kg&quot;</span><span class="p">]),</span>
    <span class="p">],</span> <span class="n">verbose</span><span class="o">=</span><span class="n">verbose</span><span class="p">)</span>
    <span class="n">test_text_regex</span><span class="p">(</span><span class="s2">&quot;LB&quot;</span><span class="p">,</span> <span class="n">LB</span><span class="p">,</span> <span class="p">[</span>
        <span class="p">(</span><span class="s2">&quot;5 pounds&quot;</span><span class="p">,</span> <span class="p">[</span><span class="s2">&quot;pounds&quot;</span><span class="p">]),</span>
        <span class="p">(</span><span class="s2">&quot;5 lb&quot;</span><span class="p">,</span> <span class="p">[</span><span class="s2">&quot;lb&quot;</span><span class="p">]),</span>
    <span class="p">],</span> <span class="n">verbose</span><span class="o">=</span><span class="n">verbose</span><span class="p">)</span>
    <span class="n">test_text_regex</span><span class="p">(</span><span class="s2">&quot;STONES&quot;</span><span class="p">,</span> <span class="n">STONES</span><span class="p">,</span> <span class="p">[</span>
        <span class="p">(</span><span class="s2">&quot;5 stones&quot;</span><span class="p">,</span> <span class="p">[</span><span class="s2">&quot;stones&quot;</span><span class="p">]),</span>
        <span class="p">(</span><span class="s2">&quot;5 stone&quot;</span><span class="p">,</span> <span class="p">[</span><span class="s2">&quot;stone&quot;</span><span class="p">]),</span>
        <span class="p">(</span><span class="s2">&quot;5 st&quot;</span><span class="p">,</span> <span class="p">[</span><span class="s2">&quot;st&quot;</span><span class="p">]),</span>
    <span class="p">],</span> <span class="n">verbose</span><span class="o">=</span><span class="n">verbose</span><span class="p">)</span>

    <span class="n">test_text_regex</span><span class="p">(</span><span class="s2">&quot;L&quot;</span><span class="p">,</span> <span class="n">L</span><span class="p">,</span> <span class="p">[</span>
        <span class="p">(</span><span class="s2">&quot;5 litres&quot;</span><span class="p">,</span> <span class="p">[</span><span class="s2">&quot;litres&quot;</span><span class="p">]),</span>
        <span class="p">(</span><span class="s2">&quot;5 liters&quot;</span><span class="p">,</span> <span class="p">[</span><span class="s2">&quot;liters&quot;</span><span class="p">]),</span>
        <span class="p">(</span><span class="s2">&quot;5 l&quot;</span><span class="p">,</span> <span class="p">[</span><span class="s2">&quot;l&quot;</span><span class="p">]),</span>
        <span class="p">(</span><span class="s2">&quot;5 L&quot;</span><span class="p">,</span> <span class="p">[</span><span class="s2">&quot;L&quot;</span><span class="p">]),</span>
    <span class="p">],</span> <span class="n">verbose</span><span class="o">=</span><span class="n">verbose</span><span class="p">)</span>
    <span class="n">test_text_regex</span><span class="p">(</span><span class="s2">&quot;DL&quot;</span><span class="p">,</span> <span class="n">DL</span><span class="p">,</span> <span class="p">[</span>
        <span class="p">(</span><span class="s2">&quot;5 decilitres&quot;</span><span class="p">,</span> <span class="p">[</span><span class="s2">&quot;decilitres&quot;</span><span class="p">]),</span>
        <span class="p">(</span><span class="s2">&quot;5 deciliters&quot;</span><span class="p">,</span> <span class="p">[</span><span class="s2">&quot;deciliters&quot;</span><span class="p">]),</span>
        <span class="p">(</span><span class="s2">&quot;5 dl&quot;</span><span class="p">,</span> <span class="p">[</span><span class="s2">&quot;dl&quot;</span><span class="p">]),</span>
        <span class="p">(</span><span class="s2">&quot;5 dL&quot;</span><span class="p">,</span> <span class="p">[</span><span class="s2">&quot;dL&quot;</span><span class="p">]),</span>
    <span class="p">],</span> <span class="n">verbose</span><span class="o">=</span><span class="n">verbose</span><span class="p">)</span>
    <span class="n">test_text_regex</span><span class="p">(</span><span class="s2">&quot;ML&quot;</span><span class="p">,</span> <span class="n">ML</span><span class="p">,</span> <span class="p">[</span>
        <span class="p">(</span><span class="s2">&quot;5 millilitres&quot;</span><span class="p">,</span> <span class="p">[</span><span class="s2">&quot;millilitres&quot;</span><span class="p">]),</span>
        <span class="p">(</span><span class="s2">&quot;5 milliliters&quot;</span><span class="p">,</span> <span class="p">[</span><span class="s2">&quot;milliliters&quot;</span><span class="p">]),</span>
        <span class="p">(</span><span class="s2">&quot;5 ml&quot;</span><span class="p">,</span> <span class="p">[</span><span class="s2">&quot;ml&quot;</span><span class="p">]),</span>
        <span class="p">(</span><span class="s2">&quot;5 mL&quot;</span><span class="p">,</span> <span class="p">[</span><span class="s2">&quot;mL&quot;</span><span class="p">]),</span>
    <span class="p">],</span> <span class="n">verbose</span><span class="o">=</span><span class="n">verbose</span><span class="p">)</span>
    <span class="n">test_text_regex</span><span class="p">(</span><span class="s2">&quot;CUBIC_MM&quot;</span><span class="p">,</span> <span class="n">CUBIC_MM</span><span class="p">,</span> <span class="p">[</span>
        <span class="p">(</span><span class="s2">&quot;5 mm^3&quot;</span><span class="p">,</span> <span class="p">[</span><span class="s2">&quot;mm^3&quot;</span><span class="p">]),</span>
        <span class="p">(</span><span class="s2">&quot;5 cubic mm&quot;</span><span class="p">,</span> <span class="p">[</span><span class="s2">&quot;cubic mm&quot;</span><span class="p">]),</span>
        <span class="p">(</span><span class="s2">&quot;5 cubic millimetres&quot;</span><span class="p">,</span> <span class="p">[</span><span class="s2">&quot;cubic millimetres&quot;</span><span class="p">]),</span>
    <span class="p">],</span> <span class="n">verbose</span><span class="o">=</span><span class="n">verbose</span><span class="p">)</span>

    <span class="n">test_text_regex</span><span class="p">(</span><span class="s2">&quot;HOUR&quot;</span><span class="p">,</span> <span class="n">HOUR</span><span class="p">,</span> <span class="p">[</span>
        <span class="p">(</span><span class="s2">&quot;5 hours&quot;</span><span class="p">,</span> <span class="p">[</span><span class="s2">&quot;hours&quot;</span><span class="p">]),</span>
        <span class="p">(</span><span class="s2">&quot;5 hr&quot;</span><span class="p">,</span> <span class="p">[</span><span class="s2">&quot;hr&quot;</span><span class="p">]),</span>
        <span class="p">(</span><span class="s2">&quot;5 h&quot;</span><span class="p">,</span> <span class="p">[</span><span class="s2">&quot;h&quot;</span><span class="p">]),</span>
    <span class="p">],</span> <span class="n">verbose</span><span class="o">=</span><span class="n">verbose</span><span class="p">)</span>

    <span class="n">test_text_regex</span><span class="p">(</span><span class="s2">&quot;PERCENT&quot;</span><span class="p">,</span> <span class="n">PERCENT</span><span class="p">,</span> <span class="p">[</span>
        <span class="p">(</span><span class="s2">&quot;5 percent&quot;</span><span class="p">,</span> <span class="p">[</span><span class="s2">&quot;percent&quot;</span><span class="p">]),</span>
        <span class="p">(</span><span class="s2">&quot;5 per cent&quot;</span><span class="p">,</span> <span class="p">[</span><span class="s2">&quot;per cent&quot;</span><span class="p">]),</span>
        <span class="p">(</span><span class="s2">&quot;5 pct&quot;</span><span class="p">,</span> <span class="p">[</span><span class="s2">&quot;pct&quot;</span><span class="p">]),</span>
        <span class="p">(</span><span class="s2">&quot;5%&quot;</span><span class="p">,</span> <span class="p">[</span><span class="s2">&quot;%&quot;</span><span class="p">]),</span>
    <span class="p">],</span> <span class="n">verbose</span><span class="o">=</span><span class="n">verbose</span><span class="p">)</span>

    <span class="n">test_text_regex</span><span class="p">(</span><span class="s2">&quot;CELLS&quot;</span><span class="p">,</span> <span class="n">CELLS</span><span class="p">,</span> <span class="p">[</span>
        <span class="p">(</span><span class="s2">&quot;5 cells&quot;</span><span class="p">,</span> <span class="p">[</span><span class="s2">&quot;cells&quot;</span><span class="p">]),</span>
        <span class="p">(</span><span class="s2">&quot;5 cell&quot;</span><span class="p">,</span> <span class="p">[</span><span class="s2">&quot;cell&quot;</span><span class="p">]),</span>
    <span class="p">],</span> <span class="n">verbose</span><span class="o">=</span><span class="n">verbose</span><span class="p">)</span>

    <span class="n">test_text_regex</span><span class="p">(</span><span class="s2">&quot;MILLIMOLES&quot;</span><span class="p">,</span> <span class="n">MILLIMOLES</span><span class="p">,</span> <span class="p">[</span>
        <span class="p">(</span><span class="s2">&quot;5 millimoles&quot;</span><span class="p">,</span> <span class="p">[</span><span class="s2">&quot;millimoles&quot;</span><span class="p">]),</span>
        <span class="p">(</span><span class="s2">&quot;5 millimol&quot;</span><span class="p">,</span> <span class="p">[</span><span class="s2">&quot;millimol&quot;</span><span class="p">]),</span>
        <span class="p">(</span><span class="s2">&quot;5 mmol&quot;</span><span class="p">,</span> <span class="p">[</span><span class="s2">&quot;mmol&quot;</span><span class="p">]),</span>
    <span class="p">],</span> <span class="n">verbose</span><span class="o">=</span><span class="n">verbose</span><span class="p">)</span>
    <span class="n">test_text_regex</span><span class="p">(</span><span class="s2">&quot;MILLIEQ&quot;</span><span class="p">,</span> <span class="n">MILLIEQ</span><span class="p">,</span> <span class="p">[</span>
        <span class="p">(</span><span class="s2">&quot;5 mEq&quot;</span><span class="p">,</span> <span class="p">[</span><span class="s2">&quot;mEq&quot;</span><span class="p">]),</span>
    <span class="p">],</span> <span class="n">verbose</span><span class="o">=</span><span class="n">verbose</span><span class="p">)</span>

    <span class="n">test_text_regex</span><span class="p">(</span><span class="s2">&quot;UNITS&quot;</span><span class="p">,</span> <span class="n">UNITS</span><span class="p">,</span> <span class="p">[</span>
        <span class="p">(</span><span class="s2">&quot;5 U&quot;</span><span class="p">,</span> <span class="p">[</span><span class="s2">&quot;U&quot;</span><span class="p">]),</span>
        <span class="p">(</span><span class="s2">&quot;5 IU&quot;</span><span class="p">,</span> <span class="p">[</span><span class="s2">&quot;IU&quot;</span><span class="p">]),</span>
    <span class="p">],</span> <span class="n">verbose</span><span class="o">=</span><span class="n">verbose</span><span class="p">)</span>
    <span class="n">test_text_regex</span><span class="p">(</span><span class="s2">&quot;MILLIUNITS&quot;</span><span class="p">,</span> <span class="n">MILLIUNITS</span><span class="p">,</span> <span class="p">[</span>
        <span class="p">(</span><span class="s2">&quot;5 mU&quot;</span><span class="p">,</span> <span class="p">[</span><span class="s2">&quot;mU&quot;</span><span class="p">]),</span>
        <span class="p">(</span><span class="s2">&quot;5 mIU&quot;</span><span class="p">,</span> <span class="p">[</span><span class="s2">&quot;mIU&quot;</span><span class="p">]),</span>
    <span class="p">],</span> <span class="n">verbose</span><span class="o">=</span><span class="n">verbose</span><span class="p">)</span>
    <span class="n">test_text_regex</span><span class="p">(</span><span class="s2">&quot;MICROUNITS&quot;</span><span class="p">,</span> <span class="n">MICROUNITS</span><span class="p">,</span> <span class="p">[</span>
        <span class="p">(</span><span class="s2">&quot;5 uU&quot;</span><span class="p">,</span> <span class="p">[</span><span class="s2">&quot;uU&quot;</span><span class="p">]),</span>
        <span class="p">(</span><span class="s2">&quot;5 μU&quot;</span><span class="p">,</span> <span class="p">[</span><span class="s2">&quot;μU&quot;</span><span class="p">]),</span>
        <span class="p">(</span><span class="s2">&quot;5 uIU&quot;</span><span class="p">,</span> <span class="p">[</span><span class="s2">&quot;uIU&quot;</span><span class="p">]),</span>
        <span class="p">(</span><span class="s2">&quot;5 μIU&quot;</span><span class="p">,</span> <span class="p">[</span><span class="s2">&quot;μIU&quot;</span><span class="p">]),</span>
    <span class="p">],</span> <span class="n">verbose</span><span class="o">=</span><span class="n">verbose</span><span class="p">)</span>

    <span class="n">test_text_regex</span><span class="p">(</span><span class="s2">&quot;SCORE&quot;</span><span class="p">,</span> <span class="n">SCORE</span><span class="p">,</span> <span class="p">[</span>
        <span class="p">(</span><span class="s2">&quot;I scored 5&quot;</span><span class="p">,</span> <span class="p">[</span><span class="s2">&quot;scored&quot;</span><span class="p">]),</span>
        <span class="p">(</span><span class="s2">&quot;MMSE score 5&quot;</span><span class="p">,</span> <span class="p">[</span><span class="s2">&quot;score&quot;</span><span class="p">]),</span>
    <span class="p">],</span> <span class="n">verbose</span><span class="o">=</span><span class="n">verbose</span><span class="p">)</span>

    <span class="n">test_text_regex</span><span class="p">(</span><span class="s2">&quot;MILLIMOLAR&quot;</span><span class="p">,</span> <span class="n">MILLIMOLAR</span><span class="p">,</span> <span class="p">[</span>
        <span class="p">(</span><span class="s2">&quot;5 mM&quot;</span><span class="p">,</span> <span class="p">[</span><span class="s2">&quot;mM&quot;</span><span class="p">]),</span>
    <span class="p">],</span> <span class="n">verbose</span><span class="o">=</span><span class="n">verbose</span><span class="p">)</span>

    <span class="n">test_text_regex</span><span class="p">(</span><span class="s2">&quot;MM_HG&quot;</span><span class="p">,</span> <span class="n">MM_HG</span><span class="p">,</span> <span class="p">[</span>
        <span class="p">(</span><span class="s2">&quot;5 mmHg&quot;</span><span class="p">,</span> <span class="p">[</span><span class="s2">&quot;mmHg&quot;</span><span class="p">]),</span>
        <span class="p">(</span><span class="s2">&quot;5 mm Hg&quot;</span><span class="p">,</span> <span class="p">[</span><span class="s2">&quot;mm Hg&quot;</span><span class="p">]),</span>
    <span class="p">],</span> <span class="n">verbose</span><span class="o">=</span><span class="n">verbose</span><span class="p">)</span>

    <span class="n">test_text_regex</span><span class="p">(</span><span class="s2">&quot;SQ_M&quot;</span><span class="p">,</span> <span class="n">SQ_M</span><span class="p">,</span> <span class="p">[</span>
        <span class="p">(</span><span class="s2">&quot;5 square metres&quot;</span><span class="p">,</span> <span class="p">[</span><span class="s2">&quot;square metres&quot;</span><span class="p">]),</span>
        <span class="p">(</span><span class="s2">&quot;5 sq m&quot;</span><span class="p">,</span> <span class="p">[</span><span class="s2">&quot;sq m&quot;</span><span class="p">]),</span>
        <span class="p">(</span><span class="s2">&quot;5 m^2&quot;</span><span class="p">,</span> <span class="p">[</span><span class="s2">&quot;m^2&quot;</span><span class="p">]),</span>
    <span class="p">],</span> <span class="n">verbose</span><span class="o">=</span><span class="n">verbose</span><span class="p">)</span>

    <span class="n">test_text_regex</span><span class="p">(</span><span class="s2">&quot;KG_PER_SQ_M&quot;</span><span class="p">,</span> <span class="n">KG_PER_SQ_M</span><span class="p">,</span> <span class="p">[</span>
        <span class="p">(</span><span class="s2">&quot;5 kg per square metre&quot;</span><span class="p">,</span> <span class="p">[</span><span class="s2">&quot;kg per square metre&quot;</span><span class="p">]),</span>
        <span class="p">(</span><span class="s2">&quot;5 kg/sq m&quot;</span><span class="p">,</span> <span class="p">[</span><span class="s2">&quot;kg/sq m&quot;</span><span class="p">]),</span>
        <span class="p">(</span><span class="s2">&quot;5 kg/m^2&quot;</span><span class="p">,</span> <span class="p">[</span><span class="s2">&quot;kg/m^2&quot;</span><span class="p">]),</span>
        <span class="p">(</span><span class="s2">&quot;5 kg*m^-2&quot;</span><span class="p">,</span> <span class="p">[</span><span class="s2">&quot;kg*m^-2&quot;</span><span class="p">]),</span>
    <span class="p">],</span> <span class="n">verbose</span><span class="o">=</span><span class="n">verbose</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">test_all</span><span class="p">(</span><span class="n">verbose</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
    <span class="n">test_unit_regexes</span><span class="p">(</span><span class="n">verbose</span><span class="o">=</span><span class="n">verbose</span><span class="p">)</span>


<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s1">&#39;__main__&#39;</span><span class="p">:</span>
    <span class="n">test_all</span><span class="p">()</span>
</pre></div>

          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<h3><a href="../../../index.html">Table Of Contents</a></h3>
<p class="caption"><span class="caption-text">Contents:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../introduction/overview.html">1. Overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../introduction/package_elements.html">2. Package elements in brief</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../introduction/publications.html">3. Reference publications</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../installation/installation.html">4. Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../installation/database_drivers.html">5. Databases and database drivers</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../anonymisation/index.html">6. Anonymisation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../nlp/index.html">7. Natural language processing (NLP)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../website_config/index.html">8. Configuring the CRATE web interface</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../website_using/index.html">9. Using the CRATE web interface</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../misc/ancillary_tools.html">10. Ancillary tools</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../misc/troubleshooting.html">11. Troubleshooting</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../misc/technical_notes.html">12. Technical notes</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../misc/upgrading.html">13. Upgrading CRATE</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../misc/tcpip_ports.html">14. Common relevant TCP/IP ports</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../autodoc/index.html">15. Automatic documentation of source code</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../changelog.html">16. Change log/history</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../misc/to_do.html">17. Things to do</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../glossary.html">18. Abbreviations and glossary</a></li>
</ul>

<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../../../search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    </div>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="../../../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../../index.html">CRATE  documentation</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="../../index.html" >Module code</a> &#187;</li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
        &#169; Copyright 2018, Rudolf Cardinal.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.7.5.
    </div>
  </body>
</html>